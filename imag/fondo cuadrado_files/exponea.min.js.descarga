!function(){"use strict";const e="v3.11.0",t="true"===String(!0),i="__exponea_etc__",n="__exponea_time2__",r="__exponea_tracking_definition__",o="__exponea_banner_event__",s="__exponea_experiment_event__",a="__exponea_last_session_ping_timestamp__",c="__exponea_last_session_start_timestamp__",u="exponea",l="Exponea",h="__exponea_ab_",d="__exponea_safari_push_subscribed__",p="__exponea__sync_modifications__",g="browser_push_notification",f="browser_push_notification_vapid_key",m="snippetVersion",b="exponea-editor-params",y="exponea-experiments-editor",v="/editor/",w=["runtime","polyfills","vendor","main"],k="webxpClient";function _(e,t,i){e._&&e._.forEach((e=>{const n=e[0],r=e[1];if(n.includes(".")){const e=n.split("."),o=e[0],s=e[1];if(!(o in t))return i.error(`Failed to replay function call ${n}`),void i.error(`${o} does not exist on the object`);try{t[o][s].apply(t[o],r)}catch(e){i.error(`Failed to replay function call ${n}`,e)}}else try{t[n].apply(t,r)}catch(e){i.error(`Failed to replay function call ${n}`,e)}}))}function x(e,t,i){e.forEach((e=>{t[e]=i[e].bind(i)}))}function S(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););return e}function E(e){return function(t,i,n){for(var r=-1,o=Object(t),s=n(t),a=s.length;a--;){var c=s[e?a:++r];if(!1===i(o[c],c,o))break}return t}}var T=E();var C="object"==typeof global&&global&&global.Object===Object&&global,A="object"==typeof self&&self&&self.Object===Object&&self,O=C||A||Function("return this")(),P=O.Symbol,j=Object.prototype,L=j.hasOwnProperty,I=j.toString,B=P?P.toStringTag:void 0;var F=Object.prototype.toString;var z=P?P.toStringTag:void 0;function D(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":z&&z in Object(e)?function(e){var t=L.call(e,B),i=e[B];try{e[B]=void 0;var n=!0}catch(e){}var r=I.call(e);return n&&(t?e[B]=i:delete e[B]),r}(e):function(e){return F.call(e)}(e)}function R(e){return null!=e&&"object"==typeof e}function M(e){return R(e)&&"[object Arguments]"==D(e)}var N=Object.prototype,U=N.hasOwnProperty,q=N.propertyIsEnumerable,W=M(function(){return arguments}())?M:function(e){return R(e)&&U.call(e,"callee")&&!q.call(e,"callee")},$=W,H=Array.isArray;var V="object"==typeof exports&&exports&&!exports.nodeType&&exports,G=V&&"object"==typeof module&&module&&!module.nodeType&&module,K=G&&G.exports===V?O.Buffer:void 0,Q=(K?K.isBuffer:void 0)||function(){return!1},Y=/^(?:0|[1-9]\d*)$/;function J(e,t){var i=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=i&&Y.test(e))&&e>-1&&e%1==0&&e<t}function Z(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var X={};function ee(e){return function(t){return e(t)}}X["[object Float32Array]"]=X["[object Float64Array]"]=X["[object Int8Array]"]=X["[object Int16Array]"]=X["[object Int32Array]"]=X["[object Uint8Array]"]=X["[object Uint8ClampedArray]"]=X["[object Uint16Array]"]=X["[object Uint32Array]"]=!0,X["[object Arguments]"]=X["[object Array]"]=X["[object ArrayBuffer]"]=X["[object Boolean]"]=X["[object DataView]"]=X["[object Date]"]=X["[object Error]"]=X["[object Function]"]=X["[object Map]"]=X["[object Number]"]=X["[object Object]"]=X["[object RegExp]"]=X["[object Set]"]=X["[object String]"]=X["[object WeakMap]"]=!1;var te="object"==typeof exports&&exports&&!exports.nodeType&&exports,ie=te&&"object"==typeof module&&module&&!module.nodeType&&module,ne=ie&&ie.exports===te&&C.process,re=function(){try{var e=ie&&ie.require&&ie.require("util").types;return e||ne&&ne.binding&&ne.binding("util")}catch(e){}}(),oe=re&&re.isTypedArray,se=oe?ee(oe):function(e){return R(e)&&Z(e.length)&&!!X[D(e)]},ae=Object.prototype.hasOwnProperty;function ce(e,t){var i=H(e),n=!i&&$(e),r=!i&&!n&&Q(e),o=!i&&!n&&!r&&se(e),s=i||n||r||o,a=s?function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],c=a.length;for(var u in e)!t&&!ae.call(e,u)||s&&("length"==u||r&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||J(u,c))||a.push(u);return a}var ue=Object.prototype;function le(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ue)}function he(e,t){return function(i){return e(t(i))}}var de=he(Object.keys,Object),pe=Object.prototype.hasOwnProperty;function ge(e){if(!le(e))return de(e);var t=[];for(var i in Object(e))pe.call(e,i)&&"constructor"!=i&&t.push(i);return t}function fe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function me(e){if(!fe(e))return!1;var t=D(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function be(e){return null!=e&&Z(e.length)&&!me(e)}function ye(e){return be(e)?ce(e):ge(e)}function ve(e,t){return e&&T(e,t,ye)}function we(e,t){return function(i,n){if(null==i)return i;if(!be(i))return e(i,n);for(var r=i.length,o=t?r:-1,s=Object(i);(t?o--:++o<r)&&!1!==n(s[o],o,s););return i}}var ke=we(ve);function _e(e){return e}function xe(e){return"function"==typeof e?e:_e}function Se(e,t){return(H(e)?S:ke)(e,xe(t))}function Ee(e,t){return e===t||e!=e&&t!=t}function Te(e,t){for(var i=e.length;i--;)if(Ee(e[i][0],t))return i;return-1}var Ce=Array.prototype.splice;function Ae(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Ae.prototype.clear=function(){this.__data__=[],this.size=0},Ae.prototype.delete=function(e){var t=this.__data__,i=Te(t,e);return!(i<0)&&(i==t.length-1?t.pop():Ce.call(t,i,1),--this.size,!0)},Ae.prototype.get=function(e){var t=this.__data__,i=Te(t,e);return i<0?void 0:t[i][1]},Ae.prototype.has=function(e){return Te(this.__data__,e)>-1},Ae.prototype.set=function(e,t){var i=this.__data__,n=Te(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};var Oe,Pe=O["__core-js_shared__"],je=(Oe=/[^.]+$/.exec(Pe&&Pe.keys&&Pe.keys.IE_PROTO||""))?"Symbol(src)_1."+Oe:"";var Le=Function.prototype.toString;function Ie(e){if(null!=e){try{return Le.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var Be=/^\[object .+?Constructor\]$/,Fe=Function.prototype,ze=Object.prototype,De=Fe.toString,Re=ze.hasOwnProperty,Me=RegExp("^"+De.call(Re).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ne(e){return!(!fe(e)||(t=e,je&&je in t))&&(me(e)?Me:Be).test(Ie(e));var t}function Ue(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Ne(i)?i:void 0}var qe=Ue(O,"Map"),We=Ue(Object,"create");var $e=Object.prototype.hasOwnProperty;var He=Object.prototype.hasOwnProperty;function Ve(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Ge(e,t){var i,n,r=e.__data__;return("string"==(n=typeof(i=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof t?"string":"hash"]:r.map}function Ke(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Ve.prototype.clear=function(){this.__data__=We?We(null):{},this.size=0},Ve.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ve.prototype.get=function(e){var t=this.__data__;if(We){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return $e.call(t,e)?t[e]:void 0},Ve.prototype.has=function(e){var t=this.__data__;return We?void 0!==t[e]:He.call(t,e)},Ve.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=We&&void 0===t?"__lodash_hash_undefined__":t,this},Ke.prototype.clear=function(){this.size=0,this.__data__={hash:new Ve,map:new(qe||Ae),string:new Ve}},Ke.prototype.delete=function(e){var t=Ge(this,e).delete(e);return this.size-=t?1:0,t},Ke.prototype.get=function(e){return Ge(this,e).get(e)},Ke.prototype.has=function(e){return Ge(this,e).has(e)},Ke.prototype.set=function(e,t){var i=Ge(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};function Qe(e){var t=this.__data__=new Ae(e);this.size=t.size}Qe.prototype.clear=function(){this.__data__=new Ae,this.size=0},Qe.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Qe.prototype.get=function(e){return this.__data__.get(e)},Qe.prototype.has=function(e){return this.__data__.has(e)},Qe.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Ae){var n=i.__data__;if(!qe||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Ke(n)}return i.set(e,t),this.size=i.size,this};function Ye(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Ke;++t<i;)this.add(e[t])}function Je(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}Ye.prototype.add=Ye.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Ye.prototype.has=function(e){return this.__data__.has(e)};function Ze(e,t,i,n,r,o){var s=1&i,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;var u=o.get(e),l=o.get(t);if(u&&l)return u==t&&l==e;var h=-1,d=!0,p=2&i?new Ye:void 0;for(o.set(e,t),o.set(t,e);++h<a;){var g=e[h],f=t[h];if(n)var m=s?n(f,g,h,t,e,o):n(g,f,h,e,t,o);if(void 0!==m){if(m)continue;d=!1;break}if(p){if(!Je(t,(function(e,t){if(s=t,!p.has(s)&&(g===e||r(g,e,i,n,o)))return p.push(t);var s}))){d=!1;break}}else if(g!==f&&!r(g,f,i,n,o)){d=!1;break}}return o.delete(e),o.delete(t),d}var Xe=O.Uint8Array;function et(e){var t=-1,i=Array(e.size);return e.forEach((function(e,n){i[++t]=[n,e]})),i}function tt(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}var it=P?P.prototype:void 0,nt=it?it.valueOf:void 0;function rt(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}function ot(e,t,i){var n=t(e);return H(e)?n:rt(n,i(e))}function st(){return[]}var at=Object.prototype.propertyIsEnumerable,ct=Object.getOwnPropertySymbols,ut=ct?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var i=-1,n=null==e?0:e.length,r=0,o=[];++i<n;){var s=e[i];t(s,i,e)&&(o[r++]=s)}return o}(ct(e),(function(t){return at.call(e,t)})))}:st,lt=ut;function ht(e){return ot(e,ye,lt)}var dt=Object.prototype.hasOwnProperty;var pt=Ue(O,"DataView"),gt=Ue(O,"Promise"),ft=Ue(O,"Set"),mt=Ue(O,"WeakMap"),bt="[object Map]",yt="[object Promise]",vt="[object Set]",wt="[object WeakMap]",kt="[object DataView]",_t=Ie(pt),xt=Ie(qe),St=Ie(gt),Et=Ie(ft),Tt=Ie(mt),Ct=D;(pt&&Ct(new pt(new ArrayBuffer(1)))!=kt||qe&&Ct(new qe)!=bt||gt&&Ct(gt.resolve())!=yt||ft&&Ct(new ft)!=vt||mt&&Ct(new mt)!=wt)&&(Ct=function(e){var t=D(e),i="[object Object]"==t?e.constructor:void 0,n=i?Ie(i):"";if(n)switch(n){case _t:return kt;case xt:return bt;case St:return yt;case Et:return vt;case Tt:return wt}return t});var At=Ct,Ot="[object Arguments]",Pt="[object Array]",jt="[object Object]",Lt=Object.prototype.hasOwnProperty;function It(e,t,i,n,r,o){var s=H(e),a=H(t),c=s?Pt:At(e),u=a?Pt:At(t),l=(c=c==Ot?jt:c)==jt,h=(u=u==Ot?jt:u)==jt,d=c==u;if(d&&Q(e)){if(!Q(t))return!1;s=!0,l=!1}if(d&&!l)return o||(o=new Qe),s||se(e)?Ze(e,t,i,n,r,o):function(e,t,i,n,r,o,s){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new Xe(e),new Xe(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ee(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=et;case"[object Set]":var c=1&n;if(a||(a=tt),e.size!=t.size&&!c)return!1;var u=s.get(e);if(u)return u==t;n|=2,s.set(e,t);var l=Ze(a(e),a(t),n,r,o,s);return s.delete(e),l;case"[object Symbol]":if(nt)return nt.call(e)==nt.call(t)}return!1}(e,t,c,i,n,r,o);if(!(1&i)){var p=l&&Lt.call(e,"__wrapped__"),g=h&&Lt.call(t,"__wrapped__");if(p||g){var f=p?e.value():e,m=g?t.value():t;return o||(o=new Qe),r(f,m,i,n,o)}}return!!d&&(o||(o=new Qe),function(e,t,i,n,r,o){var s=1&i,a=ht(e),c=a.length;if(c!=ht(t).length&&!s)return!1;for(var u=c;u--;){var l=a[u];if(!(s?l in t:dt.call(t,l)))return!1}var h=o.get(e),d=o.get(t);if(h&&d)return h==t&&d==e;var p=!0;o.set(e,t),o.set(t,e);for(var g=s;++u<c;){var f=e[l=a[u]],m=t[l];if(n)var b=s?n(m,f,l,t,e,o):n(f,m,l,e,t,o);if(!(void 0===b?f===m||r(f,m,i,n,o):b)){p=!1;break}g||(g="constructor"==l)}if(p&&!g){var y=e.constructor,v=t.constructor;y==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v||(p=!1)}return o.delete(e),o.delete(t),p}(e,t,i,n,r,o))}function Bt(e,t,i,n,r){return e===t||(null==e||null==t||!R(e)&&!R(t)?e!=e&&t!=t:It(e,t,i,n,Bt,r))}function Ft(e){return e==e&&!fe(e)}function zt(e,t){return function(i){return null!=i&&(i[e]===t&&(void 0!==t||e in Object(i)))}}function Dt(e){var t=function(e){for(var t=ye(e),i=t.length;i--;){var n=t[i],r=e[n];t[i]=[n,r,Ft(r)]}return t}(e);return 1==t.length&&t[0][2]?zt(t[0][0],t[0][1]):function(i){return i===e||function(e,t,i,n){var r=i.length,o=r,s=!n;if(null==e)return!o;for(e=Object(e);r--;){var a=i[r];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++r<o;){var c=(a=i[r])[0],u=e[c],l=a[1];if(s&&a[2]){if(void 0===u&&!(c in e))return!1}else{var h=new Qe;if(n)var d=n(u,l,c,e,t,h);if(!(void 0===d?Bt(l,u,3,n,h):d))return!1}}return!0}(i,e,t)}}function Rt(e){return"symbol"==typeof e||R(e)&&"[object Symbol]"==D(e)}var Mt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Nt=/^\w*$/;function Ut(e,t){if(H(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!Rt(e))||(Nt.test(e)||!Mt.test(e)||null!=t&&e in Object(t))}function qt(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],o=i.cache;if(o.has(r))return o.get(r);var s=e.apply(this,n);return i.cache=o.set(r,s)||o,s};return i.cache=new(qt.Cache||Ke),i}qt.Cache=Ke;var Wt,$t,Ht,Vt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Gt=/\\(\\)?/g,Kt=(Wt=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Vt,(function(e,i,n,r){t.push(n?r.replace(Gt,"$1"):i||e)})),t},$t=qt(Wt,(function(e){return 500===Ht.size&&Ht.clear(),e})),Ht=$t.cache,$t),Qt=Kt;function Yt(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r}var Jt=P?P.prototype:void 0,Zt=Jt?Jt.toString:void 0;function Xt(e){if("string"==typeof e)return e;if(H(e))return Yt(e,Xt)+"";if(Rt(e))return Zt?Zt.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function ei(e){return null==e?"":Xt(e)}function ti(e,t){return H(e)?e:Ut(e,t)?[e]:Qt(ei(e))}function ii(e){if("string"==typeof e||Rt(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function ni(e,t){for(var i=0,n=(t=ti(t,e)).length;null!=e&&i<n;)e=e[ii(t[i++])];return i&&i==n?e:void 0}function ri(e,t,i){var n=null==e?void 0:ni(e,t);return void 0===n?i:n}function oi(e,t){return null!=e&&t in Object(e)}function si(e,t){return null!=e&&function(e,t,i){for(var n=-1,r=(t=ti(t,e)).length,o=!1;++n<r;){var s=ii(t[n]);if(!(o=null!=e&&i(e,s)))break;e=e[s]}return o||++n!=r?o:!!(r=null==e?0:e.length)&&Z(r)&&J(s,r)&&(H(e)||$(e))}(e,t,oi)}function ai(e){return Ut(e)?(t=ii(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return ni(t,e)}}(e);var t}function ci(e){return"function"==typeof e?e:null==e?_e:"object"==typeof e?H(e)?(t=e[0],i=e[1],Ut(t)&&Ft(i)?zt(ii(t),i):function(e){var n=ri(e,t);return void 0===n&&n===i?si(e,t):Bt(i,n,3)}):Dt(e):ai(e);var t,i}var ui=function(){try{var e=Ue(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),li=ui;function hi(e,t,i){"__proto__"==t&&li?li(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}class di{constructor(e){this.cookies=e}getAbTest(e,t){const i=`${h}${e}__`;let n=this.cookies.getCookie(i);return n||(n=this._selectAbTestVariant(t)),this.cookies.setCookie(i,n,"ab_test"),n}_selectAbTestVariant(e,t=Math.random()){let i=0;const n=function(e,t){var i={};return t=ci(t),ve(e,(function(e,n,r){hi(i,n,t(e,n,r))})),i}(e,(e=>(i+=e,i))),r=t*i;return function(e,t,i){var n;return i(e,(function(e,i,r){if(t(e,i,r))return n=i,!1})),n}(n,ci((e=>r<e)),ve)}}
/*!
     * Sizzle CSS Selector Engine v@VERSION
     * http://sizzlejs.com/
     *
     * Copyright 2013 jQuery Foundation, Inc. and other contributors
     * Released under the MIT license
     * http://jquery.org/license
     *
     * Date: @DATE
     */var pi=function(e){var t,i,n,r,o,s,a,c,u,l,h,d,p,g,f,m,b,y,v,w="sizzle"+-new Date,k=e.document,_=0,x=0,S=re(),E=re(),T=re(),C=function(e,t){return e===t&&(h=!0),0},A="undefined",O=1<<31,P={}.hasOwnProperty,j=[],L=j.pop,I=j.push,B=j.push,F=j.slice,z=j.indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(this[t]===e)return t;return-1},D="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",R="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+R+"*("+M+")(?:"+R+"*([*^$|!~]?=)"+R+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+R+"*\\]",U=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",q=new RegExp("^"+R+"+|((?:^|[^\\\\])(?:\\\\.)*)"+R+"+$","g"),W=new RegExp("^"+R+"*,"+R+"*"),$=new RegExp("^"+R+"*([>+~]|"+R+")"+R+"*"),H=new RegExp("="+R+"*([^\\]'\"]*?)"+R+"*\\]","g"),V=new RegExp(U),G=new RegExp("^"+M+"$"),K={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+R+"*(even|odd|(([+-]|)(\\d*)n|)"+R+"*(?:([+-]|)"+R+"*(\\d+)|))"+R+"*\\)|)","i"),bool:new RegExp("^(?:"+D+")$","i"),needsContext:new RegExp("^"+R+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+R+"*((?:-\\d)?\\d*)"+R+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,ee=/'|\\/g,te=new RegExp("\\\\([\\da-f]{1,6}"+R+"?|("+R+")|.)","ig"),ie=function(e,t,i){var n="0x"+t-65536;return n!=n||i?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)};try{B.apply(j=F.call(k.childNodes),k.childNodes),j[k.childNodes.length].nodeType}catch(e){B={apply:j.length?function(e,t){I.apply(e,F.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}function ne(e,t,n,r){var o,a,u,l,h,g,b,y,_,x;if((t?t.ownerDocument||t:k)!==p&&d(t),n=n||[],!e||"string"!=typeof e)return n;if(1!==(l=(t=t||p).nodeType)&&9!==l)return[];if(f&&!r){if(o=Z.exec(e))if(u=o[1]){if(9===l){if(!(a=t.getElementById(u))||!a.parentNode)return n;if(a.id===u)return n.push(a),n}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(u))&&v(t,a)&&a.id===u)return n.push(a),n}else{if(o[2])return B.apply(n,t.getElementsByTagName(e)),n;if((u=o[3])&&i.getElementsByClassName)return B.apply(n,t.getElementsByClassName(u)),n}if(i.qsa&&(!m||!m.test(e))){if(y=b=w,_=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){for(g=s(e),(b=t.getAttribute("id"))?y=b.replace(ee,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",h=g.length;h--;)g[h]=y+ge(g[h]);_=X.test(e)&&de(t.parentNode)||t,x=g.join(",")}if(x)try{return B.apply(n,_.querySelectorAll(x)),n}catch(e){}finally{b||t.removeAttribute("id")}}}return c(e.replace(q,"$1"),t,n,r)}function re(){var e=[];return function t(i,r){return e.push(i+" ")>n.cacheLength&&delete t[e.shift()],t[i+" "]=r}}function oe(e){return e[w]=!0,e}function se(e){var t=p.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ae(e,t){for(var i=e.split("|"),r=e.length;r--;)n.attrHandle[i[r]]=t}function ce(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||O)-(~e.sourceIndex||O);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function ue(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function le(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function he(e){return oe((function(t){return t=+t,oe((function(i,n){for(var r,o=e([],i.length,t),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))}))}))}function de(e){return e&&typeof e.getElementsByTagName!==A&&e}for(t in i=ne.support={},o=ne.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},d=ne.setDocument=function(e){var t,r=e?e.ownerDocument||e:k,s=r.defaultView;return r!==p&&9===r.nodeType&&r.documentElement?(p=r,g=r.documentElement,f=!o(r),s&&s!==s.top&&(s.addEventListener?s.addEventListener("unload",(function(){d()}),!1):s.attachEvent&&s.attachEvent("onunload",(function(){d()}))),i.attributes=se((function(e){return e.className="i",!e.getAttribute("className")})),i.getElementsByTagName=se((function(e){return e.appendChild(r.createComment("")),!e.getElementsByTagName("*").length})),i.getElementsByClassName=J.test(r.getElementsByClassName),i.getById=se((function(e){return g.appendChild(e).id=w,!r.getElementsByName||!r.getElementsByName(w).length})),i.getById?(n.find.ID=function(e,t){if(typeof t.getElementById!==A&&f){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},n.filter.ID=function(e){var t=e.replace(te,ie);return function(e){return e.getAttribute("id")===t}}):(delete n.find.ID,n.filter.ID=function(e){var t=e.replace(te,ie);return function(e){var i=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return i&&i.value===t}}),n.find.TAG=i.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==A)return t.getElementsByTagName(e)}:function(e,t){var i,n=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},n.find.CLASS=i.getElementsByClassName&&function(e,t){if(f)return t.getElementsByClassName(e)},b=[],m=[],(i.qsa=J.test(r.querySelectorAll))&&(se((function(e){e.innerHTML="<select msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+R+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+R+"*(?:value|"+D+")"),e.querySelectorAll(":checked").length||m.push(":checked")})),se((function(e){var t=r.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+R+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(i.matchesSelector=J.test(y=g.matches||g.webkitMatchesSelector||g.mozMatchesSelector||g.oMatchesSelector||g.msMatchesSelector))&&se((function(e){i.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),b.push("!=",U)})),m=m.length&&new RegExp(m.join("|")),b=b.length&&new RegExp(b.join("|")),t=J.test(g.compareDocumentPosition),v=t||J.test(g.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},C=t?function(e,t){if(e===t)return h=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===n?e===r||e.ownerDocument===k&&v(k,e)?-1:t===r||t.ownerDocument===k&&v(k,t)?1:l?z.call(l,e)-z.call(l,t):0:4&n?-1:1)}:function(e,t){if(e===t)return h=!0,0;var i,n=0,o=e.parentNode,s=t.parentNode,a=[e],c=[t];if(!o||!s)return e===r?-1:t===r?1:o?-1:s?1:l?z.call(l,e)-z.call(l,t):0;if(o===s)return ce(e,t);for(i=e;i=i.parentNode;)a.unshift(i);for(i=t;i=i.parentNode;)c.unshift(i);for(;a[n]===c[n];)n++;return n?ce(a[n],c[n]):a[n]===k?-1:c[n]===k?1:0},r):p},ne.matches=function(e,t){return ne(e,null,null,t)},ne.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&d(e),t=t.replace(H,"='$1']"),i.matchesSelector&&f&&(!b||!b.test(t))&&(!m||!m.test(t)))try{var n=y.call(e,t);if(n||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){}return ne(t,p,null,[e]).length>0},ne.contains=function(e,t){return(e.ownerDocument||e)!==p&&d(e),v(e,t)},ne.attr=function(e,t){(e.ownerDocument||e)!==p&&d(e);var r=n.attrHandle[t.toLowerCase()],o=r&&P.call(n.attrHandle,t.toLowerCase())?r(e,t,!f):void 0;return void 0!==o?o:i.attributes||!f?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},ne.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ne.uniqueSort=function(e){var t,n=[],r=0,o=0;if(h=!i.detectDuplicates,l=!i.sortStable&&e.slice(0),e.sort(C),h){for(;t=e[o++];)t===e[o]&&(r=n.push(o));for(;r--;)e.splice(n[r],1)}return l=null,e},r=ne.getText=function(e){var t,i="",n=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=r(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[n++];)i+=r(t);return i},n=ne.selectors={cacheLength:50,createPseudo:oe,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ie),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ie),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ne.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ne.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&V.test(i)&&(t=s(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ie).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=S[e+" "];return t||(t=new RegExp("(^|"+R+")"+e+"("+R+"|$)"))&&S(e,(function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")}))},ATTR:function(e,t,i){return function(n){var r=ne.attr(n,e);return null==r?"!="===t:!t||(r+="","="===t?r===i:"!="===t?r!==i:"^="===t?i&&0===r.indexOf(i):"*="===t?i&&r.indexOf(i)>-1:"$="===t?i&&r.slice(-i.length)===i:"~="===t?(" "+r+" ").indexOf(i)>-1:"|="===t&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,n,r){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,c){var u,l,h,d,p,g,f=o!==s?"nextSibling":"previousSibling",m=t.parentNode,b=a&&t.nodeName.toLowerCase(),y=!c&&!a;if(m){if(o){for(;f;){for(h=t;h=h[f];)if(a?h.nodeName.toLowerCase()===b:1===h.nodeType)return!1;g=f="only"===e&&!g&&"nextSibling"}return!0}if(g=[s?m.firstChild:m.lastChild],s&&y){for(p=(u=(l=m[w]||(m[w]={}))[e]||[])[0]===_&&u[1],d=u[0]===_&&u[2],h=p&&m.childNodes[p];h=++p&&h&&h[f]||(d=p=0)||g.pop();)if(1===h.nodeType&&++d&&h===t){l[e]=[_,p,d];break}}else if(y&&(u=(t[w]||(t[w]={}))[e])&&u[0]===_)d=u[1];else for(;(h=++p&&h&&h[f]||(d=p=0)||g.pop())&&((a?h.nodeName.toLowerCase()!==b:1!==h.nodeType)||!++d||(y&&((h[w]||(h[w]={}))[e]=[_,d]),h!==t)););return(d-=r)===n||d%n==0&&d/n>=0}}},PSEUDO:function(e,t){var i,r=n.pseudos[e]||n.setFilters[e.toLowerCase()]||ne.error("unsupported pseudo: "+e);return r[w]?r(t):r.length>1?(i=[e,e,"",t],n.setFilters.hasOwnProperty(e.toLowerCase())?oe((function(e,i){for(var n,o=r(e,t),s=o.length;s--;)e[n=z.call(e,o[s])]=!(i[n]=o[s])})):function(e){return r(e,0,i)}):r}},pseudos:{not:oe((function(e){var t=[],i=[],n=a(e.replace(q,"$1"));return n[w]?oe((function(e,t,i,r){for(var o,s=n(e,null,r,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))})):function(e,r,o){return t[0]=e,n(t,null,o,i),!i.pop()}})),has:oe((function(e){return function(t){return ne(e,t).length>0}})),contains:oe((function(e){return e=e.replace(te,ie),function(t){return(t.textContent||t.innerText||r(t)).indexOf(e)>-1}})),lang:oe((function(e){return G.test(e||"")||ne.error("unsupported lang: "+e),e=e.replace(te,ie).toLowerCase(),function(t){var i;do{if(i=f?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===g},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!n.pseudos.empty(e)},header:function(e){return Y.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:he((function(){return[0]})),last:he((function(e,t){return[t-1]})),eq:he((function(e,t,i){return[i<0?i+t:i]})),even:he((function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e})),odd:he((function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e})),lt:he((function(e,t,i){for(var n=i<0?i+t:i;--n>=0;)e.push(n);return e})),gt:he((function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e}))}},n.pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=ue(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=le(t);function pe(){}function ge(e){for(var t=0,i=e.length,n="";t<i;t++)n+=e[t].value;return n}function fe(e,t,i){var n=t.dir,r=i&&"parentNode"===n,o=x++;return t.first?function(t,i,o){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,o)}:function(t,i,s){var a,c,u=[_,o];if(s){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,s))return!0}else for(;t=t[n];)if(1===t.nodeType||r){if((a=(c=t[w]||(t[w]={}))[n])&&a[0]===_&&a[1]===o)return u[2]=a[2];if(c[n]=u,u[2]=e(t,i,s))return!0}}}function me(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function be(e,t,i,n,r){for(var o,s=[],a=0,c=e.length,u=null!=t;a<c;a++)(o=e[a])&&(i&&!i(o,n,r)||(s.push(o),u&&t.push(a)));return s}function ye(e,t,i,n,r,o){return n&&!n[w]&&(n=ye(n)),r&&!r[w]&&(r=ye(r,o)),oe((function(o,s,a,c){var u,l,h,d=[],p=[],g=s.length,f=o||function(e,t,i){for(var n=0,r=t.length;n<r;n++)ne(e,t[n],i);return i}(t||"*",a.nodeType?[a]:a,[]),m=!e||!o&&t?f:be(f,d,e,a,c),b=i?r||(o?e:g||n)?[]:s:m;if(i&&i(m,b,a,c),n)for(u=be(b,p),n(u,[],a,c),l=u.length;l--;)(h=u[l])&&(b[p[l]]=!(m[p[l]]=h));if(o){if(r||e){if(r){for(u=[],l=b.length;l--;)(h=b[l])&&u.push(m[l]=h);r(null,b=[],u,c)}for(l=b.length;l--;)(h=b[l])&&(u=r?z.call(o,h):d[l])>-1&&(o[u]=!(s[u]=h))}}else b=be(b===s?b.splice(g,b.length):b),r?r(null,s,b,c):B.apply(s,b)}))}function ve(e){for(var t,i,r,o=e.length,s=n.relative[e[0].type],a=s||n.relative[" "],c=s?1:0,l=fe((function(e){return e===t}),a,!0),h=fe((function(e){return z.call(t,e)>-1}),a,!0),d=[function(e,i,n){return!s&&(n||i!==u)||((t=i).nodeType?l(e,i,n):h(e,i,n))}];c<o;c++)if(i=n.relative[e[c].type])d=[fe(me(d),i)];else{if((i=n.filter[e[c].type].apply(null,e[c].matches))[w]){for(r=++c;r<o&&!n.relative[e[r].type];r++);return ye(c>1&&me(d),c>1&&ge(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(q,"$1"),i,c<r&&ve(e.slice(c,r)),r<o&&ve(e=e.slice(r)),r<o&&ge(e))}d.push(i)}return me(d)}return pe.prototype=n.filters=n.pseudos,n.setFilters=new pe,s=ne.tokenize=function(e,t){var i,r,o,s,a,c,u,l=E[e+" "];if(l)return t?0:l.slice(0);for(a=e,c=[],u=n.preFilter;a;){for(s in i&&!(r=W.exec(a))||(r&&(a=a.slice(r[0].length)||a),c.push(o=[])),i=!1,(r=$.exec(a))&&(i=r.shift(),o.push({value:i,type:r[0].replace(q," ")}),a=a.slice(i.length)),n.filter)!(r=K[s].exec(a))||u[s]&&!(r=u[s](r))||(i=r.shift(),o.push({value:i,type:s,matches:r}),a=a.slice(i.length));if(!i)break}return t?a.length:a?ne.error(e):E(e,c).slice(0)},a=ne.compile=function(e,t){var i,r=[],o=[],a=T[e+" "];if(!a){for(t||(t=s(e)),i=t.length;i--;)(a=ve(t[i]))[w]?r.push(a):o.push(a);a=T(e,function(e,t){var i=t.length>0,r=e.length>0,o=function(o,s,a,c,l){var h,d,g,f=0,m="0",b=o&&[],y=[],v=u,w=o||r&&n.find.TAG("*",l),k=_+=null==v?1:Math.random()||.1,x=w.length;for(l&&(u=s!==p&&s);m!==x&&null!=(h=w[m]);m++){if(r&&h){for(d=0;g=e[d++];)if(g(h,s,a)){c.push(h);break}l&&(_=k)}i&&((h=!g&&h)&&f--,o&&b.push(h))}if(f+=m,i&&m!==f){for(d=0;g=t[d++];)g(b,y,s,a);if(o){if(f>0)for(;m--;)b[m]||y[m]||(y[m]=L.call(c));y=be(y)}B.apply(c,y),l&&!o&&y.length>0&&f+t.length>1&&ne.uniqueSort(c)}return l&&(_=k,u=v),b};return i?oe(o):o}(o,r)),a.selector=e}return a},c=ne.select=function(e,t,r,o){var c,u,l,h,d,p="function"==typeof e&&e,g=!o&&s(e=p.selector||e);if(r=r||[],1===g.length){if((u=g[0]=g[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&i.getById&&9===t.nodeType&&f&&n.relative[u[1].type]){if(!(t=(n.find.ID(l.matches[0].replace(te,ie),t)||[])[0]))return r;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(c=K.needsContext.test(e)?0:u.length;c--&&(l=u[c],!n.relative[h=l.type]);)if((d=n.find[h])&&(o=d(l.matches[0].replace(te,ie),X.test(u[0].type)&&de(t.parentNode)||t))){if(u.splice(c,1),!(e=o.length&&ge(u)))return B.apply(r,o),r;break}}return(p||a(e,g))(o,t,!f,r,X.test(e)&&de(t.parentNode)||t),r},i.sortStable=w.split("").sort(C).join("")===w,i.detectDuplicates=!!h,d(),i.sortDetached=se((function(e){return 1&e.compareDocumentPosition(p.createElement("div"))})),se((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ae("type|href|height|width",(function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),i.attributes&&se((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ae("value",(function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),se((function(e){return null==e.getAttribute("disabled")}))||ae(D,(function(e,t,i){var n;if(!i)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null})),ne}(window);class gi{constructor(e,t){this.reporter=e,this.documentContentLoaded=t}materializeValue(e,t){if("constant"===e.type)return e.value;try{let i,n;if(n="string"==typeof e.selector?{selector:e.selector,type:"css"}:e.selector,"target"===n.type){if(null==t)return null;i=[t]}else if("target_css"===n.type){if(null==t)return null;i=pi(n.selector,t)}else i=pi(n.selector);if(0===i.length)return null;const r=this._fetchRawValueFromElementList(e,i);return this._applyValueConverter(r,e.converter)}catch(e){if(!(e instanceof Error))throw e}return null}materializeProperties(e,t,i){this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{const n={};e.forEach((({key:e,value:i})=>{n[e]=this.materializeValue(i,t)})),i(n)}))}materializeIds(e,t,i){this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{if("anonymous"===e.type)i({});else if("registered"===e.type){const n=this.materializeValue(e.id,t);i(null===n?{}:{registered:n})}}))}_fetchRawValueFromElementList(e,t){const i=t[0];return i instanceof Element?"from_html"===e.type?i.innerHTML:"value"===e.attribute&&i instanceof HTMLInputElement?""!==i.value?i.value:null:i.getAttribute(e.attribute):null}_applyValueConverter(e,t){return e&&t&&"replace"===t.type?e.replace(new RegExp(t.regex,"gm"),t.replace):e}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function fi(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s}function mi(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function bi(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new i((function(t){t(e.value)})).then(s,a)}c((n=n.apply(e,t||[])).next())}))}var yi=Object.prototype.hasOwnProperty;function vi(e,t,i){var n=e[t];yi.call(e,t)&&Ee(n,i)&&(void 0!==i||t in e)||hi(e,t,i)}function wi(e,t,i,n){var r=!i;i||(i={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=n?n(i[a],e[a],a,i,e):void 0;void 0===c&&(c=e[a]),r?hi(i,a,c):vi(i,a,c)}return i}var ki=Object.prototype.hasOwnProperty;function _i(e){if(!fe(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=le(e),i=[];for(var n in e)("constructor"!=n||!t&&ki.call(e,n))&&i.push(n);return i}function xi(e){return be(e)?ce(e,!0):_i(e)}var Si="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ei=Si&&"object"==typeof module&&module&&!module.nodeType&&module,Ti=Ei&&Ei.exports===Si?O.Buffer:void 0,Ci=Ti?Ti.allocUnsafe:void 0;function Ai(e,t){if(t)return e.slice();var i=e.length,n=Ci?Ci(i):new e.constructor(i);return e.copy(n),n}function Oi(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}var Pi=he(Object.getPrototypeOf,Object),ji=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)rt(t,lt(e)),e=Pi(e);return t}:st,Li=ji;function Ii(e){return ot(e,xi,Li)}var Bi=Object.prototype.hasOwnProperty;function Fi(e){var t=new e.constructor(e.byteLength);return new Xe(t).set(new Xe(e)),t}var zi=/\w*$/;var Di=P?P.prototype:void 0,Ri=Di?Di.valueOf:void 0;function Mi(e,t){var i=t?Fi(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function Ni(e,t,i){var n,r=e.constructor;switch(t){case"[object ArrayBuffer]":return Fi(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return function(e,t){var i=t?Fi(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Mi(e,i);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,zi.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"[object Symbol]":return n=e,Ri?Object(Ri.call(n)):{}}}var Ui=Object.create,qi=function(){function e(){}return function(t){if(!fe(t))return{};if(Ui)return Ui(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),Wi=qi;function $i(e){return"function"!=typeof e.constructor||le(e)?{}:Wi(Pi(e))}var Hi=re&&re.isMap,Vi=Hi?ee(Hi):function(e){return R(e)&&"[object Map]"==At(e)};var Gi=re&&re.isSet,Ki=Gi?ee(Gi):function(e){return R(e)&&"[object Set]"==At(e)},Qi="[object Arguments]",Yi="[object Function]",Ji="[object Object]",Zi={};function Xi(e,t,i,n,r,o){var s,a=1&t,c=2&t,u=4&t;if(i&&(s=r?i(e,n,r,o):i(e)),void 0!==s)return s;if(!fe(e))return e;var l=H(e);if(l){if(s=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&Bi.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(e),!a)return Oi(e,s)}else{var h=At(e),d=h==Yi||"[object GeneratorFunction]"==h;if(Q(e))return Ai(e,a);if(h==Ji||h==Qi||d&&!r){if(s=c||d?{}:$i(e),!a)return c?function(e,t){return wi(e,Li(e),t)}(e,function(e,t){return e&&wi(t,xi(t),e)}(s,e)):function(e,t){return wi(e,lt(e),t)}(e,function(e,t){return e&&wi(t,ye(t),e)}(s,e))}else{if(!Zi[h])return r?e:{};s=Ni(e,h,a)}}o||(o=new Qe);var p=o.get(e);if(p)return p;o.set(e,s),Ki(e)?e.forEach((function(n){s.add(Xi(n,t,i,n,e,o))})):Vi(e)&&e.forEach((function(n,r){s.set(r,Xi(n,t,i,r,e,o))}));var g=l?void 0:(u?c?Ii:ht:c?xi:ye)(e);return S(g||e,(function(n,r){g&&(n=e[r=n]),vi(s,r,Xi(n,t,i,r,e,o))})),s}Zi[Qi]=Zi["[object Array]"]=Zi["[object ArrayBuffer]"]=Zi["[object DataView]"]=Zi["[object Boolean]"]=Zi["[object Date]"]=Zi["[object Float32Array]"]=Zi["[object Float64Array]"]=Zi["[object Int8Array]"]=Zi["[object Int16Array]"]=Zi["[object Int32Array]"]=Zi["[object Map]"]=Zi["[object Number]"]=Zi[Ji]=Zi["[object RegExp]"]=Zi["[object Set]"]=Zi["[object String]"]=Zi["[object Symbol]"]=Zi["[object Uint8Array]"]=Zi["[object Uint8ClampedArray]"]=Zi["[object Uint16Array]"]=Zi["[object Uint32Array]"]=!0,Zi["[object Error]"]=Zi[Yi]=Zi["[object WeakMap]"]=!1;var en,tn,nn;function rn(e){return Xi(e,5)}function on(e){Object.keys(e).forEach((t=>{switch(typeof e[t]){case"object":e[t]&&on(e[t]);break;case"function":e[t]=String(e[t])}}))}function sn(e){return("0"+e.toString(16)).slice(-2)}function an(e,t=window){if(e%2)throw new Error("The length of the random string should be an even number!");const i=t.crypto||t.msCrypto;if(i&&i.getRandomValues&&Array.from){const t=new Uint8Array(e/2);return i.getRandomValues(t),Array.from(t,sn).join("")}let n="";for(let t=0;t<e/2;t++)n+=sn(Math.round(256*Math.random()));return n}function cn(e,t,i,n=""){if(!i)return"Other";const r=!!e.opr&&!!e.opr.addons||!!e.opera||/ OPR\//.test(i),o=!!!t.documentMode&&!!e.StyleMedia;
// @cc_on!@
if(r)return/Mini/.test(i)?"Opera Mini":"Opera";if(o)return"Microsoft Edge";return/SAMSUNG|SGH-[I|N|T]|GT-[I|P|N]|SM-[N|P|T|Z|G]|SHV-E|SCH-[I|J|R|S]|SPH-L/i.test(i)?"Samsung Browser":/Chrome/.test(i)?"Chrome":/Apple/.test(n)?/Mobile/.test(i)?"Mobile Safari":"Safari":/Android/.test(i)?"Android Mobile":/Konqueror/.test(i)?"Konqueror":/Firefox/.test(i)?"Firefox":/MSIE/.test(i)||/Trident/.test(i)?"Internet Explorer":/Gecko/.test(i)?"Mozilla":"Other"}function un(e){if(!e)return"Other";const t={iPhone:"iPhone",iPad:"iPad",iPod:"iPod","Windows Phone":"Windows Phone",Android:"Android",BlackBerry:"(BlackBerry|BB10|PlayBook)"};for(const i in t){if(!t.hasOwnProperty(i))continue;if(new RegExp(t[i],"i").test(e))return i}return"Other"}function ln(e,t){return{os:(i=e.navigator.userAgent,i?/Windows/i.test(i)?/Phone/.test(i)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(i)?"iOS":/Android/.test(i)?"Android":/Mac/i.test(i)?"Mac OS X":/Linux/.test(i)?"Linux":"Other":"Other"),browser:cn(e,t,e.navigator.userAgent,e.navigator.vendor),device:un(e.navigator.userAgent)};var i}function hn(e){return fe(e)&&me(e.remove)}!function(e){e.str2ab8=function(e){const t=new ArrayBuffer(e.length),i=new Uint8Array(t);for(let t=0,n=e.length;t<n;t++)i[t]=e.charCodeAt(t);return t},e.str2ab16=function(e){const t=new ArrayBuffer(2*e.length),i=new Uint16Array(t);for(let t=0,n=e.length;t<n;t++)i[t]=e.charCodeAt(t);return t}}(en||(en={})),function(e){e.Handler=class{constructor(e,t){this.window=e,this.debug=t,this.isInitialized=new Promise((e=>{this.resolveInitialization=e}))}initialize(){return bi(this,void 0,void 0,(function*(){if(!this.window.crypto||!this.window.crypto.subtle)return this.debug.log("Crypto API is not available in this browser, browser extension communication is disabled"),void this.resolveInitialization(!1);const e=en.str2ab8(this.window.atob("MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEApOsQPnGejMMA3SWpmByzZaXlSla2IK2NLV11r4/Qd8MgjvT63cNkM/j3w2E/fCJ1C+cdDPTCZcXgUVFdSXvVAEmNscx/3SZBCvAfXVYUj3fkk00XPO425cSQ6368/fEoa8ocqFtHwSlHyaWZBerp6tfawkhvzJSk8sSfQB0slMyy/IsPQU/jwE9sCKjvPO3QcSTvslTyKSIVeVrxOMULA7HT2u9XaVzGd45l8KxdLfTd7o1XHBw2meA566tQ65Po/wy/3ycM7b8LXG6e+I7xCrHudTlLRVISkSx4Uh4XLJF47EwRIVCvtosY7AENjzLV56D9INCeVBv8GraYPtXJQ3iF65v4bPq8kjm+RNUWxzzLYpJ/tt5Utx5ZVogtN18iObVmw+sR+yY3rJOohUyPwSEhNRfQ9qGEJAImUuqOU6HSUHDD2QDfonsHKPwfEN1l5q3oyMIe73yjtulTUkk0MVPvV0F/v7kwLGZDyoskZ6aDuhSDJf/UTxCjzpbtuYX6VUQyid0X3Dr7fswvFn9ucZydNTW1ZOC/nszmu7Rl+Fk+OsEcTLM0CfZP+1n+bd17+UtIAl4rChmJGhEyz4c4/TFuACcaz8vlIeNZ+9MbXZ1VbI9kOB6roQzGQ2qpirKk1dtrV1Lb/6ODixSGtJ0ShcH7y0icxR8HK71j+oT4mN0CAwEAAQ==".trim())),t=this.window.crypto.subtle.importKey("spki",e,{name:"RSA-OAEP",hash:"SHA-256"},!0,["wrapKey"]),i=this.window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),n=Promise.all([t,i]).then((([e,t])=>this.window.crypto.subtle.wrapKey("raw",t,e,{name:"RSA-OAEP"})));this.keys=Promise.all([i,n]).then((([e,t])=>({aes:e,aesEncrypted:t}))),t.catch((e=>{this.debug.error("Failed to import the encryption key used in BrowserExtension.Handler:",e)})),i.catch((e=>{this.debug.error("Failed to generate the encryption key used in BrowserExtension.Handler:",e)})),n.catch((e=>{this.debug.error("Failed to wrap the encryption key used in BrowserExtension.Handler:",e)})),yield this.keys.then((()=>this.resolveInitialization(!0)),(e=>{throw this.resolveInitialization(!1),e}))}))}sendPayload(e,t={type:"success"},i=Date.now()){const n=an(32,this.window),r=this.sendMessage({type:"payload",id:n,timestamp:i,state:t,payload:e});return e=>{(()=>{bi(this,void 0,void 0,(function*(){yield r,yield this.updateState(n,e)}))})()}}updateState(e,t){return bi(this,void 0,void 0,(function*(){yield this.sendMessage({type:"stateupdate",target:e,state:t})}))}sendMessage(e){return bi(this,void 0,void 0,(function*(){if(!(yield this.isInitialized))return;if(!this.keys)throw new Error("BrowserExtension.Handler's keys must be assigned when initialization is resolved!");const t=rn(e);on(t);const i=en.str2ab16(JSON.stringify(t)),n=this.window.crypto.getRandomValues(new Uint8Array(16)).buffer;let r,o,s;try{({aes:r,aesEncrypted:o}=yield this.keys)}catch(e){return}try{s=yield this.window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,i)}catch(e){return void this.debug.error("Failed to encrypt the data before sending it to the extension:",e)}try{this.window.postMessage({data:s,key:o,iv:n,version:"webxp-js-client-message:v2"},"*")}catch(e){this.debug.error("Failed to send the encrypted data:",e)}}))}}}(tn||(tn={})),function(e){e.Ids="system/ids",e.Time="system/time",e.Tracking="system/tracking",e.Clicks="campaigns/clicks",e.Customers="crm/customers",e.Events="crm/events",e.PushNotificationsVapidKey="system/push-notifications-vapid-key"}(nn||(nn={}));const dn=new RegExp("[?&]+xnpe_cmp=([^&]*)","gi");class pn{constructor(e,t,i,n,r,o,s,a){this.location=e,this.queue=t,this.config=i,this.timestamp=n,this.time=r,this.debug=o,this.window=s,this.document=a}parseUrlAndTrackCampaignClick(){const e=this.getCampaignClickTokenFromUrl();e&&this.trackClickEventWithToken(e)}getCampaignClickTokenFromUrl(){if(this.debug.log("Getting campaign click token from the URL"),this.location.search){const e=this.location.search.match(dn);if(e)return e[0].split("=")[1]}return null}trackClickEventWithToken(e){const t=this.timestamp.getTimestamp();this.debug.log("Tracking campaign click with token",e),this.queue.enqueue({name:nn.Clicks,prepareData:e=>({data:{company_id:this.config.getToken(),age:e-t,url:this.location.href,timestamp:this.time.isTimeInitialized()?this.timestamp.getTimestampWithOffset():void 0,properties:ln(this.window,this.document)}})})}}function gn(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var fn=Math.max;var mn=li?function(e,t){return li(e,"toString",{configurable:!0,enumerable:!1,value:(i=t,function(){return i}),writable:!0});var i}:_e,bn=mn,yn=Date.now;var vn=function(e){var t=0,i=0;return function(){var n=yn(),r=16-(n-i);if(i=n,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(bn),wn=vn;function kn(e,t){return wn(function(e,t,i){return t=fn(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,o=fn(n.length-t,0),s=Array(o);++r<o;)s[r]=n[t+r];r=-1;for(var a=Array(t+1);++r<t;)a[r]=n[r];return a[t]=i(s),gn(e,this,a)}}(e,t,_e),e+"")}function _n(e,t,i){if(!fe(i))return!1;var n=typeof t;return!!("number"==n?be(i)&&J(t,i.length):"string"==n&&t in i)&&Ee(i[t],e)}var xn=Object.prototype,Sn=xn.hasOwnProperty,En=kn((function(e,t){e=Object(e);var i=-1,n=t.length,r=n>2?t[2]:void 0;for(r&&_n(t[0],t[1],r)&&(n=1);++i<n;)for(var o=t[i],s=xi(o),a=-1,c=s.length;++a<c;){var u=s[a],l=e[u];(void 0===l||Ee(l,xn[u])&&!Sn.call(e,u))&&(e[u]=o[u])}return e}));function Tn(e,t,i){(void 0!==i&&!Ee(e[t],i)||void 0===i&&!(t in e))&&hi(e,t,i)}var Cn=Function.prototype,An=Object.prototype,On=Cn.toString,Pn=An.hasOwnProperty,jn=On.call(Object);function Ln(e){if(!R(e)||"[object Object]"!=D(e))return!1;var t=Pi(e);if(null===t)return!0;var i=Pn.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&On.call(i)==jn}function In(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function Bn(e,t,i,n,r,o,s){var a=In(e,i),c=In(t,i),u=s.get(c);if(u)Tn(e,i,u);else{var l,h=o?o(a,c,i+"",e,t,s):void 0,d=void 0===h;if(d){var p=H(c),g=!p&&Q(c),f=!p&&!g&&se(c);h=c,p||g||f?H(a)?h=a:R(l=a)&&be(l)?h=Oi(a):g?(d=!1,h=Ai(c,!0)):f?(d=!1,h=Mi(c,!0)):h=[]:Ln(c)||$(c)?(h=a,$(a)?h=function(e){return wi(e,xi(e))}(a):fe(a)&&!me(a)||(h=$i(c))):d=!1}d&&(s.set(c,h),r(h,c,n,o,s),s.delete(c)),Tn(e,i,h)}}function Fn(e,t,i,n,r){e!==t&&T(t,(function(o,s){if(r||(r=new Qe),fe(o))Bn(e,t,s,i,Fn,n,r);else{var a=n?n(In(e,s),o,s+"",e,t,r):void 0;void 0===a&&(a=o),Tn(e,s,a)}}),xi)}function zn(e,t,i,n,r,o){return fe(e)&&fe(t)&&(o.set(t,e),Fn(e,t,void 0,zn,o),o.delete(t)),e}var Dn,Rn=(Dn=function(e,t,i,n){Fn(e,t,i,n)},kn((function(e,t){var i=-1,n=t.length,r=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(r=Dn.length>3&&"function"==typeof r?(n--,r):void 0,o&&_n(t[0],t[1],o)&&(r=n<3?void 0:r,n=1),e=Object(e);++i<n;){var s=t[i];s&&Dn(e,s,i,r)}return e}))),Mn=kn((function(e){return e.push(void 0,zn),gn(Rn,void 0,e)})),Nn=/\s/;var Un=/^\s+/;function qn(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Nn.test(e.charAt(t)););return t}(e)+1).replace(Un,""):e}var Wn=/^[-+]0x[0-9a-f]+$/i,$n=/^0b[01]+$/i,Hn=/^0o[0-7]+$/i,Vn=parseInt;function Gn(e){if("number"==typeof e)return e;if(Rt(e))return NaN;if(fe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=fe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=qn(e);var i=$n.test(e);return i||Hn.test(e)?Vn(e.slice(2),i?2:8):Wn.test(e)?NaN:+e}var Kn=1/0;function Qn(e){var t=function(e){return e?(e=Gn(e))===Kn||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),i=t%1;return t==t?i?t-i:t:0}function Yn(e){return e!=e}function Jn(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(i=i>r?r:i)<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var o=Array(r);++n<r;)o[n]=e[n+t];return o}function Zn(e){return Xi(e,4)}var Xn=function(){return O.Date.now()},er=Math.max,tr=Math.min;function ir(e,t,i){var n,r,o,s,a,c,u=0,l=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var i=n,o=r;return n=r=void 0,u=t,s=e.apply(o,i)}function g(e){return u=e,a=setTimeout(m,t),l?p(e):s}function f(e){var i=e-c;return void 0===c||i>=t||i<0||h&&e-u>=o}function m(){var e=Xn();if(f(e))return b(e);a=setTimeout(m,function(e){var i=t-(e-c);return h?tr(i,o-(e-u)):i}(e))}function b(e){return a=void 0,d&&n?p(e):(n=r=void 0,s)}function y(){var e=Xn(),i=f(e);if(n=arguments,r=this,c=e,i){if(void 0===a)return g(c);if(h)return clearTimeout(a),a=setTimeout(m,t),p(c)}return void 0===a&&(a=setTimeout(m,t)),s}return t=Gn(t)||0,fe(i)&&(l=!!i.leading,o=(h="maxWait"in i)?er(Gn(i.maxWait)||0,t):o,d="trailing"in i?!!i.trailing:d),y.cancel=function(){void 0!==a&&clearTimeout(a),u=0,n=c=r=a=void 0},y.flush=function(){return void 0===a?s:b(Xn())},y}function nr(e,t){for(var i=null==e?0:e.length;i--&&!1!==t(e[i],i,e););return e}var rr=E(!0);var or=we((function(e,t){return e&&rr(e,t,ye)}),!0);function sr(e,t){return e&&ve(e,xe(t))}function ar(e){return"string"==typeof e||!H(e)&&R(e)&&"[object String]"==D(e)}function cr(e){return null==e?[]:function(e,t){return Yt(t,(function(t){return e[t]}))}(e,ye(e))}var ur=Math.max;function lr(e,t,i,n){e=be(e)?e:cr(e),i=i&&!n?Qn(i):0;var r=e.length;return i<0&&(i=ur(r+i,0)),ar(e)?i<=r&&e.indexOf(t,i)>-1:!!r&&function(e,t,i){return t==t?function(e,t,i){for(var n=i-1,r=e.length;++n<r;)if(e[n]===t)return n;return-1}(e,t,i):function(e,t,i,n){for(var r=e.length,o=i+(n?1:-1);n?o--:++o<r;)if(t(e[o],o,e))return o;return-1}(e,Yn,i)}(e,t,i)>-1}var hr=re&&re.isDate,dr=hr?ee(hr):function(e){return R(e)&&"[object Date]"==D(e)},pr=Object.prototype.hasOwnProperty;function gr(e,t){var i;return ke(e,(function(e,n,r){return!(i=t(e,n,r))})),!!i}function fr(e,t){return e&&e.length?function(e,t,i,n){for(var r=e.length,o=n?r:-1;(n?o--:++o<r)&&t(e[o],o,e););return i?Jn(e,n?0:o,n?o+1:r):Jn(e,n?o+1:0,n?r:o)}(e,ci(t)):[]}const mr=94608e3,br=94608e3,yr=Object.freeze({hide_class:"xnpe_async_hide",timeout:4e3,mode:"async"});class vr{constructor(e,t,i={}){this.database=e,this.logger=t,this.options=vr.DEFAULT_OPTIONS,this.extendOptions(i)}getOptions(){return this.options}getToken(){if("string"!=typeof this.options.token)throw new Error("The token in config object is not set!");return this.options.token}getNewExperimentsOptions(){const e=this.getOptions().new_experiments;return!!e&&(!0===e?yr:En(e,yr))}getActivityHandlerOptions(){const e=this.getOptions().ping.activity;return"object"==typeof e?e:{click:!0,key:!0,scroll:!0,move:!0}}extendOptions(e){void 0!==e.track_hash_changes&&this.logger.warn("Configuration option track_hash_changes is deprecated, use the spa_reloading.on_hash_change option instead"),this.options=Mn({},e,this.options)}setNewCustomerIds(e){this.options.customer=e}isSpaReloadingEnabled(e){return!0===this.getOptions().spa_reloading||!1!==this.getOptions().spa_reloading[e]}storeInIndexedDB(){if(!this.database.isSupported())return Promise.reject(new Error("Database is not supported!"));const e=rn(this.getOptions());return on(e),this.database.setItem("config",e)}}vr.DEFAULT_OPTIONS=Object.freeze({target:"//api.exponea.com",token:null,utm_always:!1,customer:{},ping:{enabled:!0,interval:120,activity:!1,properties:{}},lazy_merge:!1,track:{auto:!0,visits:!1,visits_query_params:["pers_position","pers_content"],activity:!1,unloads:!1,exits:!0,default_properties:{},google_analytics:!0},modify:{enabled:!0,overlay:!1,delay:500},cookies:{cross_subdomain:!0,retrieve_callback:null,expires:{tracking:mr,ab_test:br,time:3600}},track_hash_changes:!0,transfer_identity:!0,error_reporting:"errors_only",debug:!1,utm_params:["utm_source","utm_medium","utm_campaign","utm_term","utm_content","gclid","campaign_id"],dependencies:{},webOptimization:!0,push:{safari:{websitePushID:null}},spa_reloading:!0,feature_flags:null,service_worker_path:"/service-worker.js",exposed_segments:{ttl:3e5,prefetch:!1,notify:!1,segmentation_processing_delay:5e3},compliance:{opt_in:!1},link_cookie:!1});class wr{constructor(e,t){this.config=e,this.http=t}rewardBandit(e,t,i,n){const r=this.config.getOptions().target;this.http.post(`${r}/webxp/bandits/reward`,{reward_token:e,value:t},{credentials:"omit",responseType:"text"}).then((e=>e.body)).then(i,n)}}var kr,_r,xr,Sr,Er;function Tr(e){return function(i,n,r){try{const o=r.type,s=r.operator,a=r.operands;if(kr.whitelist.indexOf(s)>-1)return function(e,t,i,n){const r=e[i];switch(n){case kr.isSet:return null!=r;case kr.isNotSet:return null==r;case kr.hasValue:return Cr(t)?(null==r?void 0:r.length)>0:r+""!="";case kr.hasNoValue:return Cr(t)?0===(null==r?void 0:r.length):r+""==""}return!1}(i,o,n,s);if(function(e){return"string"===e}(o))return function(e,i,n,r){if(-1===_r.whitelist.indexOf(n))return t(n,"string"),!1;const o=e[i]+"";let s;switch(n){case _r.equals:return o===r[0].value;case _r.doesNotEqual:return o!==r[0].value;case _r.isIn:return s=r.map((e=>e.value)),s.indexOf(o)>-1;case _r.isNotIn:return s=r.map((e=>e.value)),-1===s.indexOf(o);case _r.contains:return o.indexOf(r[0].value)>-1;case _r.doesNotContain:return-1===o.indexOf(r[0].value);case _r.startsWith:return o.startsWith(r[0].value);case _r.endsWith:return o.endsWith(r[0].value);case _r.matchesRegex:return null!==new RegExp(r[0].value).exec(o)}return!1}(i,n,s,a);if(function(e){return"number"===e}(o))return function(e,i,n,r){if(-1===xr.whitelist.indexOf(n))return t(n,"number"),!1;const o=parseFloat(e[i]+""),s=parseFloat(r[0].value);switch(n){case xr.equalTo:return o===s;case xr.inBetween:return s<=o&&o<=parseFloat(r[1].value);case xr.lessThan:return o<s;case xr.greaterThan:return o>s}return!1}(i,n,s,a);if(function(e){return"boolean"===e}(o))return function(e,i,n,r){if(-1===Sr.whitelist.indexOf(n))return t(n,"boolean"),!1;const o=e[i]+"",s=r.value+"";if(n===Sr.is)return o===s;return!1}(i,n,s,r);(function(e){return"date"===e})(o)&&e.error("Value filter: Date type is not supported."),Cr(o)&&e.error("Value filter: List type is not supported.")}catch(t){e.debug("Value filter error:",t)}return e.debug("Invalid value filter:",r.operator),!1};function t(t,i){e.error("Contextual Bandits: operation "+t+" not suported for type "+i+".")}}function Cr(e){return"list"===e}!function(e){e.isSet="is set",e.isNotSet="is not set",e.hasValue="has value",e.hasNoValue="has no value",e.whitelist=[e.isSet,e.isNotSet,e.hasValue,e.hasNoValue]}(kr||(kr={})),function(e){e.equals="equals",e.doesNotEqual="does not equal",e.isIn="in",e.isNotIn="not in",e.contains="contains",e.doesNotContain="does not contain",e.startsWith="starts with",e.endsWith="ends with",e.matchesRegex="regex",e.whitelist=[e.equals,e.doesNotEqual,e.isIn,e.isNotIn,e.contains,e.doesNotContain,e.startsWith,e.endsWith,e.matchesRegex]}(_r||(_r={})),function(e){e.equalTo="equal to",e.inBetween="in between",e.lessThan="less than",e.greaterThan="greater than",e.whitelist=[e.equalTo,e.inBetween,e.lessThan,e.greaterThan]}(xr||(xr={})),function(e){e.is="is",e.whitelist=[e.is]}(Sr||(Sr={}));class Ar{constructor(e,t){this.contextualBandit=e,this.debug=t,this.optimizationTargets=[],this.eventFilterMatcher=Tr(this.debug)}put(e,t,i,n){if(""===e)throw new Error("Event type can't be an empty string");if(""===i)throw new Error("Reward token can't be an empty string");this.optimizationTargets.push({eventType:e,valueFilters:t,rewardToken:i,rewardWeight:n})}reward(e,t){const{matchingTargets:i,remainingTargets:n}=this.optimizationTargets.reduce(function(e,t,i){return function(n,r){return r.eventType!==i?(n.remainingTargets.push(r),n):r.valueFilters.reduce(((i,n)=>i&&t(e,n.attribute.property,n.constraint)),!0)?(n.matchingTargets.push(r),n):(n.remainingTargets.push(r),n)}}(e,this.eventFilterMatcher,t),{matchingTargets:[],remainingTargets:[]});i.forEach((e=>{this.contextualBandit.rewardBandit(e.rewardToken,e.rewardWeight)})),this.optimizationTargets=n}}function Or(e){if("number"!=typeof e)return e;const t=new Date;return new Date(t.getTime()+1e3*e)}!function(e){e[e.defer=0]="defer",e[e.immediate=1]="immediate"}(Er||(Er={}));class Pr{constructor(e,t,i,n,r,o,s){this.config=e,this.debug=t,this.logger=i,this.queue=n,this.location=r,this.document=o,this.segments=s}getCookie(e){const t=this.document.cookie?this.document.cookie.split("; "):[];for(let i=0,n=t.length;i<n;i++){const n=t[i].split("="),r=n.shift();if(r){const t=decodeURIComponent(r),i=n.join("=");if(e===t)return this.parseCookieValue(i)}}}setCookie(e,t,i){let n=this.config.getOptions().cookies.expires[i];n=Or(n);const r=function(e,t=document.location.hostname){if(!e)return"";if(ar(e))return e;const i=t.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),n=i?i[0]:"";return n||""}(this.config.getOptions().cookies.cross_subdomain);this.document.cookie=[encodeURIComponent(e),"=",encodeURIComponent(t),"; expires="+n.toUTCString(),"; path=/",r?"; domain="+r:"","https:"===this.location.protocol?"; secure; samesite=none":"; samesite=lax"].join("")}sendCustomerCookieToServer(e){this.queue.enqueue({name:nn.Ids,isBlocking:!0,prepareData:()=>jr(this.config,{cookie:e}),processResponse:e=>{this.debug.log("received customer ids response",e);const t=e.data,i=t.cookie;this.debug.log("cookie received from server is "+i),this.setTrackingCookie(i),this.config.extendOptions({customer:t}),this.segments.prefetch()}},{process:Er.immediate})}setTrackingCookie(e){this.setCookie(i,e,"tracking")}setFreshTrackingCookie(){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return this.setTrackingCookie(e),e}sanitizeCookieOptions(){let e=this.config.getOptions().cookies.expires;function t(e,t,i,n,r){"number"==typeof t&&t>0||dr(t)&&t>new Date||("number"==typeof t?n.warn(`When specifying the number of seconds for cookies.expires.${e}, you have to use a positive number. You passed in '${t}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`):dr(t)?n.warn(`When specifying a Date for cookies.expires.${e}, you have to use a date in the future. You passed in '${t}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`):n.warn(`You can only use a number or a Date object for cookies.expires.${e}, not '${typeof t}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`),r.extendOptions({cookies:{expires:{[e]:i}}}))}fe(e)&&!dr(e)||(e={tracking:e,ab_test:e,time:e},this.config.extendOptions({cookies:{expires:e}})),t("tracking",e.tracking,mr,this.logger,this.config),t("ab_test",e.ab_test,br,this.logger,this.config),t("time",e.time,3600,this.logger,this.config)}parseCookieValue(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(/\+/g," "))}catch(t){return this.debug.error("error while parsing cookie value, ignoring",t),e}}}function jr(e,t){const i=e.getOptions().cookies.expires,n=Zn(e.getOptions().customer);return delete n.cookie,{data:{project_id:e.getToken(),cookie:t.cookie,tifc:t.tifc,customer:n,expires:Math.floor(Or(i.tracking).getTime()/1e3)}}}function Lr(e){setTimeout(e)}function Ir(){return function(e,t,i){const n=i.value,r=Date.now(),o=n.name;return i.value=function(){try{return n.apply(this,arguments)}catch(e){throw this.reporter.sendErrorReport(e,o,r),e}},i}}const Br=Object.freeze({immediate:!1});class Fr{constructor(e,t,i,n,r,o,s,a,c,u,l,h,d){this.reporter=e,this.config=t,this.contextualBanditEventFilter=i,this.time=n,this.timestamp=r,this.queue=o,this.debug=s,this.document=a,this.location=c,this.initializeState=u,this.window=l,this.url=h,this.browserExtension=d,this.eventTrackingListeners=[]}track(e,t={},i={},n=!1){const r=this.timestamp.getTimestamp();this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{i=En(i,Br);const n=Object.assign(Object.assign(Object.assign(Object.assign({location:this.location.href},ln(this.window,this.document)),this.getUtmParamsIfEnabled()),this.getTrackDefaultPropertiesIfEnabled()),t);this.contextualBanditEventFilter.reward(n,e);const o=this.browserExtension.sendPayload({type:"event",eventType:e,eventProperties:n},{type:"pending"});this.queue.enqueue({name:nn.Events,prepareData:t=>{const i=this.config.getOptions().customer;this.debug.log("Tracking event: "+e,n);const o={customer_ids:i,company_id:this.config.getToken(),type:e,age:t-r,properties:n};this.time.isTimeInitialized()&&(o.timestamp=this.timestamp.getTimestampWithOffset());try{this.triggerEventTrackingListeners(e,n)}catch(e){this.debug.error("Error triggering event tracking listeners",e)}return{data:o}},processResponse:(e,t,n)=>{Lr((()=>{var r;return null===(r=i.successCallback)||void 0===r?void 0:r.call(i,e,t,n)})),o({type:"success"})},processError:e=>{Lr((()=>{var t;return null===(t=i.errorCallback)||void 0===t?void 0:t.call(i,e)})),o({type:"error",error:String(e)})}},{process:i.immediate?Er.immediate:Er.defer})})).then((()=>{("web_unload"===e||"user_active"===e&&n)&&this.queue.sendBulkWithBeacon()}))}getUtmParamsIfEnabled(){const e=this.config.getOptions();if(e.utm_always){return e.utm_params?this.url.getParams(e.utm_params):{}}return{}}getTrackDefaultPropertiesIfEnabled(){const e=this.config.getOptions();return e.track&&e.track.default_properties?e.track.default_properties:{}}registerEventTrackingListener(e){this.eventTrackingListeners.push(e)}trackPageVisitEventIfEnabled(){const e=this.config.getOptions().track;e&&e.visits&&(this.trackPageVisitEvent(),this.config.isSpaReloadingEnabled("visits")&&this.url.onChange("trackPageVisitOnUrlChange",(()=>{this.trackPageVisitEvent()})))}trackPageVisitEvent(){this.track("page_visit",Object.assign({referrer:this.document.referrer,location:this.location.href,path:this.location.pathname},this.url.getParams(this.config.getOptions().track.visits_query_params)))}triggerEventTrackingListeners(e,t){for(let i=0;i<this.eventTrackingListeners.length;i++)try{this.eventTrackingListeners[i](e,t)}catch(e){this.debug.error(`Error when processing event listener ${this.eventTrackingListeners[i].name||i}`,e)}}}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Object,Object]),mi("design:returntype",void 0)],Fr.prototype,"track",null);function zr(e,t,i,n=0){if(n>10)throw new Error(`Maximum number of retries reached while waiting for window.ga to appear (already waited for ${500*n}ms). window.gtag is available but it does not appear to load window.ga anymore!`);if(t.ga)return e.log(`window.ga is available after ${n} retries`),void t.ga(i);if(t.gtag)return e.log(`window.gtag is available, trying ${n} retry`),void t.setTimeout(zr.bind(void 0,e,t,i,n+1),500);throw new Error("No window.ga nor window.gtag is available in waitForGoogleAnalyticsSdkToLoad!")}var Dr,Rr;!function(e){e.BannersShow="campaigns/banners/show",e.ExperimentsShow="campaigns/experiments/show",e.HtmlGet="campaigns/html/get",e.ManagedTagsShow="managed-tags/show",e.Recommendation="optimization/recommend/user",e.WebOptimization="webxp/projects/<project_id>/bundle",e.Segments="webxp/projects/<project_id>/segments?cookie=<cookie>",e.LinkIds="webxp/projects/<project_id>/cookies/<cookie>/link-ids"}(Dr||(Dr={})),function(e){e.Internal="internal"}(Rr||(Rr={}));class Mr{constructor(e,t,i,n,r,o,s,a,c){this.reporter=e,this.config=t,this.queue=i,this.debug=n,this.initializeState=r,this.window=o,this.cookies=s,this.browserExtension=a,this.segments=c}requestCustomerIdsFromServer(e,t=(()=>{})){this.queue.enqueue({name:nn.Ids,isBlocking:!0,prepareData:()=>jr(this.config,e),processResponse:e=>{this.debug.log("received customer ids response",e);const i=e.data,n=i.cookie;this.debug.log("cookie received from server is "+n),this.cookies.setTrackingCookie(n),this.config.extendOptions({customer:i}),t(i),this.segments.prefetch(),this.segments.notify()}},{first:!0})}filterEmptyCustomerIds(e){const t={};for(const i in e)!e.hasOwnProperty(i)||null!==e[i]&&void 0!==e[i]&&""!==e[i]?t[i]=e[i]:this.debug.log("Removed empty customer id: "+i,e[i]);return t}identifyCustomerWithGoogleAnalyticsId(){const e=this.config.getOptions();e.customer&&e.customer.google_analytics||e.track.google_analytics&&(!function(e){return"ga"in e||"gtag"in e}(this.window)?this.debug.warn("Missing Google Analytics SDK (window.ga and window.gtag are not defined). Either integrate Google Analytics with your website or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"):!function(e){return"ga"in e&&"function"!=typeof e.ga}(this.window)?zr(this.debug,this.window,(()=>{if(!this.window.ga||!this.window.ga.getAll)throw new Error("window.ga is missing the getAll function");const t=this.window.ga.getAll();if(!t)return;const i=function(e){var t;const i=e.find((e=>{var t;return null===(t=e.get)||void 0===t?void 0:t.call(e,"clientId")}));return null===(t=null==i?void 0:i.get)||void 0===t?void 0:t.call(i,"clientId")}(t);i&&(this.config.extendOptions({customer:Object.assign(Object.assign({},e.customer),{google_analytics:i})}),this.updateCustomer({}))})):this.debug.warn("Incorrect Google Analytics SDK detected (window.ga is "+typeof this.window.ga+"). Are you using an old Google Analytics SDK? This is not supported in the SDK so Google Analytics integration will not work. Either upgrade the Google Analytics SDK or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"))}updateCustomer(e,t=(()=>{}),i=(()=>{}),n=!1){this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:nn.Customers,prepareData:()=>{const t=Object.assign({},e);return{data:{ids:this.config.getOptions().customer,company_id:this.config.getToken(),properties:t}}},processResponse:t,processError:i},{process:n?Er.immediate:Er.defer})}))}linkCustomerIds(e=(()=>{}),t=(()=>{}),i=!1){this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Dr.LinkIds,allowedToFail:!0,noBulk:!0,prepareData:()=>({data:{external_ids:this.config.getOptions().customer}}),processResponse:e,processError:t},{process:i?Er.immediate:Er.defer})}))}identifyCustomer(e,t={},i=(()=>{}),n=(()=>{}),r=!1,o,s){"string"!=typeof e&&"number"!=typeof e||(e={registered:e});const a=this.config.getOptions().customer,c=this.filterEmptyCustomerIds(e);c.cookie=a.cookie,a.google_analytics&&(c.google_analytics=a.google_analytics),this.debug.log("Identifying customer: ",c),this.browserExtension.sendPayload({type:"ids",ids:c}),this.config.extendOptions({customer:c}),this.updateCustomer(t,i,n,r),o&&this.linkCustomerIds(o,s,r)}}class Nr{get database(){return this.isSupported()?(this.dbRequest||(this.dbRequest=function(e,t,i){const n=e.open("exponea",1);return n.onblocked=()=>{t.warn("A new version of this page is ready. Please close all other tabs with this site open to update.")},n.onupgradeneeded=e=>{!function(e,t){const i=e.result;t.oldVersion<1&&i.createObjectStore("settings",{keyPath:"key"})}(n,e)},new Promise(((e,t)=>{n.onsuccess=()=>{const t=n.result;t.onversionchange=()=>{t.close()},t.onclose=()=>{i()},e(t)},n.onerror=()=>{t(n.error)}}))}(this.window.indexedDB,this.logger,(()=>this.dbRequest=void 0))),this.dbRequest):Promise.reject("IndexedDB is not supported, some features may be broken")}constructor(e,t){this.window=e,this.logger=t,this.database.catch((()=>{}))}setItem(e,t){return this.database.then((i=>{const n=Object.assign(Object.assign({},t),{key:e}),r=i.transaction("settings","readwrite").objectStore("settings").put(n);return new Promise(((e,t)=>{r.onsuccess=()=>e(),r.onerror=()=>t(r.error)}))}))}getItem(e){return this.database.then((t=>{const i=t.transaction("settings").objectStore("settings").get(e);return new Promise(((e,t)=>{i.onsuccess=()=>e(i.result),i.onerror=()=>{t(i.error)}}))}))}isSupported(){return void 0!==this.window.indexedDB}}class Ur{constructor(e,t,i,n){this.config=e,this.location=t,this.logger=i,this.storageUtils=n}error(e,...t){"string"==typeof e?this.print("error",e,...t):this.print("error",e)}log(e,...t){this.print("log",e,...t)}warn(e,...t){this.print("warn",e,...t)}debug(e,...t){this.print("debug",e,...t)}canPrintMessages(e="production",i=t){return"production"!==e&&i||this.config.getOptions().debug||this.location.search.includes(`${u}_debug=true`)||!!this.storageUtils.readBooleanFromStorage("localStorage",`${u}_debug`)}print(e,...t){this.canPrintMessages()&&this.logger[e](...t.filter((e=>void 0!==e)))}}class qr{constructor(e,t){this.config=e,this.reporter=t,this.DEFAULT_DEPENDENCIES={exp:"https://exp-framework.exponea.com/exp.js"},this.loadedDependencies={}}get options(){return this.config.getOptions()}loadDependency(e){let t;t="[object Array]"===Object.prototype.toString.call(e)?e:[e];try{const e=this.getDependencyUrls(t);return this.getDependencyLoadingChain(e)}catch(e){return this.reporter.reportPromiseError(Promise.reject(e))}}getDependencyUrls(e){const t=[];for(const i of e){let e=this.DEFAULT_DEPENDENCIES[i];if(this.options.dependencies&&this.options.dependencies[i]&&(e=this.options.dependencies[i]),!e)throw new Error(`unknown dependency named '${i}'`);t.push(e)}return t}getDependencyLoadingChain(e){let t=this.reporter.reportPromiseError(Promise.resolve());for(const i of e)t=t.then((()=>this.loadDependencyFromUrl(i)));return t}isDependencyPresent(e){return this.loadedDependencies[e]}markDependencyAsPresent(e){this.loadedDependencies[e]=!0}loadDependencyFromUrl(e){if(this.isDependencyPresent(e))return this.reporter.reportPromiseError(Promise.resolve());this.markDependencyAsPresent(e);const t=new Promise(((t,i)=>{const n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");r.src=e;let o=!1;r.onload=r.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,t(),r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r))},r.onerror=function(t){const n="message"in t?`: ${t.message}`:"";i(new Error(`Loading of dependency '${e}' failed${n}`))},r.onabort=function(){i(new Error(`Loading of dependency '${e}' was aborted`))},n.insertBefore(r,n.firstChild)}));return this.reporter.reportPromiseError(t)}}class Wr{constructor(e,t){this.window=e,this.document=t}whenLoaded(){return this.loadedPromise||(this.loadedPromise=new Promise((e=>function(e,t,i){let n=!1,r=!0;const o=t.documentElement,s="addEventListener"in t?"addEventListener":"attachEvent",a="removeEventListener"in t?"removeEventListener":"detachEvent",c="addEventListener"in t?"":"on";if("complete"===t.readyState)i.call(e,"lazy");else{if(t.createEventObject&&o.doScroll){try{r=!e.frameElement}catch(e){}r&&function t(){try{o.doScroll("left")}catch(e){return void setTimeout(t,50)}n=!0,i.call(e,"poll")}()}t[s](c+"DOMContentLoaded",u,!1),t[s](c+"readystatechange",u,!1),e[s](c+"load",u,!1)}function u(r){if("readystatechange"===r.type&&"complete"!==t.readyState)return;const o="load"===r.type?e:t;o[a].bind(o)(c+r.type,u,!1),n||(n=!0,i.call(e,r.type))}}(this.window,this.document,e)))),this.loadedPromise}}var $r,Hr;!function(e){const t=["id","name","price","brand","category","variant","list","position"],i=["product_id","name","price","brand","category","variant","list","position"],n=["currencyCode"],r=["currency_code"],o=["id","name","brand","category","variant","price","quantity","coupon","position"],s=["product_id","name","brand","category","variant","price","quantity","coupon","position"],a=["id","affiliation","revenue","tax","shipping","coupon","list","step","option"],c=["transaction_id","affiliation","revenue","tax","shipping","coupon","list","step","option"],u=["id","name","creative","position"],l=["promo_id","name","creative","position"];function h(e,t,i,n=i){i.forEach(((i,r)=>{const o=n[r];t.hasOwnProperty(i)&&t[i]&&(e[o]=t[i])}))}function d(e,t){h(e,t,n,r)}function p(e,t){h(e,t,a,c)}e.Tracker=class{constructor(e,t){this.debug=e,this.eventTracker=t}trackEnhancedEcommerce(e,t="all"){Ln(e)?("impressions"!==t&&"all"!==t||this.trackProductImpressions(e),"click"!==t&&"all"!==t||this.trackProductAction(e,"click","product_click"),"detail"!==t&&"all"!==t||this.trackProductAction(e,"detail","product_detail"),"add"!==t&&"all"!==t||this.trackProductAction(e,"add","product_add_to_cart"),"remove"!==t&&"all"!==t||this.trackProductAction(e,"remove","product_remove_from_cart"),"promoView"!==t&&"all"!==t||this.trackPromotionAction(e,"promoView","promo_impression"),"promoClick"!==t&&"all"!==t||this.trackPromotionAction(e,"promoClick","promo_click"),"checkout"!==t&&"all"!==t||this.trackCheckout(e),"checkout_option"!==t&&"all"!==t||this.trackCheckoutOption(e),"purchase"!==t&&"all"!==t||this.trackPurchase(e),"refund"!==t&&"all"!==t||this.trackRefund(e)):this.debug.error("Ecommerce parameter is not a plain object")}trackProductImpressions(e){e.impressions?e.impressions.forEach((n=>{const r={};d(r,e),h(r,n,t,i),this.trackEnhancedEcommerceEvent("product_impression",r)})):this.debug.warn("There are no impressions in the ecommerce object")}trackProductAction(e,t,i){var n;const r=e[t];if(!r)return void this.debug.debug(`${t} not found in the ecommerce object`);if(!r.products)return void this.debug.debug(`${t} in the ecommerce object does not have any products`);const a=null!==(n=r.actionField)&&void 0!==n?n:{};r.products.forEach((t=>{const n={};d(n,e),p(n,a),h(n,t,o,s),this.trackEnhancedEcommerceEvent(i,n)}))}trackPromotionAction(e,t,i){const n=e[t];n?n.promotions?n.promotions.forEach((t=>{const n={};d(n,e),h(n,t,u,l),this.trackEnhancedEcommerceEvent(i,n)})):this.debug.debug(`${t} in the ecommerce object does not have any promotions`):this.debug.debug(`${t} not found in the ecommerce object`)}trackCheckout(e){var t;if(!e.checkout)return void this.debug.debug("There is no checkout in the ecommerce object");this.trackProductAction(e,"checkout","product_checkout");const i=null!==(t=e.checkout.actionField)&&void 0!==t?t:{},n={};d(n,e),p(n,i),this.trackEnhancedEcommerceEvent("checkout",n)}trackCheckoutOption(e){var t;if(!e.checkout_option)return void this.debug.debug("There is no checkout option in the ecommerce object");const i=null!==(t=e.checkout_option.actionField)&&void 0!==t?t:{},n={};d(n,e),p(n,i),this.trackEnhancedEcommerceEvent("checkout_option",n)}trackPurchase(e){var t;if(!e.purchase)return void this.debug.debug("There is no purchase in the ecommerce object");this.trackProductAction(e,"purchase","product_purchase");const i=null!==(t=e.purchase.actionField)&&void 0!==t?t:{},n={};d(n,e),p(n,i),this.trackEnhancedEcommerceEvent("transaction",n)}trackRefund(e){var t;if(!e.refund)return void this.debug.debug("There is no refund in the ecommerce object");const i=null!==(t=e.refund.actionField)&&void 0!==t?t:{},n={};d(n,e),p(n,i),e.refund.products?(n.refund_type="partial",this.trackProductAction(e,"refund","product_refund")):n.refund_type="full",this.trackEnhancedEcommerceEvent("refund",n)}trackEnhancedEcommerceEvent(e,t){this.eventTracker.track(e,Object.assign({tracked_via:"eecommerce"},t))}}}($r||($r={}));class Vr{constructor(e,t,i){this.debug=t,this.reporter=i,this.reportablePromise=e.then((e=>e)).catch((e=>Promise.reject(e)))}then(e){const t=this.reportablePromise.then((t=>{const i=Date.now();let n;try{n=e(t)}catch(e){throw this.debug.error(e),this.reporter.sendErrorReport(e,"promise",i),e}return n instanceof Vr?n.reportablePromise:n}));return new Vr(t,this.debug,this.reporter)}catch(e){const t=this.reportablePromise.catch((t=>{const i=Date.now();let n;try{n=e(t)}catch(e){throw this.debug.error(e),this.reporter.sendErrorReport(e,"promise",i),e}return n instanceof Vr?n.reportablePromise:n}));return new Vr(t,this.debug,this.reporter)}}class Gr{constructor(e,t,i){this.debug=e,this._target="//sdk-tracing.exponea.com/webxp-trace/record/browser/v1",this.config=t,this.http=i}reportError(e,t){return this._reportError(e,t)}sendErrorReport(e,t,i=Date.now()){const n=this.serialize(e,t,i);this.debug.log("Sending error report",n),this._sendErrorReport(n).then((()=>{this.debug.log("Error report was successfully sent")})).catch((e=>{this.debug.error("Error while sending the error report",e)}))}serialize(t,i,n){let r;return r=t instanceof Error?t:new Error(String(t)),{id:an(32),instance_id:"EXP",sdk_version:e,company_id:this.config.getToken(),spans:[{id:an(16),start_time:n/1e3,duration:(Date.now()-n)/1e3,operation:i,error:{message:r.message,name:r.name,stack:r.stack||""},tags:{url:location.href.split(/[?#]/)[0],host:location.hostname}}]}}reportPromiseError(e){return new Vr(e,this.debug,this)}_reportError(e,t){const i=this;return function(){const n=Date.now();try{return e(...arguments)}catch(r){const o=t||e.name||"transientOperation";throw i.sendErrorReport(r,o,n),r}}}_sendErrorReport(e){return this.http.post(this._target,e,{responseType:"text",headers:{"Content-type":"application/json"},credentials:"omit"})}}!function(e){e.isDataLayerVariable=function(e){return"data_layer"===e.variable.type},e.isQueryParameterVariable=function(e){return"query"===e.variable.type},e.isJavaScriptVariable=function(e){return"global_variable"===e.variable.type},e.isCustomFunction=function(e){return"custom_function"===e.variable.type}}(Hr||(Hr={}));const Kr="dataLayer";var Qr;!function(e){e.matches=function(e,t,i,n,r){return!r||r.every((r=>{let o;if(!n)return!1;try{const s=r.attribute.id,a=function(e,t){return e.data.find((e=>e.id===t))}(n,s);if(!a)return!1;Hr.isDataLayerVariable(a)?o=function(e,t){const i=t[Kr];if(!i)return;const n=e.variable.data_layer.name;if(!n)return;for(let e=i.length-1;e>=0;e--){const t=ri(i[e],n,void 0);if(t)return t}return}(a,e):Hr.isQueryParameterVariable(a)?o=function(e,t){const i=t.getAllQueryParams();if(0===Object.keys(i).length)return;const n=e.variable.query.key;if(!n)return;return i[n]}(a,t):Hr.isJavaScriptVariable(a)?o=function(e,t){const i=e.variable.global_variable.name;if(!i)return;const n=ri(t,i,void 0);if(n)return n;return}(a,e):Hr.isCustomFunction(a)&&(o=function(e){const t=e.variable.custom_function.body;if(!t)return;let i,n;try{i=new Function(t)}catch(e){return}try{n=i()}catch(e){return}return n}(a));const c={};return void 0!==o&&(c[s]=o),i(c,s,r.constraint)}catch(e){return!1}}))}}(Qr||(Qr={}));class Yr{static matches(e,t){return!t.enabled||!(t.from_date&&t.from_date>e)&&!(t.to_date&&t.to_date<e)}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Jr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Zr={exports:{}};Zr.exports=no;var Xr=Zr.exports.isMobile=no;Zr.exports.default=no;const eo=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,to=/CrOS/,io=/android|ipad|playbook|silk/i;function no(e){e||(e={});let t=e.ua;if(t||"undefined"==typeof navigator||(t=navigator.userAgent),t&&t.headers&&"string"==typeof t.headers["user-agent"]&&(t=t.headers["user-agent"]),"string"!=typeof t)return!1;let i=eo.test(t)&&!to.test(t)||!!e.tablet&&io.test(t);return!i&&e.tablet&&e.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==t.indexOf("Macintosh")&&-1!==t.indexOf("Safari")&&(i=!0),i}class ro{static matches(e,t){if(!e)return!0;const i=Xr({ua:t,tablet:!0,featureDetect:!0});return"mobile"===e.type?i:"desktop"!==e.type||!i}}class oo{static matches(e,t,i,n,r,o){if(!n||!i.isStorageAvailable("localStorage"))return!0;const s=o+r,a=t.getStoredTimestamp(s+"_last_show"),c=t.getStoredTimestamp(s+"_last_interaction"),u=e.getLastSessionStart();switch(n){case"only_once":return!a;case"until_visitor_interacts":return!c;case"once_per_visit":return!a||!u||a<u}return!0}}var so,ao,co;function uo(e,t,i){return`${e}${i?" "+i:""} was filtered out by ${t} filter`}function lo(e,t){return(i,n)=>function(e,t,i,n){return r=>{const o=n(r);return o||t.log(uo(e,i,"_id"in r?r._id:void 0),r),o}}(e,t,i,n)}function ho(){let e=!1;return{initialize(){},track(){},trackLink(){},identify(){},update(){},anonymize(){},loadDependency:window[u].loadDependency.bind(window[u]),notifications:{isAvailable:e=>(null==e||e(!0),!0),isSubscribed:t=>(t(e,!1),e),subscribe(t){setTimeout((()=>{e=!0,t(ao.Subscribed)}),500)},unsubscribe(t){setTimeout((()=>{e=!1,t(ao.Unsubscribed)}),500)}}}}!function(e){e.WebLayer="Weblayer",e.Experiment="Experiment",e.ManagedTag="Managed tag"}(so||(so={})),function(e){e.Error="error",e.PermissionDenied="permission-denied",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.Default="default",e.Unsupported="unsupported"}(ao||(ao={}));class po{static matches(e,t){if("page"in t)return this.matchesURLFilter(e,t.page);if(t.exclude_pages)for(const i of t.exclude_pages)if(this.matchesURLFilter(e,i))return!1;if(t.include_pages)for(const i of t.include_pages)if(this.matchesURLFilter(e,i))return!0;return!1}static parseURL(e){const t={source:e};let i;const n=/^(.{1,5}?):\/\//;var r,o,s,a,c,u;(i=n.exec(e))&&(t.protocol=i[1],e=e.replace(n,"")),o="//",r=ei(r=e),s=null==s?0:(a=Qn(s),c=0,u=r.length,a==a&&(void 0!==u&&(a=a<=u?a:u),void 0!==c&&(a=a>=c?a:c)),a),o=Xt(o),r.slice(s,s+o.length)==o&&(e=e.substr(2));const l=/(.*?)(\/|$)/;if(i=l.exec(e)){const n=i[1].split(":");""!==n[0]&&(t.host=n[0]),n.length>1&&(t.port=n[1]),e=e.replace(l,"/")}const h=/(.*?)(\?|$|#)/;(i=h.exec(e))&&(t.path=i[1],e=e.replace(h,i[2]));const d=/^\?(.*?)($|#)/;(i=d.exec(e))&&(t.query=i[1],e=e.replace(d,i[2]));if((i=/^#(.*)/.exec(e))&&(t.hash=i[1]),t.withoutHost=t.path,t.query&&(t.withoutHost+=`?${t.query}`),t.hash&&(t.withoutHost+=`#${t.hash}`),t.host){const e=t.port?`:${t.port}`:"";t.withoutProtocol=`//${t.host}${e}${t.withoutHost}`}return t}static escapeRegex(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}static wildcardToRegex(e){const t=("^"+this.escapeRegex(e)+"$").replace(new RegExp("\\\\\\*","g"),".*");return new RegExp(t)}static matchesExactURL(e,t){const i=this.parseURL(e),n=this.parseURL(t);return!(n.host||!n.withoutHost||!i.withoutHost||!i.withoutHost.match(this.wildcardToRegex(n.withoutHost)))||(!(n.protocol||!n.withoutProtocol||!i.withoutProtocol||!i.withoutProtocol.match(this.wildcardToRegex(n.withoutProtocol)))||!!i.source.match(this.wildcardToRegex(n.source)))}static matchesContainsURL(e,t){return lr(e,t)}static matchesRegexURL(e,t){try{const i=new RegExp(t);if(e.match(i))return!0;const n=this.parseURL(e);return!(!n.withoutProtocol||!n.withoutProtocol.match(i))||!(!n.withoutHost||!n.withoutHost.match(i))}catch(e){if(e instanceof Error)return!1;throw e}}static matchesURLFilter(e,t){return"any"===t.type||("exact"===t.type?this.matchesExactURL(e,t.url):"contains"===t.type?this.matchesContainsURL(e,t.url):"regex"===t.type&&this.matchesRegexURL(e,t.regex))}}class go{constructor(e,t,i,n,r,o,s,a,c,u,l,h,d,p,g){this.reporter=e,this.config=t,this.queue=i,this.timestamp=n,this.ping=r,this.modifications=o,this.experimentsEditor=s,this.tracker=a,this.location=c,this.debug=u,this.documentContentLoaded=l,this.storageUtils=h,this.newExperiments=d,this.url=p,this.window=g,this.applyingExperimentsInProgress=!1,this.experimentRevertFunctions=[]}applyExperimentModificationsAndTrackEvent(e,t=!0){var i;let n;try{n=this.modifications.applyModifications(e)}catch(e){return this.debug.error("Error applying experiment",e),()=>{}}this.experimentRevertFunctions.push(n);const r=(new Date).getTime();return this.timestamp.storeTimestamp(s+(null===(i=null==e?void 0:e.params)||void 0===i?void 0:i.experiment_id)+"_last_show",r),t&&this.tracker.track("experiment",{action:"show",experiment_id:e.params.experiment_id,experiment_name:e.params.experiment_name,variant_id:e.params.variant_id,variant_name:e.params.variant_name,location:window.location.href,path:window.location.pathname}),n}revertExistingExperiments(){for(const e of this.experimentRevertFunctions)try{e()}catch(e){this.debug.error("Error from revert experiment script",e)}this.experimentRevertFunctions=[]}loadFlickeringExperimentsScript(e){this.newExperiments.areAlreadyApplied()?this.debug.log("Not applying experiments with the SDK because new_experiments are enabled."):(this.queue.enqueue({httpMethod:void 0,noBulk:!0,name:Rr.Internal,action:()=>{fo(e,this.config)},prepareData:()=>{},processResponse:()=>{},processError:()=>{}}),e.promise.then((()=>{this.config.isSpaReloadingEnabled("experiments")&&this.url.onChange("onUrlChangeFilterAndApplyExperiments",(()=>window[k].reset()))})))}processDefinition(e,t){this.newExperiments.areAlreadyApplied()?this.debug.log("Not applying experiments with the SDK because new_experiments are enabled."):(this.debug.log("Processing experiments...",e),this.filterAndApplyExperiments(e,t),this.config.isSpaReloadingEnabled("experiments")&&this.url.onChange("onUrlChangeFilterAndApplyExperiments",(()=>this.filterAndApplyExperiments(e,t))))}applyExperiment(e){if(!this.filterByCustomCondition(e))return void this.debug.log(uo(so.Experiment,e.params.experiment_id,"custom condition"));this.debug.log(`Applying experiment ${e.params.experiment_id}...`,e);const t=this.applyExperimentModificationsAndTrackEvent(e,!0);this.experimentRevertFunctions.push(t)}filterAndApplyExperiments(e,t){if(this.applyingExperimentsInProgress)return;this.revertExistingExperiments();const i=this.filterExperimentsForCustomer(e,t);0!==i.length&&(this.applyingExperimentsInProgress=!0,this.queryAndApplyExperimentsModifications(i))}filterExperimentsForCustomer(e,t){const i=lo(so.Experiment,this.debug),n=Tr(this.debug);return e.filter(i("page",(e=>po.matches(this.location.href,e.trigger)))).filter(i("date",(e=>Yr.matches(this.timestamp.getTimestamp(),e.date_filter)))).filter(i("device",(e=>ro.matches(e.device_target)))).filter(i("frequency",(e=>oo.matches(this.ping,this.timestamp,this.storageUtils,e.frequency,e._id,s)))).filter(i("conditions",(e=>{var i;return Qr.matches(this.window,this.url,n,t,null===(i=e.variables_target)||void 0===i?void 0:i.conditions)})))}queryAndApplyExperimentsModifications(e){const t=e.map((e=>e._id));let i=Zn(this.config.getOptions().customer);this.queue.enqueue({name:Dr.ExperimentsShow,noBulk:!0,prepareData:()=>(this.debug.debug("Get filtered experiments by IDs",t),i&&i.cookie||(i=Zn(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:i,personalisation_ids:t}}),processResponse:e=>{this.applyExperimentsModifications(e.data)},processError:()=>{this.applyingExperimentsInProgress=!1}})}applyExperimentsModifications(e){this.debug.log("Applying experiments..."),this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{e.forEach((e=>{this.applyExperiment(e)})),this.applyingExperimentsInProgress=!1}))}filterByCustomCondition(e){if(!e.custom_condition||this.experimentsEditor.isEditorRunning())return!0;try{return!!this.setupCustomConditionScriptFunction(e.params,e.custom_condition)()}catch(t){return this.debug.error(`Custom condition for experiment ${e.params.experiment_id} threw an error`,t),!1}}setupCustomConditionScriptFunction(e,t){const i={};i.inPreview=this.experimentsEditor.isEditorRunning(),i.sdk=i.inPreview?ho():window[u],i.data=i.params=e;let n=t;n.length>0&&n.indexOf("\n")<0&&n.indexOf(";")<0&&n.indexOf("return")<0&&(n="return "+n);const r=new Function(n).bind(i);return r.context=i,r}}function fo(e,t){const i=t.getOptions();i.customer.cookie||e.reject(new Error("Can't load flickering experiments - missing cookie."));const n=encodeURIComponent(window.location.href.split("#")[0]),r="webxpClient",o=t.getToken(),s=`${i.target}/webxp/script-async/${o}/${i.customer.cookie}/modifications.min.js?http-referer=${n}`;window[r].skipExperiments=!0,window[r].legacyFlickeringMode=!0,window[r].sdk=window.exponea,window[r].sdkObjectName=u,window[r].sign=`${o}/${i.customer.cookie}`,window[r].path=i.target;const a=document.createElement("script");a.src=s,a.onload=()=>e.resolve(!0),a.onerror=t=>e.reject(t);const c=document.getElementsByTagName("script")[0];c&&c.parentNode&&c.parentNode.insertBefore(a,c)}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[Object,Object]),mi("design:returntype",void 0)],go.prototype,"applyExperimentModificationsAndTrackEvent",null),fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],go.prototype,"revertExistingExperiments",null),fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],go.prototype,"applyExperiment",null);class mo{constructor(e,t,i,n,r,o,s,a){this.http=e,this.config=t,this.location=i,this.document=n,this.history=r,this.window=o,this.debug=s,this.storageUtils=a,this.urlParamsMatch=null,this.urlParamsMatchBase64=null}matchUrlWithParams(){this.urlParamsMatch=this.location.href.match("(#|\\?)?exponea-editor-params=((%7B|{).*(%7D|}))"),this.urlParamsMatchBase64=this.location.href.match("(?:#|\\?)?exponea-editor-params=([a-zA-Z0-9-_=]+)")}areEditorParamsInURL(){return!!this.urlParamsMatch||!!this.urlParamsMatchBase64}placeParamsFromURLToStorage(){let e="";if(this.urlParamsMatch&&(e=decodeURIComponent(this.urlParamsMatch[2])),this.urlParamsMatchBase64){const t=this.urlParamsMatchBase64[1].replace(/-/g,"+").replace(/_/g,"/");e=atob(t)}e&&(this.storageUtils.writeToStorage("sessionStorage",b,e)||this.debug.warn("The editor is not supported in this browser"))}removeParamsFromURL(){let e="";this.urlParamsMatch&&(e=this.urlParamsMatch[0]),this.urlParamsMatchBase64&&(e=this.urlParamsMatchBase64[0]),e&&(this.history&&this.history.replaceState?this.history.replaceState(null,this.document.title,this.location.href.replace(e,"")):this.location.href=this.location.href.replace(e,""))}shouldStartEditor(){return!!this.storageUtils.readStringFromStorage("sessionStorage",b)}bootstrapEditor(){return this.isEditorRunning()?(this.debug.log("The editor is already running"),Promise.resolve()):this.location.host.indexOf("localhost")>=0?(this.debug.log("Auto-launching of the editor is disabled in development environments"),Promise.resolve()):this._waitForPageToLoad().then((()=>{this._insertEditorLoadingElement();const e=this._insertEditorIframe();return this.http.get(this.config.getOptions().target+"/editor/index.html?timestamp="+(new Date).getTime(),{responseType:"text"}).then((e=>e.body)).then((t=>{if(e){const i=t.replace(/base\shref=".*"/,`base href="${this.config.getOptions().target}${v}"`);e.srcdoc=i}else this.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((()=>this.http.get(this.config.getOptions().target+"/editor/version.txt?timestamp="+(new Date).getTime(),{responseType:"text"}).then((t=>{const i=t.body.trim();this.debug.log(`Fetching editor version ${i}`);const n=w.map((e=>`<script type="text/javascript" src="${this.config.getOptions().target+v+i+`/${e}.js`}"><\/script>`)).join();e?e.srcdoc=`<html><head><title>Exponea Web Optimization Editor</title><meta charset="utf-8"></head><body>${n}</body></html>`:this.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((e=>this.debug.error("Failed to fetch the editor version",e)))))}))}_waitForPageToLoad(){return new Promise((e=>{this.document.body?e():this.window.addEventListener("load",(()=>e()))}))}isEditorRunning(){return!!this.document.getElementById(y)}_insertEditorLoadingElement(){this.debug.log("Inserting experiments editor loading element");const e=this.document.createElement("style");e.textContent=".exponea-loading-backdrop{margin:0;padding:0;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(87,91,154,.5);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;z-index:2147483642}.exponea-loading-icon{width:50px;height:50px;border:4px solid #ffd500;border-right-color:transparent;border-radius:50%;-webkit-animation:rotate .8s infinite linear;animation:rotate .8s infinite linear}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}";const t=this.document.createElement("div");t.innerHTML='<div class="exponea-loading-backdrop"><div class="exponea-loading-icon"></div></div>',this.document.head.appendChild(e),Se(t.childNodes,(e=>this.document.body.appendChild(e)))}_insertEditorIframe(){const e=this.document.createElement("div"),t=this.document.createElement("iframe");return e.id=y,e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.right="0",e.style.bottom="0",e.style.border="none",e.style.width="auto",e.style.height="auto",e.style.margin="0",e.style.padding="0",e.style.backgroundColor="transparent",e.style.zIndex="2147483647",t.src="about:blank",t.frameBorder="0",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="transparent",t.style.margin="0",t.style.padding="0",t.style.display="block",t.style.visibility="visible",this.document.body.appendChild(e),e.appendChild(t),t}}class bo{constructor(e,t,i,n){this.eventTracker=e,this.experimentsEditor=t,this.document=i,this.debug=n}applyModifications(e){const t=[];e.modifications=e.modifications||[];for(const i of e.modifications)switch(i.type){case"add":this._applyAddModification(i,t);break;case"remove":this._applyRemoveModification(i,t);break;case"change":this._applyChangeModification(i,t);break;case"run":this._applyRunModification(i,e.params,t);break;case"track":this._applyTrackModification(i,t);break;case"banner":this._applyBannerModification(i,e.params,t)}return()=>{return i=e=>e(),(H(e=t)?nr:or)(e,xe(i));var e,i}}_applyAddModification(e,t){const i=this.document.createElement("div");e.parametrized_parts?i.innerHTML=e.parametrized_parts.html:i.innerHTML=e.html;const n=[].slice.call(i.childNodes);let r;try{r=this.document.querySelector(e.place_to.element)}catch(t){return void this.debug.warn("Invalid selector, ignoring the add modification",e.place_to.element)}if(r)switch(e.place_to.placement){case"before":Se(n,(i=>{r.parentElement?(r.parentElement.insertBefore(i,r),t.push(this._revertInsertElement.bind(this,i))):this.debug.warn("Attempting to insert HTML before an element without a parent",e.place_to.element)}));break;case"after":Se(n,(i=>{r.parentElement?(r.parentElement.insertBefore(i,r.nextSibling),t.push(this._revertInsertElement.bind(this,i))):this.debug.warn("Attempting to insert HTML after an element without a parent",e.place_to.element)}));break;case"prepend_child":Se(n,(e=>{r.insertBefore(e,r.firstChild),t.push(this._revertInsertElement.bind(this,e))}));break;case"append_child":Se(n,(e=>{r.appendChild(e),t.push(this._revertInsertElement.bind(this,e))}))}else this.debug.warn("No element matched the selector, ignoring the add modification",e.place_to.element)}_applyRemoveModification(e,t){let i=[];try{const t=this.document.querySelectorAll(e.element);i=[].slice.call(t)}catch(t){return void this.debug.warn("Invalid selector, ignoring the remove modification",e.element)}0!==i.length?Se(i,(i=>{switch(e.method){case"visibility":t.push(this._revertHideElement.bind(this,i)),i.style.visibility="hidden";break;case"display":t.push(this._revertHideElement.bind(this,i)),i.style.display="none";break;case"remove":i.parentElement?(t.push(this._revertRemoveElement.bind(this,i,i.parentElement,i.nextElementSibling)),i.parentElement.removeChild(i)):this.debug.warn("Attempting to remove an element without a parent",e.element)}})):this.debug.warn("The selector matched no elements, ignoring the remove modification",e.element)}_applyChangeModification(e,t){let i=[];try{const t=this.document.querySelectorAll(e.element);i=[].slice.call(t)}catch(t){return void this.debug.warn("Invalid selector, ignoring the change modification",e.element)}if(0===i.length)return void this.debug.warn("The selector matched no elements, ignoring the change modification",e.element);let n=[];if(e.place_to){try{const t=this.document.querySelectorAll(e.place_to.element);n=[].slice.call(t)}catch(t){return void this.debug.warn("Invalid container selector, ignoring the change modification",e.place_to.element)}if(0===n.length)return void this.debug.warn("The container selector matched no elements, ignoring the change modification",e.place_to.element);if(n.length!==i.length)return void this.debug.warn("The container selector matched a different number of elements then the source selector")}Se(i,((i,r)=>{if(e.html){const n=this.document.createElement("div");n.innerHTML=e.html;const r=[].slice.call(n.childNodes),o=i.parentElement,s=i.nextElementSibling;o?(Se(r,(e=>{o.insertBefore(e,i),t.push(this._revertInsertElement.bind(this,e))})),o.removeChild(i),t.push(this._revertRemoveElement.bind(this,i,o,s))):this.debug.warn("Cannot replace an element's HTML without a parent",e.element)}if(e.text){const n=i.innerHTML;i.innerText=e.text,t.push(this._revertTextChange.bind(this,i,n))}if(e.place_to){const o=n[r];if(!i.parentElement)return void this.debug.warn("Attempting to move an element without a parent",e.element);switch(t.push(this._revertRemoveElement.bind(this,i,i.parentElement,i.nextElementSibling)),e.place_to.placement){case"before":o.parentElement?o.parentElement.insertBefore(i,o):this.debug.warn("Attempting to insert an element before a container without a parent",e.place_to.element);break;case"after":o.parentElement?o.parentElement.insertBefore(i,o.nextSibling):this.debug.warn("Attempting to insert an element after a container without a parent",e.place_to.element);break;case"prepend_child":o.insertBefore(i,o.firstChild);break;case"append_child":o.appendChild(i)}}e.attributes&&sr(e.attributes,((e,n)=>{const r=i.getAttribute(n);r&&!i.getAttribute(`data-original-${n}`)&&i.setAttribute(`data-original-${n}`,r),i.setAttribute(n,e),t.push(this._revertAttributeChange.bind(this,i,n))})),e.style&&sr(e.style,((e,n)=>{i.style.setProperty(n,e,"important"),t.push(this._revertStyleChange.bind(this,i,n))}))}))}_applyTrackModification(e,t){let i=[];try{const t=this.document.querySelectorAll(e.element);i=[].slice.call(t)}catch(t){return void this.debug.warn("Invalid selector, ignoring the change modification",e.element)}0!==i.length?i.forEach((i=>{const n=this._buildTrackClickEventListener(this.eventTracker,e);i.addEventListener("click",n),t.push(this._revertClickEventTracking.bind(this,i,n))})):this.debug.warn("The selector matched no elements, ignoring the change modification",e.element)}_applyRunModification(e,t,i){const n=this;function r(){let t=null;try{const i=n.document.querySelectorAll(e.element);t=[].slice.call(i)}catch(t){n.debug.log("Invalid selector but still applying run modification",e.element)}if(t&&0===t.length){if("once_per_element"===e.execute)return void n.debug.log("The selector of run modification matched no elements",e.element);n.debug.log("The selector matched no elements but still applying run modification",e.element)}try{"once_per_element"===e.execute?t&&t.forEach((e=>o([e]))):o(t)}catch(e){n.debug.error("The run modification script threw an error",e)}}function o(r){const o=yo(n._setupModificationScriptFunction(e,t,r),t.experiment_id,n.debug);me(o)?i.push(o):hn(o)&&i.push(o.remove.bind(o))}e.execute&&"document_ready"!==e.execute||"complete"===document.readyState?r():document.addEventListener("DOMContentLoaded",r)}_applyBannerModification(e,t,i){let n=null;try{const t=this.document.querySelectorAll(e.element);n=[].slice.call(t)}catch(t){this.debug.warn("Invalid selector but still applying banner modification",e.element)}n&&0===n.length&&this.debug.warn("The selector matched no elements but still applying banner modification",e.element);try{const r=this._setupModificationScriptFunction(e,t,n);e.parametrized_parts?(r.context.html=e.parametrized_parts.html,r.context.style=e.parametrized_parts.style):(r.context.html=e.html,r.context.style=e.style);const o=yo(r,t.experiment_id,this.debug);me(o)?i.push(o):hn(o)&&i.push(o.remove.bind(o))}catch(e){this.debug.error("The banner modification script threw an error",e)}}_buildTrackClickEventListener(e,t){return()=>{e.track(t.event_type,Object.assign({},t.event_properties))}}_revertInsertElement(e){e.parentElement?e.parentElement.removeChild(e):this.debug.warn("Cannot remove an inserted element without a parent")}_revertHideElement(e){e.style.removeProperty("visibility"),e.style.removeProperty("display")}_revertRemoveElement(e,t,i){t?t.insertBefore(e,i):this.debug.warn("Cannot re-insert a removed element without a parent")}_revertClickEventTracking(e,t){e.removeEventListener("click",t)}_revertAttributeChange(e,t){const i=e.getAttribute(`data-original-${t}`);i&&(e.setAttribute(t,i),e.removeAttribute(`data-original-${t}`))}_revertStyleChange(e,t){e.style.removeProperty(t)}_revertTextChange(e,t){e.innerHTML=t}_setupModificationScriptFunction(e,t,i){const n={};n.inPreview=this.experimentsEditor.isEditorRunning(),n.sdk=n.inPreview?ho():window[u],n.data=n.params=t,i&&i.length>0?(n.element=i[0],n.elements=i):(n.element=null,n.elements=[]),n.selector=e.element;const r="parametrized_parts"in e?e.parametrized_parts.script:e.script;let o;try{o=new Function(r).bind(n),o.context=n}catch(e){throw this.debug.error(`Syntax error in the experiment javascript code.\n\nThis is not an SDK error but rather an error in the experiment ${t.experiment_id}\njavascript code. Check the experiment code for syntax errors, such errors are\nusually highlighted in the UI. The first line of the stack trace below should\ngive you a clue.\n\n`,e),e}return o}}function yo(e,t,i){try{return e()}catch(e){throw i.error(`Error when executing a modification javascript code.\n\nThis is not an SDK error but rather an error in the experiment ${t}\njavascript code. Check the web layer javascript code for errors. This is not\na syntax error and may be hard to spot, but the first line of the stack trace\nbelow should give you a clue.\n\n`,e),e}}!function(e){e.ep3_use_new_experiments="ep3_use_new_experiments",e.ewx_279_invalid_integration_monitor="ewx_279_invalid_integration_monitor"}(co||(co={}));const vo=Object.freeze({[co.ep3_use_new_experiments]:!1,[co.ewx_279_invalid_integration_monitor]:!1});class wo{get flags(){return this.flagConfig}constructor(e,t,i=vo,n="eyJleHA3MjhfcmVtb3ZlX3dlYnhwX2NvbmZpZ19mcm9tX2FzeW5jX2FwaSI6IHRydWUsICJld3hfMjc5X2ludmFsaWRfaW50ZWdyYXRpb25fbW9uaXRvciI6IHRydWV9Cg=="){this.debug=e,this.window=t;try{this.flagConfig=Object.freeze(Object.assign(Object.assign({},i),function(e,t,i,n){const r=e.match(/^%%%%.+%%%%$/)?"e30=":e,o=JSON.parse(n.atob(r)),s={};return sr(o,((e,n)=>{n in t?"boolean"==typeof e?s[n]=e:i.error(`Incorrect value '${e}' for feature flag '${n}', expected a boolean but received '${typeof e}'`):i.error(`Feature '${n}' is not a feature flag supported by this SDK version`)})),s}(n,i,this.debug,this.window)))}catch(e){this.debug.error("Failed to parse feature flags",e),this.flagConfig=Object.freeze(i)}this.debug.debug("Initialized feature flags",this.flags)}setFlags(e){this.flagConfig=Object.freeze(Object.assign(Object.assign({},this.flagConfig),e)),this.debug.debug("Overwritten feature flags",this.flags)}}class ko{constructor(e,t,i,n){this.config=e,this.debug=t,this.documentContentLoaded=i,this.queue=n}getHtml(e,t){this.queue.enqueue({name:Dr.HtmlGet,noBulk:!0,prepareData:()=>(this.debug.log("Get html: ",e),{data:{company_id:this.config.getToken(),customer_ids:this.config.getOptions().customer,html_campaign_name:e}}),processResponse:e=>{Lr((()=>{t(e.data)}))}})}showHtml(e,t){this.getHtml(t,(t=>{""!==t&&this.documentContentLoaded.whenLoaded().then((()=>{const i=pi(e);for(let e=0;e<i.length;e++)i[e].innerHTML=t}),(e=>{this.debug.error("Failed to show HTML",e)}))}))}}var _o;!function(e){e[e.Fetch=0]="Fetch"}(_o||(_o={}));class xo extends Error{constructor(e){super(),this.response=e}}class So{constructor(e=e){this.window=e,this.type=_o.Fetch,this.fetch=(e,t)=>this.window.fetch(e,t)}static isSupported(){if(!XMLHttpRequest)return!1;return"withCredentials"in new XMLHttpRequest}post(e,t,i){return this.fetch(e,Object.assign(Object.assign({},i),{headers:Object.assign({Accept:"application/json"},i.headers||{}),method:"POST",body:JSON.stringify(t),credentials:i.credentials?i.credentials:"include"})).then(Eo).then(To)}get(e,t){return this.fetch(e,{headers:Object.assign({Accept:"application/json"},t.headers||{}),method:"GET"}).then(Eo).then(To)}}function Eo(e){const{status:t}=e;return{json:function(){return i().then((e=>{try{return JSON.parse(e)}catch(t){return e}}))},text:i,status:t};function i(){return e.text()}}function To(e){if(e.status>=200&&e.status<300)return e;throw new xo(e)}class Co extends Error{constructor(e){super(e.message),this.name="HttpNetworkError"}}class Ao extends Error{constructor(e){super(function(e){const{body:t}=e;if("string"==typeof t)return t;return JSON.stringify(t)}(e)),this.name="HttpServerError",this.response=e}}const Oo={responseType:"json"};class Po{constructor(e){So.isSupported()&&(this.transport=new So(e))}hasTransport(){return void 0!==this.transport}get(e,t=Oo){if(t=En({},t,Oo),void 0===this.transport)throw new Error("Can't do a get request since no http transport is available!");return this.transport.get(e,t).catch(Lo(t)).then(jo(t))}post(e,t,i=Oo){if(i=En({},i,Oo),void 0===this.transport)throw new Error("Can't do a post request since no http transport is available!");return this.transport.post(e,t,i).catch(Lo(i)).then(jo(i))}}function jo(e){return function(t){return function(e,t){if("text"===e)return t.text();return t.json()}(e.responseType,t).then((e=>{const{status:i}=t;return{body:e,status:i}}))}}function Lo(e){return function(t){return t instanceof xo?function(e,t){const i=jo(t);return i(e.response).then((e=>Promise.reject(new Ao(e))))}(t,e):t instanceof TypeError?Promise.reject(new Co(t)):Promise.reject(t)}}var Io;function Bo(e){return new Promise(((t,i)=>{e.execute({name:Dr.WebOptimization,noBulk:!0,httpMethod:Io.get,processResponse(e){t(e)},processError:e=>{i(e)}})}))}function Fo(e,t){const i=e.getOptions();return!1!==i.webOptimization&&!(i.webOptimization&&!1===i.webOptimization[t])}function zo(e){let t,i;const n=new Promise(((e,n)=>{t=e,i=n}));return t&&i?(n.catch((t=>{e.debug("Handling promise rejection",t)})),{promise:n,resolve:t,reject:i}):(e.error("Error building promise remote: Promise executor has not been called synchronously"),{promise:Promise.reject(),resolve:()=>{},reject:()=>{}})}function Do(e){const t=e[u];return t?t[m]?t[m]:t.start?"v2.0.0":"v1.0.0":"v0.0.0-unknown"}!function(e){e[e.post=0]="post",e[e.get=1]="get"}(Io||(Io={}));class Ro extends Error{constructor(e){super(e)}}class Mo{constructor(e,t,i,n,r,o,s,a,c,u,l,h,d,p,g,f,m,b,y,v,w,k,_,x,S,E,T,C=Bo){this.reporter=e,this.debug=t,this.config=i,this.time=n,this.cookies=r,this.ping=o,this.customer=s,this.userActivityTracking=a,this.experimentsEditor=c,this.experiments=u,this.webLayers=l,this.managedTags=h,this.campaignClicks=d,this.eventTracker=p,this.queryTracking=g,this.window=f,this.unloader=m,this.initializeState=b,this.queue=y,this.pushWebApi=v,this.pushSafariApi=w,this.transferIdentity=k,this.http=_,this.logger=x,this.newExperiments=S,this.featureFlags=E,this.browserExtension=T,this.getDefinitions=C,this.webxpClientReadyRemote=zo(this.logger),this.initializeCookieLinked=zo(this.logger)}get isWebxpClientReady(){return this.webxpClientReadyRemote.promise}initialize(e){if(!this.http.hasTransport())return void this.logger.warn(`${u} sdk won't be initialized because no supported HTTP transport method was found in this browser!`);if(this.initializeState.isInitializing())return void this.debug.log("The SDK is already being initialized");if(this.initializeState.isInitialized())return void this.debug.log("The SDK is already initialized");this.debug.log("Starting to initialize the SDK"),this.debug.log("Checking the cookie first"),this.debug.log("attempting to get cookie from browser");let t=this.cookies.getCookie(i);const n=this.window[k];if(n&&n.skipExperiments){if(!t&&(this.debug.log("The SDK does not have a cookie yet, communicating with webxp client to get one"),e&&!n.init)){if("boolean"==typeof e)throw new Ro("Invalid type of argument 0 - initialize, expected object but got boolean");return this.storedOptions=e,this.window.setTimeout(this.initialize.bind(this,!1),500),void this.debug.log("Initialization was postponed until the modifications script loads")}if(!e){if(!this.storedOptions)return;e=this.storedOptions}if(!t){if("boolean"==typeof e)throw new Ro("Invalid type of argument 0 - initialize, expected object but got boolean");if(n.config&&n.config.cookie){let i=this.config.getOptions().cookies.cross_subdomain;e&&e.cookies&&void 0!==e.cookies.cross_subdomain&&(i=e.cookies.cross_subdomain),this.config.extendOptions({cookies:{cross_subdomain:i}}),t=n.config.cookie,this.cookies.setTrackingCookie(t)}}}if("boolean"==typeof e)throw new Ro("Invalid type of argument 0 - initialize, expected object but got boolean");if(this.debug.log('Webxp client communication handled, continuing with initialization - SDK is marked as "initializing" now'),!ar(e.token))throw new Ro("Invalid type of project token, expected string but got "+typeof e.token);if(""===e.token)throw new Ro("Invalid value of project token, the token cannot be an empty string");if(this.isComplianceConfigurationChanged(e))throw new Ro("It is disallowed to change `compliance` configuration during SDK initialization. Please set the `compliance` option in the snippet");this.errorReportInitialize(e,t)}extendOptions(e){"boolean"!=typeof e&&this.config.extendOptions({token:e.token,target:e.target,compliance:e.compliance})}errorReportInitialize(t,i){const n=Date.now();this.preProcessCustomerIds(t),this.config.extendOptions(t);const r=this.config.getOptions();try{this.initializeState.markInitializing(),this.browserExtension.initialize(),this.browserExtension.sendPayload({type:"versions",sdkVersion:e,snippetVersion:Do(this.window)}),this.browserExtension.sendPayload({type:"config",config:t});(!0===r.compliance.opt_in||!0===r.compliance.opt_in.new_customer_profile)&&(i=this.cookies.setFreshTrackingCookie(),this.config.setNewCustomerIds({cookie:i}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:i}})),this.cookies.sanitizeCookieOptions(),r.feature_flags&&this.featureFlags.setFlags(r.feature_flags),this.experimentsEditor.matchUrlWithParams(),this.experimentsEditor.areEditorParamsInURL()&&(this.experimentsEditor.placeParamsFromURLToStorage(),this.experimentsEditor.removeParamsFromURL()),this.time.queryTime(),this.pushWebApi.initialize(),i&&(this.config.extendOptions({customer:Object.assign(Object.assign({},r.customer),{cookie:i})}),this.debug.log("cookie retrieved from browser: "+i),Lr((()=>{me(r.cookies.retrieve_callback)&&(r.cookies.retrieve_callback(i),r.cookies.retrieve_callback=null)})));const n=r.transfer_identity?this.transferIdentity.getTransferIdentityFirstClickToken():void 0;if(this.customer.requestCustomerIdsFromServer({cookie:i,tifc:n},(e=>{this.browserExtension.sendPayload({type:"ids",ids:e}),i||Lr((()=>{me(r.cookies.retrieve_callback)&&(r.cookies.retrieve_callback(e.cookie),r.cookies.retrieve_callback=null)})),n&&r.link_cookie&&Lr((()=>{this.executeLinkCookies(r.link_cookie)}))})),r.transfer_identity&&(this.debug.log("transferring identity from URL"),this.config.extendOptions({customer:Object.assign(Object.assign({},r.customer),this.transferIdentity.getCustomerIdentityFromUrl())})),this.experimentsEditor.shouldStartEditor())return!this.config.getOptions().new_experiments&&this.featureFlags.flags.ep3_use_new_experiments&&fo(this.webxpClientReadyRemote,this.config),void this.experimentsEditor.bootstrapEditor();r.track&&r.track.google_analytics&&this.customer.identifyCustomerWithGoogleAnalyticsId(),this.userActivityTracking.trackExitsWithDataAttribute(),this.campaignClicks.parseUrlAndTrackCampaignClick(),r.ping&&(r.ping.enabled||r.lazy_merge)||this.customer.identifyCustomer(r.customer),!n&&r.link_cookie&&Lr((()=>{this.executeLinkCookies(r.link_cookie)})),r.link_cookie||(this.featureFlags.flags.ep3_use_new_experiments?Lr((()=>{this.executeLinkCookies(r.link_cookie)})):this.initializeCookieLinked.reject()),this.ping.setOptions(this.config.getOptions().ping),this.ping.restartPinging(),this.userActivityTracking.startActivityTracking(),this.eventTracker.trackPageVisitEventIfEnabled(),this.queryTracking.initialize(),this.reporter.reportPromiseError(this.getDefinitions(this.queue)).then((e=>{this.featureFlags.flags.ep3_use_new_experiments?function(e,t,i,n,r,o,s){Fo(e,"experiments")&&!e.getOptions().new_experiments&&s.promise.finally((()=>{i.loadFlickeringExperimentsScript(o)})),Fo(e,"webLayers")&&t.processDefinition(r.webLayers,r.vars),Fo(e,"tagManager")&&n.processDefinition(r.constantManagedTags)}(this.config,this.webLayers,this.experiments,this.managedTags,e,this.webxpClientReadyRemote,this.initializeCookieLinked):function(e,t,i,n,r){Fo(e,"experiments")&&t.processDefinition(r.experiments,r.vars),Fo(e,"webLayers")&&i.processDefinition(r.webLayers,r.vars),Fo(e,"tagManager")&&n.processDefinition(r.constantManagedTags)}(this.config,this.experiments,this.webLayers,this.managedTags,e)})),Fo(this.config,"experiments")&&this.newExperiments.initialize(),Fo(this.config,"tagManager")&&this.managedTags.queryNonConstantManagedTagsAndShowOnUrlChange(),this.unloader.initialize(),this.pushSafariApi.handleDeniedSubscription(),this.ping.initializeWebUnloadTracking(),this.debug.log('The SDK initialization is finished, SDK is marked as "initialized" now'),this.initializeState.markInitialized()}catch(e){if(this.queue.clear(),this.initializeState.markFailedInitialization(),e instanceof Ro)throw e;this.debug.error(e),this.reporter.sendErrorReport(e,"initialize",n)}}preProcessCustomerIds(e){"number"!=typeof e.customer&&"string"!=typeof e.customer||(e.customer={registered:e.customer}),e.customer&&("cookie"in e.customer&&delete e.customer.cookie,e.customer=this.customer.filterEmptyCustomerIds(e.customer),this.config.extendOptions(e))}isComplianceConfigurationChanged(e){const t=e.compliance;if(void 0===t)return!1;const i=this.config.getOptions().compliance;return!Bt(t,i)}executeLinkCookies(e){let t=()=>{},i=()=>{};"object"==typeof e&&me(e.link_cookie_initialize_success)&&(t=e.link_cookie_initialize_success,me(e.link_cookie_initialize_error)&&(i=e.link_cookie_initialize_error)),this.customer.linkCustomerIds(((...e)=>{t(...e),this.initializeCookieLinked.resolve(!0)}),((...e)=>{i(...e),this.initializeCookieLinked.reject()}))}}class No{constructor(){this.initializing=!1,this.initialized=!1,this.initializedPromiseResolve=()=>{},this.initializedPromiseReject=()=>{},this.initializedPromise=new Promise(((e,t)=>{this.initializedPromiseResolve=e,this.initializedPromiseReject=t}))}markInitializing(){this.initializing=!0,this.initialized=!1}markInitialized(){this.initializing=!1,this.initialized=!0,this.initializedPromiseResolve()}markFailedInitialization(){this.initializing=!1,this.initialized=!1,this.initializedPromiseReject()}isInitializing(){return this.initializing}isInitialized(){return this.initialized}whenInitialized(){return this.initializedPromise}}const Uo="sendBeacon"in navigator;var qo;!function(e){e[e.Ready=0]="Ready",e[e.Sending=1]="Sending",e[e.Sent=2]="Sent"}(qo||(qo={}));class Wo{constructor(e,t,i,n,r=Uo){this.reporter=e,this.debug=t,this.eventTracker=i,this.eventTypeAndPropertiesGetter=n,this.isSendBeaconSupported=r,this.EVENT_TRIGGERED_DEADLINE=300,this.phase=qo.Ready,this.lockedUntil=0,this.timeoutID=void 0}trackClick(e){const t=e.target,i=this.eventTypeAndPropertiesGetter(t);this.isSendBeaconSupported?this._trackClickWithBeacon(i):(this.phase===qo.Ready&&(e.preventDefault(),e.stopImmediatePropagation()),this._trackClickWithoutBeacon(t,i))}_trackClickWithBeacon({type:e,properties:t}){this.eventTracker.track(e,t)}_trackClickWithoutBeacon(e,{type:t,properties:i}){if(this.phase===qo.Ready){const n=this.reporter.reportError((()=>{e.click()}),"click");if((new Date).getTime()<this.lockedUntil)return void this.debug.log("Ignoring apparent duplicate click");this.phase=qo.Sending,this.timeoutID=setTimeout((()=>{this.debug.log("Click timed out"),this.phase===qo.Sending&&n()}),this.EVENT_TRIGGERED_DEADLINE),this.eventTracker.track(t,i,{successCallback:()=>{this.debug.log("Click tracked successfully"),clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=qo.Sent,n()},errorCallback:()=>{this.debug.error("Cannot connect to server."),clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=qo.Sent,n()}})}else this.phase===qo.Sending?(clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=qo.Ready,this.lockedUntil=(new Date).getTime()+500):this.phase===qo.Sent&&(this.phase=qo.Ready,this.lockedUntil=(new Date).getTime()+500)}}class $o{constructor(e,t,i,n){this.reporter=e,this.eventTracker=t,this.debug=i,this.documentContentLoaded=n}trackLink(e,t,i){const n=new Wo(this.reporter,this.debug,this.eventTracker,(e=>{if(me(t)){return t(e)}return{type:t,properties:i||{}}}));ar(e)?this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((function(){const t=pi(e);for(let e=0;e<t.length;e++)t[e].onclick=e=>n.trackClick(e)})):e.onclick=e=>n.trackClick(e)}}function Ho(e,t,i){return"attachEvent"in e&&"function"==typeof e?e.attachEvent("on"+t,i):e.addEventListener(t,i,!1)}class Vo{constructor(e,t){this.reporter=e,this.document=t,this._liveEventListeners={click:[],submit:[]}}initialize(){this._registerLiveEventListener("submit"),this._registerLiveEventListener("click")}_handleLiveEventListeners(e,t){e.forEach((e=>{try{pi.matchesSelector(t.target,e.selector)&&e.callback(t)}catch(e){if(!(e instanceof Error))throw e}}))}addLiveEventListener(e,t,i){this._liveEventListeners[e].push({selector:t,callback:i})}clearLiveEventListeners(){this._liveEventListeners={click:[],submit:[]}}_registerLiveEventListener(e){Ho(this.document,e,(t=>this._handleLiveEventListeners(this._liveEventListeners[e],t)))}}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],Vo.prototype,"initialize",null),fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[Array,Event]),mi("design:returntype",void 0)],Vo.prototype,"_handleLiveEventListeners",null);class Go{constructor(e,t){this.console=e,this.logPrefix=t}getMessagePrefix(){const e=(new Date).toUTCString();return`${this.logPrefix} [${e}]`}error(...e){this.print("error",e)}log(...e){this.print("log",e)}warn(...e){this.print("warn",e)}debug(...e){this.print("debug",e)}print(e,t){this.isConsoleSupported(e)&&0!==t.length&&("string"==typeof t[0]?t[0]=`${this.getMessagePrefix()} ${t[0]}`:t.unshift(this.getMessagePrefix()),this.console[e](...t))}isConsoleSupported(e){return void 0!==this.console&&"function"==typeof this.console[e]}}var Ko={exports:{}};
/**
     * @file postscribe
     * @description Asynchronously write javascript, even with document.write.
     * @version v2.0.8
     * @see {@link https://krux.github.io/postscribe}
     * @license MIT
     * @author Derek Brans
     * @copyright 2016 Krux Digital, Inc
     */!function(e,t){var i;i=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){var n,r=i(1),o=(n=r)&&n.__esModule?n:{default:n};e.exports=o.default},function(e,t,i){t.__esModule=!0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};t.default=f;var r,o=i(2),s=(r=o)&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(4));function c(){}var u={afterAsync:c,afterDequeue:c,afterStreamStart:c,afterWrite:c,autoFix:!0,beforeEnqueue:c,beforeWriteToken:function(e){return e},beforeWrite:function(e){return e},done:c,error:function(e){throw new Error(e.msg)},releaseAsync:!1},l=0,h=[],d=null;function p(){var e=h.shift();if(e){var t=a.last(e);t.afterDequeue(),e.stream=g.apply(void 0,e),t.afterStreamStart()}}function g(e,t,i){(d=new s.default(e,i)).id=l++,d.name=i.name||d.id,f.streams[d.name]=d;var r=e.ownerDocument,o={close:r.close,open:r.open,write:r.write,writeln:r.writeln};function a(e){e=i.beforeWrite(e),d.write(e),i.afterWrite(e)}n(r,{close:c,open:c,write:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(t.join(""))},writeln:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(t.join("")+"\n")}});var u=d.win.onerror||c;return d.win.onerror=function(e,t,n){i.error({msg:e+" - "+t+": "+n}),u.apply(d.win,[e,t,n])},d.write(t,(function(){n(r,o),d.win.onerror=u,i.done(),d=null,p()})),d}function f(e,t,i){if(a.isFunction(i))i={done:i};else if("clear"===i)return h=[],d=null,void(l=0);i=a.defaults(i,u);var n=[e=/^#/.test(e)?window.document.getElementById(e.substr(1)):e.jquery?e[0]:e,t,i];return e.postscribe={cancel:function(){n.stream?n.stream.abort():n[1]=c}},i.beforeEnqueue(n),h.push(n),d||p(),e.postscribe}n(f,{streams:{},queue:h,WriteStream:s.default})},function(e,t,i){t.__esModule=!0;var n,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},o=i(3),s=(n=o)&&n.__esModule?n:{default:n},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(4));function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u="data-ps-",l="ps-style",h="ps-script";function d(e,t){var i=u+t,n=e.getAttribute(i);return a.existy(n)?String(n):n}function p(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=u+t;a.existy(i)&&""!==i?e.setAttribute(n,i):e.removeAttribute(n)}var g=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,e),this.root=t,this.options=i,this.doc=t.ownerDocument,this.win=this.doc.defaultView||this.doc.parentWindow,this.parser=new s.default("",{autoFix:i.autoFix}),this.actuals=[t],this.proxyHistory="",this.proxyRoot=this.doc.createElement(t.nodeName),this.scriptStack=[],this.writeQueue=[],p(this.proxyRoot,"proxyof",0)}return e.prototype.write=function(){var e;for((e=this.writeQueue).push.apply(e,arguments);!this.deferredRemote&&this.writeQueue.length;){var t=this.writeQueue.shift();a.isFunction(t)?this._callFunction(t):this._writeImpl(t)}},e.prototype._callFunction=function(e){var t={type:"function",value:e.name||e.toString()};this._onScriptStart(t),e.call(this.win,this.doc),this._onScriptDone(t)},e.prototype._writeImpl=function(e){this.parser.append(e);for(var t=void 0,i=void 0,n=void 0,r=[];(t=this.parser.readToken())&&!(i=a.isScript(t))&&!(n=a.isStyle(t));)(t=this.options.beforeWriteToken(t))&&r.push(t);r.length>0&&this._writeStaticTokens(r),i&&this._handleScriptToken(t),n&&this._handleStyleToken(t)},e.prototype._writeStaticTokens=function(e){var t=this._buildChunk(e);return t.actual?(t.html=this.proxyHistory+t.actual,this.proxyHistory+=t.proxy,this.proxyRoot.innerHTML=t.html,this._walkChunk(),t):null},e.prototype._buildChunk=function(e){for(var t=this.actuals.length,i=[],n=[],r=[],o=e.length,s=0;s<o;s++){var a=e[s],c=a.toString();if(i.push(c),a.attrs){if(!/^noscript$/i.test(a.tagName)){var d=t++;n.push(c.replace(/(\/?>)/," "+u+"id="+d+" $1")),a.attrs.id!==h&&a.attrs.id!==l&&r.push("atomicTag"===a.type?"":"<"+a.tagName+" "+u+"proxyof="+d+(a.unary?" />":">"))}}else n.push(c),r.push("endTag"===a.type?c:"")}return{tokens:e,raw:i.join(""),actual:n.join(""),proxy:r.join("")}},e.prototype._walkChunk=function(){for(var e=void 0,t=[this.proxyRoot];a.existy(e=t.shift());){var i=1===e.nodeType;if(!i||!d(e,"proxyof")){i&&(this.actuals[d(e,"id")]=e,p(e,"id"));var n=e.parentNode&&d(e.parentNode,"proxyof");n&&this.actuals[n].appendChild(e)}t.unshift.apply(t,a.toArray(e.childNodes))}},e.prototype._handleScriptToken=function(e){var t=this,i=this.parser.clear();i&&this.writeQueue.unshift(i),e.src=e.attrs.src||e.attrs.SRC,(e=this.options.beforeWriteToken(e))&&(e.src&&this.scriptStack.length?this.deferredRemote=e:this._onScriptStart(e),this._writeScriptToken(e,(function(){t._onScriptDone(e)})))},e.prototype._handleStyleToken=function(e){var t=this.parser.clear();t&&this.writeQueue.unshift(t),e.type=e.attrs.type||e.attrs.TYPE||"text/css",(e=this.options.beforeWriteToken(e))&&this._writeStyleToken(e),t&&this.write()},e.prototype._writeStyleToken=function(e){var t=this._buildStyle(e);this._insertCursor(t,l),e.content&&(t.styleSheet&&!t.sheet?t.styleSheet.cssText=e.content:t.appendChild(this.doc.createTextNode(e.content)))},e.prototype._buildStyle=function(e){var t=this.doc.createElement(e.tagName);return t.setAttribute("type",e.type),a.eachKey(e.attrs,(function(e,i){t.setAttribute(e,i)})),t},e.prototype._insertCursor=function(e,t){this._writeImpl('<span id="'+t+'"/>');var i=this.doc.getElementById(t);i&&i.parentNode.replaceChild(e,i)},e.prototype._onScriptStart=function(e){e.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(e)},e.prototype._onScriptDone=function(e){e===this.scriptStack[0]?(this.scriptStack.shift(),this.write.apply(this,e.outerWrites),!this.scriptStack.length&&this.deferredRemote&&(this._onScriptStart(this.deferredRemote),this.deferredRemote=null)):this.options.error({msg:"Bad script nesting or script finished twice"})},e.prototype._writeScriptToken=function(e,t){var i=this._buildScript(e),n=this._shouldRelease(i),r=this.options.afterAsync;e.src&&(i.src=e.src,this._scriptLoadHandler(i,n?r:function(){t(),r()}));try{this._insertCursor(i,h),i.src&&!n||t()}catch(e){this.options.error(e),t()}},e.prototype._buildScript=function(e){var t=this.doc.createElement(e.tagName);return a.eachKey(e.attrs,(function(e,i){t.setAttribute(e,i)})),e.content&&(t.text=e.content),t},e.prototype._scriptLoadHandler=function(e,t){function i(){e=e.onload=e.onreadystatechange=e.onerror=null}var n=this.options.error;function o(){i(),null!=t&&t(),t=null}function s(e){i(),n(e),null!=t&&t(),t=null}function a(e,t){var i=e["on"+t];null!=i&&(e["_on"+t]=i)}a(e,"load"),a(e,"error"),r(e,{onload:function(){if(e._onload)try{e._onload.apply(this,Array.prototype.slice.call(arguments,0))}catch(t){s({msg:"onload handler failed "+t+" @ "+e.src})}o()},onerror:function(){if(e._onerror)try{e._onerror.apply(this,Array.prototype.slice.call(arguments,0))}catch(t){return void s({msg:"onerror handler failed "+t+" @ "+e.src})}s({msg:"remote script failed "+e.src})},onreadystatechange:function(){/^(loaded|complete)$/.test(e.readyState)&&o()}})},e.prototype._shouldRelease=function(e){return!/^script$/i.test(e.nodeName)||!!(this.options.releaseAsync&&e.src&&e.hasAttribute("async"))},e}();t.default=g},function(e,t,i){
/**
    		 * @file prescribe
    		 * @description Tiny, forgiving HTML parser
    		 * @version vundefined
    		 * @see {@link https://github.com/krux/prescribe/}
    		 * @license MIT
    		 * @author Derek Brans
    		 * @copyright 2016 Krux Digital, Inc
    		 */
var n;n=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){var n,r=i(1),o=(n=r)&&n.__esModule?n:{default:n};e.exports=o.default},function(e,t,i){t.__esModule=!0;var n,r=u(i(2)),o=u(i(3)),s=i(6),a=(n=s)&&n.__esModule?n:{default:n},c=i(5);function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var h={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/},d=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(this,e),this.stream=i;var o=!1,s={};for(var c in r)r.hasOwnProperty(c)&&(n.autoFix&&(s[c+"Fix"]=!0),o=o||s[c+"Fix"]);o?(this._readToken=(0,a.default)(this,s,(function(){return t._readTokenImpl()})),this._peekToken=(0,a.default)(this,s,(function(){return t._peekTokenImpl()}))):(this._readToken=this._readTokenImpl,this._peekToken=this._peekTokenImpl)}return e.prototype.append=function(e){this.stream+=e},e.prototype.prepend=function(e){this.stream=e+this.stream},e.prototype._readTokenImpl=function(){var e=this._peekTokenImpl();if(e)return this.stream=this.stream.slice(e.length),e},e.prototype._peekTokenImpl=function(){for(var e in h)if(h.hasOwnProperty(e)&&h[e].test(this.stream)){var t=o[e](this.stream);if(t)return"startTag"===t.type&&/script|style/i.test(t.tagName)?null:(t.text=this.stream.substr(0,t.length),t)}},e.prototype.peekToken=function(){return this._peekToken()},e.prototype.readToken=function(){return this._readToken()},e.prototype.readTokens=function(e){for(var t=void 0;t=this.readToken();)if(e[t.type]&&!1===e[t.type](t))return},e.prototype.clear=function(){var e=this.stream;return this.stream="",e},e.prototype.rest=function(){return this.stream},e}();for(var p in t.default=d,d.tokenToString=function(e){return e.toString()},d.escapeAttributes=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=(0,c.escapeQuotes)(e[i],null));return t},d.supports=r,r)r.hasOwnProperty(p)&&(d.browserHasFlaw=d.browserHasFlaw||!r[p]&&p)},function(e,t){t.__esModule=!0;var i=!1,n=!1,r=window.document.createElement("div");try{var o="<P><I></P></I>";r.innerHTML=o,t.tagSoup=i=r.innerHTML!==o}catch(e){t.tagSoup=i=!1}try{r.innerHTML="<P><i><P></P></i></P>",t.selfClose=n=2===r.childNodes.length}catch(e){t.selfClose=n=!1}r=null,t.tagSoup=i,t.selfClose=n},function(e,t,i){t.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.comment=function(e){var t=e.indexOf("--\x3e");if(t>=0)return new r.CommentToken(e.substr(4,t-1),t+3)},t.chars=function(e){var t=e.indexOf("<");return new r.CharsToken(t>=0?t:e.length)},t.startTag=s,t.atomicTag=function(e){var t=s(e);if(t){var i=e.slice(t.length);if(i.match(new RegExp("</\\s*"+t.tagName+"\\s*>","i"))){var n=i.match(new RegExp("([\\s\\S]*?)</\\s*"+t.tagName+"\\s*>","i"));if(n)return new r.AtomicTagToken(t.tagName,n[0].length+t.length,t.attrs,t.booleanAttrs,n[1])}}},t.endTag=function(e){var t=e.match(o.endTag);if(t)return new r.EndTagToken(t[1],t[0].length)};var r=i(4),o={startTag:/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,endTag:/^<\/([\-A-Za-z0-9_]+)[^>]*>/,attr:/(?:([\-A-Za-z0-9_]+)\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))|(?:([\-A-Za-z0-9_]+)(\s|$)+)/g,fillAttr:/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i};function s(e){var t,i,s;if(-1!==e.indexOf(">")){var a=e.match(o.startTag);if(a){var c=(t={},i={},s=a[2],a[2].replace(o.attr,(function(e,n){arguments[2]||arguments[3]||arguments[4]||arguments[5]?arguments[5]?(t[arguments[5]]="",i[arguments[5]]=!0):t[n]=arguments[2]||arguments[3]||arguments[4]||o.fillAttr.test(n)&&n||"":t[n]="",s=s.replace(e,"")})),{v:new r.StartTagToken(a[1],a[0].length,t,i,!!a[3],s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))});if("object"===(void 0===c?"undefined":n(c)))return c.v}}}},function(e,t,i){t.__esModule=!0,t.EndTagToken=t.AtomicTagToken=t.StartTagToken=t.TagToken=t.CharsToken=t.CommentToken=t.Token=void 0;var n=i(5);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.Token=function e(t,i){r(this,e),this.type=t,this.length=i,this.text=""},t.CommentToken=function(){function e(t,i){r(this,e),this.type="comment",this.length=i||(t?t.length:0),this.text="",this.content=t}return e.prototype.toString=function(){return"\x3c!--"+this.content},e}(),t.CharsToken=function(){function e(t){r(this,e),this.type="chars",this.length=t,this.text=""}return e.prototype.toString=function(){return this.text},e}();var o=t.TagToken=function(){function e(t,i,n,o,s){r(this,e),this.type=t,this.length=n,this.text="",this.tagName=i,this.attrs=o,this.booleanAttrs=s,this.unary=!1,this.html5Unary=!1}return e.formatTag=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i="<"+e.tagName;for(var r in e.attrs)if(e.attrs.hasOwnProperty(r)){i+=" "+r;var o=e.attrs[r];void 0!==e.booleanAttrs&&void 0!==e.booleanAttrs[r]||(i+='="'+(0,n.escapeQuotes)(o)+'"')}return e.rest&&(i+=" "+e.rest),e.unary&&!e.html5Unary?i+="/>":i+=">",null!=t&&(i+=t+"</"+e.tagName+">"),i},e}();t.StartTagToken=function(){function e(t,i,n,o,s,a){r(this,e),this.type="startTag",this.length=i,this.text="",this.tagName=t,this.attrs=n,this.booleanAttrs=o,this.html5Unary=!1,this.unary=s,this.rest=a}return e.prototype.toString=function(){return o.formatTag(this)},e}(),t.AtomicTagToken=function(){function e(t,i,n,o,s){r(this,e),this.type="atomicTag",this.length=i,this.text="",this.tagName=t,this.attrs=n,this.booleanAttrs=o,this.unary=!1,this.html5Unary=!1,this.content=s}return e.prototype.toString=function(){return o.formatTag(this,this.content)},e}(),t.EndTagToken=function(){function e(t,i){r(this,e),this.type="endTag",this.length=i,this.text="",this.tagName=t}return e.prototype.toString=function(){return"</"+this.tagName+">"},e}()},function(e,t){t.__esModule=!0,t.escapeQuotes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?e.replace(/([^"]*)"/g,(function(e,t){return/\\/.test(t)?t+'"':t+'\\"'})):t}},function(e,t){t.__esModule=!0,t.default=function(e,t,i){var s=function(){var e=[];return e.last=function(){return this[this.length-1]},e.lastTagNameEq=function(e){var t=this.last();return t&&t.tagName&&t.tagName.toUpperCase()===e.toUpperCase()},e.containsTagName=function(e){for(var t,i=0;t=this[i];i++)if(t.tagName===e)return!0;return!1},e}(),a={startTag:function(i){var r=i.tagName;"TR"===r.toUpperCase()&&s.lastTagNameEq("TABLE")?(e.prepend("<TBODY>"),c()):t.selfCloseFix&&n.test(r)&&s.containsTagName(r)?s.lastTagNameEq(r)?o(e,s):(e.prepend("</"+i.tagName+">"),c()):i.unary||s.push(i)},endTag:function(n){s.last()?t.tagSoupFix&&!s.lastTagNameEq(n.tagName)?o(e,s):s.pop():t.tagSoupFix&&(i(),c())}};function c(){var t=function(e,t){var i=e.stream,n=r(t());return e.stream=i,n}(e,i);t&&a[t.type]&&a[t.type](t)}return function(){return c(),r(i())}};var i=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,n=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i;function r(e){return e&&"startTag"===e.type&&(e.unary=i.test(e.tagName)||e.unary,e.html5Unary=!/\/>$/.test(e.text)),e}function o(e,t){var i=t.pop();e.prepend("</"+i.tagName+">")}}])},e.exports=n()},function(e,t){t.__esModule=!0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e){return null!=e}function r(e,t,i){var n=void 0,r=e&&e.length||0;for(n=0;n<r;n++)t.call(i,e[n],n)}function o(e,t,i){for(var n in e)e.hasOwnProperty(n)&&t.call(i,n,e[n])}function s(e,t){return!(!e||"startTag"!==e.type&&"atomicTag"!==e.type||!("tagName"in e)||!~e.tagName.toLowerCase().indexOf(t))}t.existy=n,t.isFunction=function(e){return"function"==typeof e},t.each=r,t.eachKey=o,t.defaults=function(e,t){return e=e||{},o(t,(function(t,i){n(e[t])||(e[t]=i)})),e},t.toArray=function(e){try{return Array.prototype.slice.call(e)}catch(o){var t=(n=[],r(e,(function(e){n.push(e)})),{v:n});if("object"===(void 0===t?"undefined":i(t)))return t.v}var n},t.last=function(e){return e[e.length-1]},t.isTag=s,t.isScript=function(e){return s(e,"script")},t.isStyle=function(e){return s(e,"style")}}])},e.exports=i()}(Ko);var Qo=Jr(Ko.exports);class Yo{constructor(e,t,i,n,r,o,s){this.reporter=e,this.config=t,this.queue=i,this.location=n,this.document=r,this.debug=o,this.url=s}queryNonConstantManagedTagsAndShowOnUrlChange(){this.queryNonConstantManagedTagsAndShow(!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeQueryNonConstantManagedTagsAndShow",(()=>{this.queryNonConstantManagedTagsAndShow(!1)}))}processDefinition(e){this.debug.log("Processing managed tags...",e),this.removeOverlayAndShowManagedTags(e,!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeRemoveOverlayAndShowManagedTags",(()=>{this.removeOverlayAndShowManagedTags(e,!1)}))}showManagedTag(e){this.debug.log("Showing managed tag...",e);const t="definition"in e?e.definition:e.parametrized_definition;if("js"===e.type){let e;try{e=new Function(t)}catch(e){return this.debug.error("Syntax error in the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for syntax errors, such errors are usually\nhighlighted in the UI. The first line of the stack trace below should give you\na clue.\n\n",e)}try{e()}catch(e){this.debug.error("Error when executing the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for errors. This is not a syntax error and\nmay be hard to spot, but the first line of the stack trace below should give\nyou a clue.\n\n",e)}}else if("html"===e.type)try{Qo(this.document.body,t)}catch(e){this.debug.error("Error when applying an html managed tag.\n\nThere was an error when applying the html managed tag using\nPostscribe (https://github.com/krux/postscribe/).\n\n",e)}else this.debug.error(`Unknown managed tag type "${e.type}". The type\nmay only be "html" or "js".`)}removeOverlayAndShowManagedTags(e,t){if(t){const t=this.document.getElementById("__exponea__overlay__"),i=!t&&this.config.getOptions().modify.overlay&&!!window[u].__;this.filterAndShowManagedTags(e,i),t&&t.parentElement&&t.parentElement.removeChild(t)}else this.filterAndShowManagedTags(e,!1)}queryNonConstantManagedTagsAndShow(e){let t=Zn(this.config.getOptions().customer);this.queue.enqueue({name:Dr.ManagedTagsShow,noBulk:!0,prepareData:()=>(this.debug.log("Getting non-constant managed tags"),t&&t.cookie||(t=Zn(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:t,current_url:this.location.href}}),processResponse:t=>{this.removeOverlayAndShowManagedTags(t.data,e)},processError:e=>{this.debug.error("Error getting non-constant managed tags",e)}})}filterAndShowManagedTags(e,t){const i=lo(so.ManagedTag,this.debug);this.showManagedTags(e.filter(i("overlay",(e=>!t||!e.uses_overlay))).filter(i("page",(e=>!("trigger"in e)||po.matches(this.location.href,e.trigger)))))}showManagedTags(e){e.forEach((e=>this.showManagedTag(e)))}}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],Yo.prototype,"queryNonConstantManagedTagsAndShowOnUrlChange",null),fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],Yo.prototype,"showManagedTag",null);class Jo{constructor(e,t,i,n,r,o,s){this.reporter=e,this.window=t,this.serviceWorkerManager=i,this.database=n,this.storageUtils=r,this.config=o,this.logger=s,this.webExperienceObject=this.getWebExperienceObject()}initialize(){const e=this.config.getNewExperimentsOptions();if(e&&"sync"===e.mode&&this.serviceWorkerManager.isAvailable()&&this.database.isSupported()&&this.storageUtils.isStorageAvailable("localStorage")){const e=this.config.storeInIndexedDB().then((()=>this.serviceWorkerManager.isRegistered())).then((t=this.serviceWorkerManager,i=this.storageUtils,function(e){if(!e)return i.removeFromStorage("localStorage",p),t.register().then((()=>{Zo(i)}));Zo(i)})).catch((e=>{this.logger.error('Failed to initialize the "sync" mode for the new experiments because of:',e),this.logger.error('The SDK will now use the new experiments in "async" mode. Note that the service worker is only required for the "sync" mode. If you don\'t want to use it, consider switching to the "async" mode. Read more in https://docs.exponea.com/docs/integrating-and-using-experiments.')}));this.reporter.reportPromiseError(e)}var t,i}areAlreadyApplied(){return!(!this.webExperienceObject||!this.webExperienceObject.skipExperiments)}getWebExperienceObject(){const e=this.window[u],t=e&&e.webxp,i=this.window[k];return t||i}}function Zo(e){e.writeToStorage("localStorage",p,!0)}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],Jo.prototype,"initialize",null);const Xo={click:!0,key:!0,move:!0,scroll:!0},es={click:["click","mousedown","pointerdown","touchstart"],move:["mousemove","pointermove"],key:["keydown"],scroll:["wheel","touchmove","scroll"]};class ts{constructor(e,t={},i){this.window=e,this.activityCallback=i,this.listenersRegistered=!1,this.options=En({},t,Xo)}registerActionListeners(){this.listenersRegistered||(sr(es,((e,t)=>{e.forEach((e=>{Ho(this.window,e,(()=>{this.options[t]&&(this.lastActivity=t,this.activityCallback&&this.activityCallback(t))}))}))})),this.listenersRegistered=!0)}setOptions(e){this.options=En({},e,this.options)}getLastUserActivity(){return this.lastActivity}resetActivity(){this.lastActivity=void 0}}class is{constructor(e,t,i,n,r,o,s,a,c,u,l,h){this.reporter=e,this.config=t,this.timestamp=i,this.eventTracker=n,this.window=r,this.location=o,this.document=s,this.debug=a,this.cookies=c,this.storageUtils=u,this.unloader=l,this.url=h,this.activityHandler=new ts(this.window,this.config.getActivityHandlerOptions(),(e=>this.resumePinging(e)))}sendPing(e=!1,t){const i=this.config.getOptions().ping;if(!i||!i.enabled)return this.stopPinging();const n=this.shouldCheckActivity(i.activity);if(e&&n&&!this.activityHandler.getLastUserActivity())return this.debug.log("No user activity detected so not pinging"),void this.stopPinging();const r=this.getPingParams(t);r&&(this.debug.log("Sending session ping"),this.eventTracker.track("session_ping",r)),this.onSessionPing(),this.activityHandler.resetActivity()}initializeWebUnloadTracking(){this.config.getOptions().track.unloads&&this.unloader.addListener((()=>{this.eventTracker.track("web_unload",this.getPingParams()||{})}))}restartPinging(){this.stopPinging();const e=this.config.getOptions().ping;e&&e.enabled&&(this.debug.log("Session ping is enabled"),this.activityHandler.registerActionListeners(),this.sendPing(!1,"page_load"),this.intervalId=this.window.setInterval((()=>this.sendPing(!0)),1e3*e.interval))}setOptions(e){this.debug.log("Changing ping configuration: ",e),this.config.extendOptions({ping:e}),this.setActivityHandlerOptions()}onSessionPing(e=(new Date).getTime()){const t=this.getLastSessionPing();this.storageUtils.isStorageAvailable("localStorage")&&((null===t||t<e-12e5)&&this.onSessionStart(e),this.setLastSessionPing(e))}getPingParams(e){const t=this.config.getOptions(),n=this.getLastActivity(e);if(!this.shouldSendActivity(n))return;let r={};t.utm_params&&(r=this.url.getParams(t.utm_params)),Object.assign(r,t.ping.properties),r.referrer=this.document.referrer,r.location=this.location.href,r.path=this.location.pathname,n&&(r.activity=n);const o=this.cookies.getCookie(i);return o&&(r.cookie=o),r}getLastSessionStart(){return this.timestamp.getStoredTimestamp(c)}setActivityHandlerOptions(){this.activityHandler.setOptions(this.config.getActivityHandlerOptions())}onSessionStart(e=(new Date).getTime()){this.setLastSessionStart(e)}setLastSessionPing(e){this.timestamp.storeTimestamp(a,e)}setLastSessionStart(e){this.timestamp.storeTimestamp(c,e)}stopPinging(){this.intervalId&&(this.window.clearInterval(this.intervalId),this.intervalId=void 0)}resumePinging(e){const t=this.config.getOptions().ping;t&&t.enabled&&!this.intervalId&&(this.debug.log("Resuming session ping"),this.activityHandler.registerActionListeners(),this.sendPing(!1,e),this.intervalId=this.window.setInterval((()=>this.sendPing(!0)),1e3*t.interval))}getLastSessionPing(){return this.timestamp.getStoredTimestamp(a)}shouldCheckActivity(e){return"boolean"==typeof e?e:Object.values(e).some((e=>!!e))}shouldSendActivity(e){const t=this.config.getOptions().ping.activity;if("boolean"==typeof t)return!0;switch(e){case void 0:case"page_load":return!0;case"click":return!!t.click;case"scroll":return!!t.scroll;case"key":return!!t.key;case"move":return!!t.move;default:return!1}}getLastActivity(e){return e||(this.activityHandler&&this.activityHandler.getLastUserActivity()?this.activityHandler.getLastUserActivity():void 0)}}function ns(e,t=""){return function(i,n,r){const o=r.value,s=t+String(n);return r.value=function(){return rs(e,s,arguments),os(e,s,arguments),o.apply(this,arguments)},r}}function rs(e,t,i){const n=fr(e,(e=>!e.optional)).length;if(i.length<n)throw new Ro(`Invalid number of arguments when calling ${u}.${String(t)}, expected ${n} but got ${i.length}`)}function os(e,t,i){Se(i,((i,n)=>{const r=e[n];if(!r){if(n>=e.length)return;throw new Ro(`Missing definition for argument ${n} of ${u}.${t} inthe @${ns.name} decorator!`)}if(void 0===i){if(r.optional)return;throw new Ro(`Missing argument ${n} - ${r.name} when calling ${u}.${t}, `+as(r)+" but got "+typeof i)}const o=typeof i;let s;switch(o){case"boolean":case"number":case"bigint":case"string":case"symbol":case"function":s=o;break;case"object":s=H(i)?"array":i instanceof HTMLElement?"element":null===i?"null":"object";break;default:throw ss(t,n,r,typeof i,i)}if("type"in r){if(s!==r.type)throw ss(t,n,r,s,i)}else if(!function(e,t,i){var n=H(e)?Je:gr;return i&&_n(e,t,i)&&(t=void 0),n(e,ci(t))}(r.oneOf,(e=>e===s)))throw ss(t,n,r,s,i)}))}function ss(e,t,i,n,r){return new Ro(`Invalid type of argument ${t} - ${i.name} when calling ${u}.${e}, `+as(i)+` but got ${n}: `+function(e,t){let i=String(e);"object"===t&&(i=JSON.stringify(e));"array"===t&&(i=`[${i}]`);if("element"===t){i=`HTMLElement ${e.tagName.toLowerCase()}`}i.length>128&&(i=i.substring(0,128)+"...");return i}(r,n))}function as(e){return"type"in e?`expected ${e.type}`:`expected one of ${e.oneOf.join(", ")}`}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[Object,String]),mi("design:returntype",void 0)],is.prototype,"sendPing",null);class cs{constructor(e,t){this.pushWebApi=e,this.pushSafariApi=t,this._=[]}subscribe(e=(()=>{})){this.pushWebApi.isAvailable()?this.pushWebApi.subscribe(e):this.pushSafariApi.isAvailable()?this.pushSafariApi.subscribe(e):e(ao.Unsupported)}unsubscribe(e=(()=>{})){this.pushWebApi.isAvailable()?this.pushWebApi.unsubscribe(e):this.pushSafariApi.isAvailable()?this.pushSafariApi.unsubscribe(e):e(ao.Unsupported)}isAvailable(e){const t=this.pushWebApi.isAvailable()||this.pushSafariApi.isAvailable();return e&&e(t),t}isSubscribed(e){this.pushWebApi.isAvailable()?this.pushWebApi.isSubscribed(e):this.pushSafariApi.isAvailable()?this.pushSafariApi.isSubscribed(e):e(!1,!1)}}fi([ns([{name:"callback",type:"function",optional:!0}],"notifications."),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",void 0)],cs.prototype,"subscribe",null),fi([ns([{name:"callback",type:"function",optional:!0}],"notifications."),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",void 0)],cs.prototype,"unsubscribe",null),fi([ns([{name:"callback",type:"function",optional:!0}],"notifications."),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",Boolean)],cs.prototype,"isAvailable",null),fi([ns([{name:"callback",type:"function"}],"notifications."),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",void 0)],cs.prototype,"isSubscribed",null);class us{constructor(e,t,i,n,r){this.window=e,this.config=t,this.customer=i,this.location=n,this.storageUtils=r}subscribe(e,t={}){var i,n;const r=Object.assign({},this.config.getOptions().customer),o=this.getWebServiceUrl(),s=null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID;if(!s||!(null===(n=this.window.safari)||void 0===n?void 0:n.pushNotification))return void e(ao.Unsupported);const a=this.window.safari.pushNotification.permission(s);if(!a)return void e(ao.Error);const{permission:c}=a;"denied"!==c?this.window.safari.pushNotification.requestPermission(o,s,r,(({deviceToken:i,permission:n})=>{"granted"===n&&(this.storageUtils.writeToStorage("localStorage",d,!0),this.customer.updateCustomer(Object.assign({safari_push_notification:i},t))),e(this.getStatusForPermission(n))})):e(this.getStatusForPermission(c))}unsubscribe(e){this.storageUtils.writeToStorage("localStorage",d,!1),this.customer.updateCustomer({safari_push_notification:""},(()=>e(ao.Unsubscribed)),(()=>e(ao.Error)),!0)}handleDeniedSubscription(){this.isAvailable()&&this.isSafariSubscriptionEqual("denied")&&this.isPushTokenStoredInExponea((e=>{e&&this.unsubscribe((()=>{}))}))}isAvailable(e=this.location){var t,i;return!(!(null===(t=this.window.safari)||void 0===t?void 0:t.pushNotification)||!(null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID)||"https:"!==e.protocol&&"localhost"!==e.hostname&&"127.0.0.1"!==e.hostname)}isSubscribed(e){this.isPushTokenStoredInExponea((t=>{e(this.isSafariSubscriptionEqual("granted")&&t,this.isSafariSubscriptionEqual("denied"))}))}isPushTokenStoredInExponea(e){setTimeout((()=>{try{e(!!this.storageUtils.readBooleanFromStorage("localStorage",d))}catch(t){e(!1)}}))}isSafariSubscriptionEqual(e){var t,i;const n=null===(t=this.window.safari)||void 0===t?void 0:t.pushNotification,r=null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID;if(!n||!r)return!1;return n.permission(r).permission===e}getWebServiceUrl(){const{target:e}=this.config.getOptions(),t=this.config.getToken();let i=`${e.replace(/\/$/,"")}/integrations/push/projects/${t}/safari`;return/^\/\//.test(i)&&(i="https:"+i),i}getStatusForPermission(e){switch(e){case"granted":return ao.Subscribed;case"denied":return ao.PermissionDenied;default:return ao.Default}}}class ls{constructor(e,t,i,n,r,o,s,a){this.window=e,this.location=t,this.debug=i,this.logger=n,this.config=r,this.customer=o,this.queue=s,this.serviceWorkerManager=a,this._setVapidKey=()=>{},this.vapidKeyPromise=new Promise((e=>this._setVapidKey=e))}initialize(){this.isAvailable()&&this.requestVapidKey()}subscribe(e,t={},i=Notification){"granted"===i.permission?this.subscribeServiceWorker(e,t):i.requestPermission((i=>{"granted"===i?this.subscribeServiceWorker(e,t):e("default"===i?ao.Default:ao.PermissionDenied)}))}unsubscribe(e){this.serviceWorkerManager.isReady().then((e=>e.pushManager.getSubscription())).then((e=>{if(e)return e.unsubscribe().then((e=>{if(!e)throw new Error("Failed to unsubscribe");this.notifyServer(!1)}))})).then((()=>e(ao.Unsubscribed))).catch((()=>e(ao.Error)))}isAvailable(e=this.location){const t=this.window;return"Notification"in t&&"PushManager"in t&&this.serviceWorkerManager.isAvailable()&&"showNotification"in t.ServiceWorkerRegistration.prototype&&("https:"===e.protocol||"localhost"===e.hostname||"127.0.0.1"===e.hostname)}isSubscribed(e,t=Notification){const{permission:i}=t,n="denied"===i;"granted"===i&&this.serviceWorkerManager.isAvailable()?this.serviceWorkerManager.register().then((()=>this.serviceWorkerManager.isReady())).then((e=>e.pushManager.getSubscription())).then((e=>{if(!e)throw new Error("Missing push notification subscription");return e})).then((()=>this.config.storeInIndexedDB())).then((()=>{e(!0,n)})).catch((t=>{this.logger.error("Failed to check whether the user is subscribed:",t),e(!1,n)})):e(!1,n)}notifyServer(e,t={}){if(e){const{data:i,vapidKey:n}=e;t[g]=i,t[f]=n||""}else t[g]="",t[f]="";this.customer.updateCustomer(t,void 0,void 0,!0)}subscribeServiceWorker(e,t){this.serviceWorkerManager.register().then((()=>this.serviceWorkerManager.isReady())).then((e=>this.config.storeInIndexedDB().then((()=>this.vapidKeyPromise)).then((e=>{if(void 0===e)return{vapidKey:void 0,vapidKeyUint8Array:void 0};try{return{vapidKey:e,vapidKeyUint8Array:hs(e)}}catch(e){throw this.debug.error(new Error("Could not convert vapid key to Uint8Array. Maybe it is not in the Base64 format?")),e}})).then((({vapidKey:t,vapidKeyUint8Array:i})=>e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i}).then((e=>({subscription:e,vapidKey:t}))))))).then((({subscription:i,vapidKey:n})=>{const r=Object.assign(Object.assign({},i.toJSON()),{vapidKey:!!n});this.notifyServer({data:r,vapidKey:n},t),e(ao.Subscribed)})).catch((t=>{this.logger.error("Failed to subscribe the push notifications because of:",t),e(ao.Error)}))}requestVapidKey(){this.queue.enqueue({name:nn.PushNotificationsVapidKey,prepareData:()=>({data:{company_id:this.config.getToken()}}),processResponse:({data:{vapidKey:e}})=>{this.debug.log(`Vapid key for browser push notifications is ${e}`),this._setVapidKey(e)},processError:()=>{this._setVapidKey(void 0)}})}}function hs(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),n=new Uint8Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);return n}class ds{constructor(e,t,i,n,r,o,s,a,c,u,l,h){this.reporter=e,this.config=t,this.queue=i,this.debug=n,this.timestamp=r,this.automaticTracking=o,this.window=s,this.eventTracker=a,this.customer=c,this.liveEventHandler=u,this.storageUtils=l,this.url=h}initialize(){this.config.getOptions().track.auto&&(this.liveEventHandler.initialize(),this._getTrackingDefinition())}_getTrackingDefinition(){this.debug.log("attempting to get tracking definition");const e=this._getCachedTrackingDefinition();e?this._trackByRules(e):this._fetchTrackingDefinitionAndTrackByRules()}_getCachedTrackingDefinition(){const e=this.storageUtils.readStringFromStorage("sessionStorage",r);if(!e)return this.debug.log("tracking definition not found in session storage"),null;this.debug.log("tracking definition found in session storage",e);let t=null;try{t=JSON.parse(e)}catch(e){this.debug.error("failed parsing cached tracked definition")}if(t){if(t.expires>this.timestamp.getUnixTimestamp())return t.data;this.debug.warn("tracking definition from session storage is expired")}return null}_fetchTrackingDefinitionAndTrackByRules(){this.queue.enqueue({name:nn.Tracking,prepareData:()=>(this.debug.log("fetching automatic tracking definition"),{data:{company_id:this.config.getToken()}}),processResponse:e=>{const{data:t}=e;this._storeTrackingDefinitionIntoCache(t),this._trackByRules(t)},processError:e=>{this.debug.error("Error getting automatic tracking definition",e)}})}_trackByRules(e){this._doTrackByRules(e),this.config.isSpaReloadingEnabled("automatic_tracking")&&this.url.onChange("QueryTracking.doTrackByRulesOnUrlChange",(()=>{this.liveEventHandler.clearLiveEventListeners(),this._doTrackByRules(e)}))}_doTrackByRules(e){e.filter((e=>po.matches(this.window.location.href,e.trigger))).forEach((e=>{"visit"===e.trigger.type?this._doTrackAction(e.action,null):"click"===e.trigger.type?this._doBindOnClickHandlers(e.trigger.selector,e.action):"submit"===e.trigger.type&&this._doBindOnSubmitHandlers(e.trigger.selector,e.action)}))}_doBindOnClickHandlers(e,t){this.liveEventHandler.addLiveEventListener("click",e,(e=>{this._doTrackAction(t,e.target,{immediate:!Uo})}))}_doBindOnSubmitHandlers(e,t){this.liveEventHandler.addLiveEventListener("submit",e,(e=>{this._doTrackAction(t,e.target,{immediate:!Uo})}))}_storeTrackingDefinitionIntoCache(e){this.storageUtils.writeToStorage("sessionStorage",r,JSON.stringify({expires:this.timestamp.getUnixTimestamp()+3600,data:e}))}_doTrackAction(e,t,i={}){"track"===e.type?this.automaticTracking.materializeProperties(e.properties,t,this.reporter.reportError((t=>{this.eventTracker.track(e.event_type,t,i)}),"trackEvent")):"identify"===e.type?this.automaticTracking.materializeIds(e.as_who,t,this.reporter.reportError((e=>{this.customer.identifyCustomer(e,{},void 0,void 0,i.immediate)}),"identifyCustomer")):"update"===e.type&&this.automaticTracking.materializeProperties(e.properties,t,this.reporter.reportError((e=>{this.customer.updateCustomer(e,void 0,void 0,i.immediate)}),"updateCustomer"))}}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],ds.prototype,"initialize",null);const ps={track:!1,callback:!0,retry:!0};class gs{get targetUrl(){return this.getCommandTargetUrl()}get name(){return this.options.name}constructor(e,t,i,n,r,o=o){this.options=e,this.reporter=t,this.timestamp=i,this.config=n,this.featureFlags=r,this.window=o,this.enqueuedAt=this.timestamp.getUnixTimestamp()}processResponse(e,t,i){const n=this.options.processResponse;n&&this.reporter.reportError((()=>n(e,t,i)),"httpRequest")()}processError(e,t={}){if((t=En(t,ps)).track&&this.reporter.sendErrorReport(e,"httpRequest",this.enqueuedAt),t.callback&&this.options.processError){const t=this.options.processError;this.reporter.reportError((()=>t(e)),"httpRequest")()}}prepareData(e){const t=this.options.prepareData;if(!t)return{state:void 0};try{return t(e)}catch(e){this.reporter.sendErrorReport(e,"prepareData"),this.processError(e,{retry:!1})}}getCommandTargetUrl(){if(bs(this)){let e=fs(`${this.config.getOptions().target}/${this.name}`,this.config);return this.featureFlags.flags.ewx_279_invalid_integration_monitor&&this.name===Dr.WebOptimization&&!this.config.getOptions().new_experiments&&function(e){return!!(e&&e.webxpClient&&e.webxpClient.init)}(this.window)&&(e+="?ii=1"),e}return fs(`${this.config.getOptions().target}/bulk`,this.config)}}function fs(e,t){const i=t.getToken(),n=t.getOptions().customer.cookie||"";return e.replace(/<project_id>/g,i).replace(/<cookie>/g,n)}function ms(e){return!e.options.noBulk}function bs(e){return!!e.options.noBulk}function ys(e){return!!e.options.action}const vs=36e5;function ws(e,t=5e3,i=2){return ks(e,t,i)}function ks(e,t=5e3,i,n=0){return function(){return n++,void setTimeout((function(){let r=t*i;r>vs&&(r=vs);if(n>=100)return void e();const o=ks(e,r,i,n);e(o)}),t)}}class _s{constructor(e){this.capacity=e,this.takenTokens=0}takeToken(){if(this.takenTokens===this.capacity)throw new Error("There is no free token to take");this.takenTokens++}releaseToken(){if(!this.takenTokens)throw new Error("There are no taken tickets");this.takenTokens--}hasFreeToken(){return this.takenTokens<this.capacity}}const xs="Command queue retry limit reached!",Ss=Object.freeze({maxCommandsInQueue:1e3,maxCommandsProcessedInParallel:500,maxCommandsInBulkRequest:50,processDebounceTime:100}),Es=Object.freeze({first:!1,process:Er.defer});class Ts{get length(){return this.commandsList.length}constructor(e,t,i,n,r,o,s,a,c={},u=s.navigator){this.reporter=e,this.config=t,this.http=i,this.debug=n,this.timestamp=r,this.unloader=o,this.window=s,this.featureFlags=a,this.navigator=u,this.commandsList=[],this.isProcessingBlockingCommands=!1,this.numberOfEnqueuedCommandsIgnored=0,this.options=Object.freeze(En(c,Ss)),this.unloader.addAfterListener((()=>{this.sendBulkWithBeacon()})),this.tokenSystem=new _s(this.options.maxCommandsProcessedInParallel),this.debounceProcess=ir((()=>this.process()),this.options.processDebounceTime)}enqueue(e,t={}){if(t=En(t,Es),this.debug.log("Enqueuing command "+e.name),this.isQueueExceeded())return this.debounceProcess(),!1;const i=new gs(e,this.reporter,this.timestamp,this.config,this.featureFlags,this.window);return t.first?this.commandsList.unshift(i):this.commandsList.push(i),t.process===Er.immediate?this.process():t.process===Er.defer?this.debounceProcess():this.debug.debug("Queue is not processing the enqueued command because 'process' is false"),!0}execute(e){this.debug.log("Executing command "+e.name);const t=new gs(e,this.reporter,this.timestamp,this.config,this.featureFlags,this.window),i=ws((e=>{Os(t,this.tokenSystem,this.debug,this.sendSingle.bind(this),e)}),this.options.processDebounceTime,1);e.allowedToFail?this.sendSingle(t,void 0):Os(t,this.tokenSystem,this.debug,this.sendSingle.bind(this),i)}clear(){this.commandsList=[]}registerPostBulkCallback(e){this.postBulkCallback=e}sendBulkWithBeacon(){if(0===this.commandsList.length)return;const e=this.commandsList.filter(ms);this.debug.log("Queue is sending "+e.length+"/"+this.commandsList.length+" commands with beacon",e);var t;if(this.commandsList=this.commandsList.filter((t=ms,e=>!t(e))),0===e.length)return;const i=this.config.getOptions().target+"/bulk",{bulkData:n}=As(e,this.timestamp),r={beacon:!0,commands:n},o=new Blob([JSON.stringify(r)],{type:"application/json"});this.navigator.sendBeacon(i,o)||this.debug.warn("Beacon data has not been queued for transfer!")}process(){if(this.commandsList.length<=0)return void this.debug.debug("Queue is empty, there are no commands to process");if(this.isProcessingBlockingCommands)return this.debug.debug("Queue is currently processing blocking commands and has to wait"),void this.debounceProcess();this.debug.debug("Processing queue commands"),this.debug.debug(`There are ${this.length} enqueued commands`);const e=[];for(let t=this.commandsList.shift();t;t=this.commandsList.shift()){if(ys(t))t.options.action();else if(bs(t)){const i=Ps(t,this.tokenSystem,this.sendSingle.bind(this));i&&e.push(i)}else{const i=js(t,this.commandsList,this.tokenSystem,this.debug,this.options,(()=>this.isProcessingBlockingCommands=!0),this.sendBulk.bind(this));e.push(...i)}if(this.isProcessingBlockingCommands){this.debug.debug("Queue is now blocked and it cannot continue processing commands"),e.push(...this.commandsList);break}}this.debug.debug("Queue commands have been processed"),this.debug.debug(`There are ${e.length} commands that will be processed in the next batch after a timeout`,e),this.commandsList=e,this.commandsList.length>0&&this.debounceProcess()}sendBulk(t,i){if(!t.length)return;const n=`${this.config.getOptions().target}/bulk`,{bulkData:r,commandStates:o}=As(t,this.timestamp),s={sdk:"js-client",sdk_version:e,sdk_snippet_version:Do(this.window),commands:r};this.debug.log(`Queue is sending ${t.length} commands in bulk`,t),this.http.post(n,s).then((e=>{const i=e.body;this.postBulkCallback&&this.postBulkCallback(),t.forEach(((e,t)=>{e.options.isBlocking&&(this.isProcessingBlockingCommands=!1);const n=i.results[t];"ok"===n.status?e.processResponse(n,o[t],{start_time:i.start_time,end_time:i.end_time}):e.processError(new Error(n.errors.join(", ")),{retry:!1}),this.tokenSystem.releaseToken()}))})).catch((e=>{this.debug.warn("Queue bulk request failed with errors:",e),Cs(e)&&e.response.status<500?t.forEach((t=>{t.processError(e,{retry:!1}),this.tokenSystem.releaseToken()})):(t.forEach((t=>t.processError(e,{callback:!1}))),i?(this.debug.log("Retrying the request...",t),i()):t.forEach((e=>e.processError(new Error(xs)))))}))}sendSingle(e,t){const i=this.timestamp.getTimestamp(),n=e.prepareData(i);n&&(this.debug.log("Queue is sending a single command "+e.name,e),function(e,t,i){if(function(e){return!bs(e)||e.options.httpMethod!==Io.get}(t))return e.post(t.targetUrl,i.data);return e.get(t.targetUrl)}(this.http,e,n).then((t=>{e.options.isBlocking&&(this.isProcessingBlockingCommands=!1),e.processResponse(t.body,n.state),this.tokenSystem.releaseToken()})).catch((i=>{if(this.debug.warn("Queue single command request failed with errors:",i),Cs(i)&&i.response.status<500){const t=new Error(function(e){const t=e.response.body;if("string"==typeof t)return t;return Object.entries(t.errors||{}).map((([e,t])=>`${e}: ${t.join(", ")}`)).join("; ")}(i));e.processError(t,{retry:!1}),this.tokenSystem.releaseToken()}else e.processError(i,{callback:!1}),t?(this.debug.log("Retrying the request...",e),t()):e.processError(new Error(xs))})))}isQueueExceeded(){const e=this.commandsList.length>=this.options.maxCommandsInQueue;return e?(this.numberOfEnqueuedCommandsIgnored+=1,1===this.numberOfEnqueuedCommandsIgnored&&this.debug.warn("Maximum queue length has been exceeded, further commands will be ignored")):this.numberOfEnqueuedCommandsIgnored>0&&(this.debug.debug(`Queue has been processed and it can receive commands again. There were ${this.numberOfEnqueuedCommandsIgnored} commands that were ignored.`),this.numberOfEnqueuedCommandsIgnored=0),e}}function Cs(e){return e instanceof Ao}function As(e,t){const i=[],n=[],r=t.getTimestamp();for(const t of e){const e=t.prepareData(r);e&&(i.push({name:t.name,data:e.data}),n.push(e.state))}return{bulkData:i,commandStates:n}}function Os(e,t,i,n,r){if(Ps(e,t,n)){if(!r){const t=`Max retry count reached for ${e.name}`;return i.error(t),void e.processError(new Error(t))}i.log(`Retry ${e.name} execution later because there were no free tokens...`),r()}}function Ps(e,t,i){if(!t.hasFreeToken())return e;t.takeToken();const n=ws((t=>{i(e,t)}));return i(e,e.options.allowedToFail?void 0:n),null}function js(e,t,i,n,r,o,s){const a=[],c=[],u=[];for(;e;e=t.shift())if(bs(e))c.push(e);else if(i.hasFreeToken()){if(i.takeToken(),e.options.isBlocking&&(o(),n.log("Queue encountered a blocking command"),n.log("Further requests will not be made until this one finishes")),a.push(e),a.length>=r.maxCommandsInBulkRequest)break}else u.push(e);t.unshift(...c);const l=a.every((e=>!!e.options.allowedToFail)),h=ws((e=>s(a,e)));return s(a,l?void 0:h),u}class Ls{constructor(e,t,i){this.config=e,this.queue=t,this.debug=i}fetch(e,t){let i;i=ar(e)?this.migrateOldGetRecommendationSignature.apply(this,t):e,this.queue.enqueue({name:Dr.Recommendation,noBulk:!0,prepareData:()=>(this.debug.log("Get recommendations: ",i.recommendationId),{data:this.processGetRecommendationOptions(i)}),processResponse:e=>{Lr((()=>{i.callback(e.data)}))}})}processGetRecommendationOptions(e){const t=this.config.getOptions(),i={project_id:this.config.getToken(),customer_ids:t.customer,engine_id:e.recommendationId,anti:!!e.anti,similarity:!!e.similarity,anonymous:!!e.anonymous,consider_known_items:!!e.considerKnowItems,fill_with_random:e.fillWithRandom,catalog_filter:e.catalogFilter,catalog_attributes_whitelist:e.catalogAttributesWhitelist,category_names:e.categoryNames};if(e.size&&(i.size=e.size),e.strategy&&(i.strategy=e.strategy),e.item)i.items={},i.items[e.item]=1;else if(H(e.items)&&e.items.length>0){i.items={};for(let t=0;t<e.items.length;t++)i.items[e.items[t]]=1}else fe(e.items)&&!function(e){if(null==e)return!0;if(be(e)&&(H(e)||"string"==typeof e||"function"==typeof e.splice||Q(e)||se(e)||$(e)))return!e.length;var t=At(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(le(e))return!ge(e).length;for(var i in e)if(pr.call(e,i))return!1;return!0}(e.items)&&(i.items=e.items);return e.noTrack&&(i.no_track=e.noTrack),i}migrateOldGetRecommendationSignature(e,t,i,n,r){return{recommendationId:e,callback:t,size:i,strategy:n,item:r}}}class Is{constructor(e,t=window.performance){this.config=e,this.performance=t,this.data=null,this.updatedAt=0}get(){return this.isFresh()?this.data:null}set(e){this.data=e,this.updatedAt=this.performance.now()}clear(){this.data=null,this.updatedAt=this.performance.now()}isFresh(){return this.performance.now()-this.updatedAt<this.config.getOptions().exposed_segments.ttl}}class Bs{constructor(e,t,i,n,r=window.performance){this.reporter=e,this.config=t,this.initializeState=i,this.queue=n,this.performance=r,this._=[],this.inProgress=!1,this.discoverySubscribers=new Map,this.contentSubscribers=new Map,this.merchandisingSubscribers=new Map,this.discoverySubscriberId=0,this.contentSubscriberId=0,this.merchandisingSubscriberId=0,this.lastSegmentNotificationValue=null,this.cache=new Is(this.config,this.performance)}getSegments(e,t,i,n={force:!1}){const r=function(i){t(function(t){return t[e]}(i))};n.force&&this.cache.clear();const o=this.cache.get();o?r(o):(this.prefetch(!0),this.segmentsPromise&&this.segmentsPromise.then(r,i))}prefetch(e=!1){(this.config.getOptions().exposed_segments.prefetch||e)&&!1===this.inProgress&&(this.inProgress=!0,this.segmentsPromise=this.segmentsQueuePromise(),this.segmentsPromise.then((e=>{this.cache.set(e)}),(()=>{this.cache.clear()})),this.segmentsPromise.finally((()=>{this.inProgress=!1})))}flush(){this.cache.clear()}subscribe(e,t,i){if("discovery"===e){const e=++this.discoverySubscriberId;return this.discoverySubscribers.set(e,{successCallback:t,errorCallback:i}),{unsubscribe:()=>{this.discoverySubscribers.delete(e)}}}if("content"===e){const e=++this.contentSubscriberId;return this.contentSubscribers.set(e,{successCallback:t,errorCallback:i}),{unsubscribe:()=>{this.contentSubscribers.delete(e)}}}if("merchandising"===e){const e=++this.merchandisingSubscriberId;return this.merchandisingSubscribers.set(e,{successCallback:t,errorCallback:i}),{unsubscribe:()=>{this.merchandisingSubscribers.delete(e)}}}throw new Error(`Unsupported subscription category: ${e}.`)}notify(){return bi(this,void 0,void 0,(function*(){if(this.config.getOptions().exposed_segments.notify)try{this.segmentsPromise=this.segmentsQueuePromise();const e=yield this.segmentsPromise,t=this.lastSegmentNotificationValue;this.notifySuccessSubscribers("discovery",t,e),this.notifySuccessSubscribers("content",t,e),this.notifySuccessSubscribers("merchandising",t,e),this.lastSegmentNotificationValue=e}catch(e){this.notifyErrorSubscribers("discovery",e),this.notifyErrorSubscribers("content",e),this.notifyErrorSubscribers("merchandising",e),this.lastSegmentNotificationValue=null}}))}notifySuccessSubscribers(e,t,i){let n;if("content"===e)n=this.contentSubscribers;else if("discovery"===e)n=this.discoverySubscribers;else{if("merchandising"!==e)throw new Error(`Unsupported subscription category: ${e}.`);n=this.merchandisingSubscribers}if(function(e,t,i){if(!t)return!0;if(!i&&!t)return!1;if(!i&&t)return!0;const n=t[e]||[],r=i[e]||[];if(r.length!==n.length)return!0;return r.some((e=>{const t=n.find((t=>t.segmentation_id===e.segmentation_id));return!t||!(!t||e.id===t.id)}))}(e,t,i))for(const[t,r]of n)r.successCallback(i[e])}notifyErrorSubscribers(e,t){let i;if("content"===e)i=this.contentSubscribers;else if("discovery"===e)i=this.discoverySubscribers;else{if("merchandising"!==e)throw new Error(`Unsupported subscription category: ${e}.`);i=this.merchandisingSubscribers}for(const[e,n]of i)n.errorCallback&&n.errorCallback(t)}segmentsQueuePromise(){return new Promise(((e,t)=>{this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Dr.Segments,noBulk:!0,httpMethod:Io.get,processResponse:e,processError:t},{process:Er.immediate})}))}))}}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[String,Function,Function,Object]),mi("design:returntype",void 0)],Bs.prototype,"getSegments",null),fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[Boolean]),mi("design:returntype",void 0)],Bs.prototype,"prefetch",null),fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],Bs.prototype,"flush",null),fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[String,Function,Function]),mi("design:returntype",Object)],Bs.prototype,"subscribe",null),fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",Promise)],Bs.prototype,"notify",null);class Fs{constructor(e,t,i){this.window=e,this.debug=t,this.config=i}get serviceWorker(){return this.window.navigator.serviceWorker}get serviceWorkerPath(){return this.config.getOptions().service_worker_path}isAvailable(){return"serviceWorker"in this.window.navigator&&"ServiceWorkerRegistration"in this.window}register(){return this.serviceWorker.register(this.serviceWorkerPath,{updateViaCache:"none"}).catch((e=>{throw this.debug.error(`Failed to the register service worker on '${this.serviceWorkerPath}' because of:`,e),e}))}isReady(){return this.serviceWorker.ready}isRegistered(){return this.serviceWorker.getRegistration(this.serviceWorkerPath).then((e=>!!e))}}class zs{constructor(e,t,i){this.logger=e,this.localStorage=t,this.sessionStorage=i,this.isAvailable={localStorage:Ds(t),sessionStorage:Ds(i)}}writeToStorage(e,t,i){if(!this.isStorageAvailable(e))return!1;try{return fe(i)?this.getStorage(e).setItem(t,JSON.stringify(i)):this.getStorage(e).setItem(t,String(i)),!0}catch(e){return this.logger.error("Couldn't write to local storage, some features may be broken.",e),!1}}removeFromStorage(e,t){return!!this.isStorageAvailable(e)&&(this.getStorage(e).removeItem(t),!0)}readStringFromStorage(e,t){if(!this.isStorageAvailable(e))return null;try{return this.getStorage(e).getItem(t)}catch(e){return null}}readNumberFromStorage(e,t){const i=this.readStringFromStorage(e,t);if(!i)return null;const n=parseInt(i,10);return isNaN(n)?null:n}readBooleanFromStorage(e,t){const i=this.readStringFromStorage(e,t);return null===i?null:"true"===i}isStorageAvailable(e){return this.isAvailable[e]}getStorage(e){return this[e]}}function Ds(e){try{const t=`__${u}_storage_test__`;return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}class Rs{constructor(e,t,i,n){this.timestamp=e,this.queue=t,this.cookies=i,this.debug=n,this.timeInitialized=!1}isTimeInitialized(){return this.timeInitialized}queryTime(e){if(this.timeInitialized)return;let t=this.cookies.getCookie(n);if("string"==typeof t&&(this.debug.log("getting time offset from cookie",t),t=Number(t),!isNaN(t)))return this.debug.log("timestamp is valid number, choosing"),this.timestamp.timestampOffset=t,this.timeInitialized=!0,void this.cookies.setCookie(n,t.toString(),"time");this.debug.log("no time offset stored, getting from server");const i=this.timestamp,r=this.cookies;this.queue.enqueue({name:nn.Time,prepareData:()=>{const e=i.getTimestamp(),t={clientTS:e};return this.debug.log("getting server timestamp",t),{data:t,state:{clientTS:e}}},processResponse:(t,o,s)=>{const a=o.clientTS,c=i.getTimestamp();if(s&&s.start_time&&s.end_time){const e=c-a-(s.end_time-s.start_time);i.timestampOffset=s.end_time+e/2-c}else{this.debug.log("received time response",t);const e=t.time,n=c-(c-a)/2;i.timestampOffset=e-n}this.debug.log(`time offset is ${i.timestampOffset} `),r.setCookie(n,i.timestampOffset.toString(),"time"),e&&e()}},{first:!0})}}class Ms{constructor(e){this.storageUtils=e,this.lastUsedTimestamp=null,this.timestampOffsetValue=0}getUnixTimestamp(){return(new Date).getTime()/1e3}storeTimestamp(e,t){this.storageUtils.writeToStorage("localStorage",e,t)}getStoredTimestamp(e){return this.storageUtils.readNumberFromStorage("localStorage",e)}getTimestamp(){let e=this.getUnixTimestamp();return null!=this.lastUsedTimestamp&&this.lastUsedTimestamp>=e&&(e=this.lastUsedTimestamp+.001),this.lastUsedTimestamp=e,e}getTimestampWithOffset(){return this.getTimestamp()+this.timestampOffsetValue}set timestampOffset(e){this.timestampOffsetValue=e}get timestampOffset(){return this.timestampOffsetValue}}const Ns={_keyStr:"1BGFYekyHP0tx4OKnQCIoUfMbhRaVEqrzLN._su96W5g3AcvXpZDlJdj78-mSi2wT",decode:function(e){let t="";e=e.replace(/[^A-Za-z0-9\._-]/g,"");let i=0;for(;i<e.length;){const n=this._keyStr.indexOf(e.charAt(i++)),r=this._keyStr.indexOf(e.charAt(i++)),o=this._keyStr.indexOf(e.charAt(i++)),s=this._keyStr.indexOf(e.charAt(i++)),a=n<<2|r>>4,c=(15&r)<<4|o>>2,u=(3&o)<<6|s;t+=String.fromCharCode(a),64!==o&&(t+=String.fromCharCode(c)),64!==s&&(t+=String.fromCharCode(u))}return Ns._utf8_decode(t)},_utf8_decode:function(e){let t="",i=0;const n="UTF-8 character cannot continue with: ";for(;i<e.length;){const r=e.charCodeAt(i);if(r<128)t+=String.fromCodePoint(r),i++;else if(r>191&&r<224){const o=e.charCodeAt(i+1);if(o<128||o>191)throw RangeError(n+o);t+=String.fromCodePoint((31&r)<<6|63&o),i+=2}else if(r>223&&r<240){const o=e.charCodeAt(i+1),s=e.charCodeAt(i+2);if(o<128||o>191)throw RangeError(n+o);if(s<128||s>191)throw RangeError(n+s);t+=String.fromCodePoint((15&r)<<12|(63&o)<<6|63&s),i+=3}else{if(!(r>239&&r<248))throw RangeError("UTF-8 character cannot start with: "+r);{const o=e.charCodeAt(i+1),s=e.charCodeAt(i+2),a=e.charCodeAt(i+3);if(o<128||o>191)throw RangeError(n+o);if(s<128||s>191)throw RangeError(n+s);if(a<128||a>191)throw RangeError(n+a);t+=String.fromCodePoint((7&r)<<18|(63&o)<<12|(63&s)<<6|63&a),i+=4}}}return t}};class Us{constructor(e,t){this.debug=e,this.location=t}getCustomerIdentityFromUrl(){const e=this.getTransferIdentityToken();if(!e)return null;let t;this.debug.log("found iitt token in URL",e);try{t=Ns.decode(e)}catch(e){return this.debug.error("iiit token is not valid base64 string"),null}this.debug.log("decoded token is",t);const i=t.indexOf(":");if(i<0)return this.debug.log("iit token is not valid"),null;const n={};return n[t.substring(0,i)]=t.substring(i+1),this.debug.log("resulting transferred customer ID is",n),n}getTransferIdentityFirstClickToken(){return this.getParameterValueFromUrl("xnpe_tifc")}getTransferIdentityToken(){return this.getParameterValueFromUrl("iitt")}getParameterValueFromUrl(e){const t=this.location.href.match(new RegExp("[?&]+"+e+"=([^&]*)","gi"));if(!t)return;const i=t[t.length-1].match(/[?&]+[^=]+=([^&]*)/i);return i?i[1]:void 0}}class qs{constructor(e,t){this.reporter=e,this.window=t,this.callbacks=[],this.afterCallbacks=[]}initialize(){this.window.addEventListener("pagehide",(()=>{Ws(this.reporter,this.callbacks),Ws(this.reporter,this.afterCallbacks)}))}addListener(e){this.callbacks.push(e)}addAfterListener(e){this.afterCallbacks.push(e)}}function Ws(e,t){t.forEach((t=>{e.reportError(t,"unloaderCallback")()}))}class $s{constructor(e,t,i,n,r,o){this.reporter=e,this.config=t,this.location=i,this.history=n,this.window=r,this.logger=o,this.onChangeListeners=new Set}getParams(e){return function(e,t){const i={},n={};return e.forEach((e=>{n[e]=!0})),t.replace(/[?&]+([^=&]+)=([^&]*)/gi,((e,t,r)=>{if(t in n)try{i[t]=decodeURIComponent(r)}catch(e){}return""})),i}(e,this.location.href)}getAllQueryParams(){return function(e){const t={};return new URL(e).searchParams.forEach(((e,i)=>{t[i]=decodeURIComponent(e)})),t}(this.location.href)}onChange(e,t){if(this.onChangeListeners.has(e))return;this.onChangeListeners.add(e);const i=ir(this.reporter.reportError(t,e),10);!function(e,t,i,n,r){if(!(!0===e.spa_reloading||e.spa_reloading&&!1!==e.spa_reloading.on_url_change))return;let o=i.href.replace(i.hash,"");if(!n.pushState)return;const s=n.pushState;n.pushState=(...e)=>{s.apply(n,e),o=Hs(i,o,r)},Ho(t,"popstate",(()=>{o=Hs(i,o,r)}))}(this.config.getOptions(),this.window,this.location,this.history,i),function(e,t,i,n,r){if(!("object"==typeof e.spa_reloading&&!1!==e.spa_reloading.on_hash_change||!0===e.spa_reloading&&e.track_hash_changes))return;if(!("onhashchange"in t))return void n.warn("Browser is missing the HashChangeEvent support. The spa_reloading.on_hash_change option won't work.");Ho(t,"hashchange",(o=i.hash,s=r,()=>{i.hash!==o&&(o=i.hash,s())}));var o,s}(this.config.getOptions(),this.window,this.location,this.logger,i)}}function Hs(e,t,i){const n=e.href.replace(e.hash,"");return t!==n&&i(),n}class Vs{constructor(e,t,i,n,r,o,s,a){this.reporter=e,this.config=t,this.linkTracker=i,this.eventTracker=n,this.window=r,this.debug=o,this.documentContentLoaded=s,this.unloader=a,this.activity={start:null,last:null},this._activityHandler=new ts(this.window)}trackExitsWithDataAttribute(){const e=this.config.getOptions().track;e&&(!0===e.exits||me(e.exits))&&this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{let t=e.exits;me(t)||(t=e=>{const t=e,i={location:t.href,current_location:window.location.href};return t.getAttribute("id")&&(i.element_id=t.getAttribute("id")),t.getAttribute("name")&&(i.element_name=t.getAttribute("name")),{type:"web_exit",properties:i}});const i=pi("a[data-exponea-track]");for(let e=0;e<i.length;e++)this.debug.log("Registering web exit link tracking for",i[e]),this.linkTracker.trackLink(i[e],t)}))}startActivityTracking(){const e=this.config.getOptions().track;e&&e.activity&&(this.debug.log("Activity tracking enabled"),this._activityHandler.registerActionListeners(),this.window.setInterval((()=>this.checkLastActivity()),1e3),this.unloader.addListener((()=>{this.trackActivityEvent(new Date,!0)})))}checkLastActivity(){if(this._activityHandler.getLastUserActivity()&&this._setUserWasActive(),this._activityHandler.resetActivity(),null==this.activity.last)return;const e=new Date;e.getTime()-this.activity.last.getTime()>6e4&&(this.trackActivityEvent(e),this.activity={start:null,last:null})}trackActivityEvent(e,t=!1){const i=this.config.getOptions().track;if(!t||this.activity.last&&this.activity.start||(this.activity.last=new Date,this.activity.start=this.activity.last),!i||!i.activity||null==this.activity.start||null==this.activity.last)return;const n=this.activity.start.getTime()/1e3,r=this.activity.last.getTime()/1e3;this.debug.log("Tracking user activity event"),this.eventTracker.track("user_active",{start_client_timestamp:n,end_client_timestamp:r,now_client_timestamp:e.getTime(),duration:r-n},{},t)}_setUserWasActive(){this.activity.last=new Date,null==this.activity.start&&(this.activity.start=this.activity.last)}}var Gs;!function(e){e.automatic="automatic",e.manual="manual"}(Gs||(Gs={}));class Ks{constructor(e,t,i,n,r,o,s,a,c,u,l,h,d,p){this.reporter=e,this.config=t,this.contextualBanditEventFilter=i,this.queue=n,this.timestamp=r,this.ping=o,this.tracker=s,this.location=a,this.debug=c,this.documentContentLoaded=u,this.initializeState=l,this.storageUtils=h,this.url=d,this.window=p,this.showingWebLayersInProgress=!1,this.webLayerHiders=[],this.personalizedWebLayers=[],this.tracker.registerEventTrackingListener(function(e,t){return function(i,n){"banner"===i&&"banner_id"in n&&(n.interaction&&Ys(e,t,n.banner_id,"interaction","_last_interaction"),"show"===n.action&&Ys(e,t,n.banner_id,"show event","_last_show"))}}(this.debug,this.storageUtils))}queryAndShowWebLayer(e,t={},i=!1,n){i||this.hideExistingWebLayers(),this.queryAndShowWebLayers([e],t,n,Gs.manual)}hideExistingWebLayers(){for(const e of this.webLayerHiders)try{e()}catch(e){this.debug.error("Error from hide weblayer script",e)}this.webLayerHiders=[]}filterPersonalizedWeblayers(e){this.personalizedWebLayers=e.filter(Qs)}processDefinition(e,t,i){this.filterPersonalizedWeblayers(e),this.filterAndShowWebLayers(this.personalizedWebLayers,t,i,!1),this.config.isSpaReloadingEnabled("banners")&&this.url.onChange("onUrlChangeFilterAndShowWebLayers",(()=>{this.filterAndShowWebLayers(this.personalizedWebLayers,t)}))}processNonPersonalizedDefinition(e,t,i){const n=e.filter((e=>!Qs(e)));this.debug.log("Processing Non-personalized weblayers...",n),this.filterAndShowNonPersonalizedWebLayers(n,t,i)}showWebLayer(e,t){let i,n;this.debug.log(`Showing weblayer ${t}...`);try{i=new Function(e)}catch(e){return this.debug.error(`Syntax error in the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ${t}\njavascript code. Check the web layer javascript code for syntax errors, such\nerrors are usually highlighted in the UI. The first line of the stack trace\nbelow should give you a clue.\n\n`,e)}try{n=i()}catch(e){return this.debug.error(`Error when executing the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ${t}\njavascript code. Check the web layer javascript code for errors. This is not\na syntax error and may be hard to spot, but the first line of the stack trace\nbelow should give you a clue.\n\n`,e)}n.hasOwnProperty("contextual_personalization")&&this.updateContextualBanditEventFilter(n.contextual_personalization),"function"==typeof n&&n.hasOwnProperty("remove")&&"function"==typeof n.remove&&this.webLayerHiders.push(n.remove)}filterAndShowWebLayers(e,t,i,n=!0){if(this.showingWebLayersInProgress)return;n&&this.hideExistingWebLayers();const r=this.filterWebLayersForCustomer(e,t);if(0===r.length)return void(i&&Lr(i));const o=r.map((({_id:e})=>e));this.showingWebLayersInProgress=!0,this.queryAndShowWebLayers(o,{},i,Gs.automatic)}filterAndShowNonPersonalizedWebLayers(e,t,i,n=!0){if(this.showingWebLayersInProgress)return;n&&this.hideExistingWebLayers();const r=this.filterWebLayersForCustomer(e,t);if(0===r.length)return void(i&&Lr(i));this.showingWebLayersInProgress=!0;const o=r.map((e=>{var t;return null!==(t=e.data)&&void 0!==t?t:"return {}"})),s=r.map((e=>e._id));return this.showWebLayers(o,s).then((()=>{this.showingWebLayersInProgress=!1,i&&Lr(i)}))}filterWebLayersForCustomer(e,t){const i=lo(so.WebLayer,this.debug),n=Tr(this.debug);return e.filter(i("page",(e=>po.matches(this.location.href,e.trigger)))).filter(i("date",(e=>Yr.matches(this.timestamp.getTimestamp(),e.date_filter)))).filter(i("device",(e=>ro.matches(e.device_target)))).filter(i("frequency",(e=>oo.matches(this.ping,this.timestamp,this.storageUtils,e.frequency,e._id,o)))).filter(i("conditions",(e=>{var i;return Qr.matches(this.window,this.url,n,t,null===(i=e.variables_target)||void 0===i?void 0:i.conditions)})))}queryAndShowWebLayers(e,t={},i,n=Gs.automatic){let r=Zn(this.config.getOptions().customer);this.reporter.reportPromiseError(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Dr.BannersShow,noBulk:!0,prepareData:()=>(this.debug.log("Get filtered weblayers by IDs",e),r&&r.cookie||(r=Zn(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:r,banner_ids:e,params:t,initiator:n}}),processResponse:({data:t})=>{this.showWebLayers(t,e).then((()=>{this.showingWebLayersInProgress=!1,i&&Lr(i)}))},processError:e=>{this.showingWebLayersInProgress=!1,i&&Lr(i.bind(void 0,e))}})}))}showWebLayers(e,t){return this.debug.log("Showing weblayers..."),this.reporter.reportPromiseError(this.documentContentLoaded.whenLoaded()).then((()=>{e.forEach(((e,i)=>this.showWebLayer(e,t[i])))}))}updateContextualBanditEventFilter(e){var t,i,n;const r=null===(t=e.optimization_target)||void 0===t?void 0:t.type,o=null===(i=e.optimization_target)||void 0===i?void 0:i.event_type,s=(null===(n=e.optimization_target)||void 0===n?void 0:n.event_filter)||[],a=e.reward_token,c=e.reward_value||1;"event_tracked"===r&&o&&a&&this.contextualBanditEventFilter.put(o,s,a,c)}}function Qs(e){return void 0===e.uses_personalization||e.uses_personalization}function Ys(e,t,i,n,r){e.log(`Recording ${n} for weblayer ${i}`),t.writeToStorage("localStorage",o+i+r,(new Date).valueOf().toString())}fi([Ir(),mi("design:type",Function),mi("design:paramtypes",[String,String]),mi("design:returntype",void 0)],Ks.prototype,"showWebLayer",null);class Js{constructor(e){e&&Se(e,((e,t)=>{this[`_${t}`]=e}))}get location(){return this._location||(this._location=window.location),this._location}get document(){return this._document||(this._document=window.document),this._document}get date(){return this._date||(this._date=Date),this._date}get localStorage(){return this._localStorage||(this._localStorage=window.localStorage),this._localStorage}get sessionStorage(){return this._sessionStorage||(this._sessionStorage=window.sessionStorage),this._sessionStorage}get history(){return this._history||(this._history=window.history),this._history}get window(){return this._window||(this._window=window),this._window}get console(){return this._console||(this._console=window.console),this._console}get math(){return this._math||(this._math=Math),this._math}get config(){return this._config||(this._config=new vr(this.database,this.logger)),this._config}get featureFlags(){return this._featureFlags||(this._featureFlags=new wo(this.debug,this.window)),this._featureFlags}get contextualBandit(){return this._contextualBandit||(this._contextualBandit=new wr(this.config,this.http)),this._contextualBandit}get timestamp(){return this._timestamp||(this._timestamp=new Ms(this.storageUtils)),this._timestamp}get http(){return this._http||(this._http=new Po(window)),this._http}get queue(){return this._queue||(this._queue=new Ts(this.reporter,this.config,this.http,this.debug,this.timestamp,this.unloader,this.window,this.featureFlags)),this._queue}get cookies(){return this._cookies||(this._cookies=new Pr(this.config,this.debug,this.logger,this.queue,this.location,this.document,this.segments)),this._cookies}get contextualBanditEventFilter(){return this._contextualBanditEventFilter||(this._contextualBanditEventFilter=new Ar(this.contextualBandit,this.debug)),this._contextualBanditEventFilter}get time(){return this._time||(this._time=new Rs(this.timestamp,this.queue,this.cookies,this.debug)),this._time}get eventTracker(){return this._eventTracker||(this._eventTracker=new Fr(this.reporter,this.config,this.contextualBanditEventFilter,this.time,this.timestamp,this.queue,this.debug,this.document,this.location,this.initializeState,this.window,this.url,this.browserExtension)),this._eventTracker}get ping(){return this._ping||(this._ping=new is(this.reporter,this.config,this.timestamp,this.eventTracker,this.window,this.location,this.document,this.debug,this.cookies,this.storageUtils,this.unloader,this.url)),this._ping}get dependencyLoader(){return this._dependencyLoader||(this._dependencyLoader=new qr(this.config,this.reporter)),this._dependencyLoader}get customer(){return this._customer||(this._customer=new Mr(this.reporter,this.config,this.queue,this.debug,this.initializeState,this.window,this.cookies,this.browserExtension,this.segments)),this._customer}get userActivityTracking(){return this._userActivityTracking||(this._userActivityTracking=new Vs(this.reporter,this.config,this.linkTracker,this.eventTracker,this.window,this.debug,this.documentContentLoaded,this.unloader)),this._userActivityTracking}get experimentsEditor(){return this._experimentsEditor||(this._experimentsEditor=new mo(this.http,this.config,this.location,this.document,this.history,this.window,this.debug,this.storageUtils)),this._experimentsEditor}get experimentsModifications(){return this._experimentsModifications||(this._experimentsModifications=new bo(this.eventTracker,this.experimentsEditor,this.document,this.debug)),this._experimentsModifications}get experiments(){return this._experiments||(this._experiments=new go(this.reporter,this.config,this.queue,this.timestamp,this.ping,this.experimentsModifications,this.experimentsEditor,this.eventTracker,this.location,this.debug,this.documentContentLoaded,this.storageUtils,this.newExperiments,this.url,this.window)),this._experiments}get abTest(){return this._abTest||(this._abTest=new di(this.cookies)),this._abTest}get recommendations(){return this._recommendations||(this._recommendations=new Ls(this.config,this.queue,this.debug)),this._recommendations}get webLayers(){return this._webLayers||(this._webLayers=new Ks(this.reporter,this.config,this.contextualBanditEventFilter,this.queue,this.timestamp,this.ping,this.eventTracker,this.location,this.debug,this.documentContentLoaded,this.initializeState,this.storageUtils,this.url,this.window)),this._webLayers}get managedTags(){return this._managedTags||(this._managedTags=new Yo(this.reporter,this.config,this.queue,this.location,this.document,this.debug,this.url)),this._managedTags}get linkTracker(){return this._linkTracker||(this._linkTracker=new $o(this.reporter,this.eventTracker,this.debug,this.documentContentLoaded)),this._linkTracker}get unloader(){return this._unloader||(this._unloader=new qs(this.reporter,this.window)),this._unloader}get campaignClicks(){return this._campaignClicks||(this._campaignClicks=new pn(this.location,this.queue,this.config,this.timestamp,this.time,this.debug,this.window,this.document)),this._campaignClicks}get notifications(){return this._notifications||(this._notifications=new cs(this.pushWebApi,this.pushSafariApi)),this._notifications}get pushWebApi(){return this._pushWebApi||(this._pushWebApi=new ls(this.window,this.location,this.debug,this.logger,this.config,this.customer,this.queue,this.serviceWorkerManager)),this._pushWebApi}get pushSafariApi(){return this._pushSafariApi||(this._pushSafariApi=new us(this.window,this.config,this.customer,this.location,this.storageUtils)),this._pushSafariApi}get debug(){return this._debug||(this._debug=new Ur(this.config,this.location,this.logger,this.storageUtils)),this._debug}get reporter(){return this._reporter||(this._reporter=new Gr(this.debug,this.config,this.http)),this._reporter}get initializer(){return this._initializer||(this._initializer=new Mo(this.reporter,this.debug,this.config,this.time,this.cookies,this.ping,this.customer,this.userActivityTracking,this.experimentsEditor,this.experiments,this.webLayers,this.managedTags,this.campaignClicks,this.eventTracker,this.queryTracking,this.window,this.unloader,this.initializeState,this.queue,this.pushWebApi,this.pushSafariApi,this.transferIdentity,this.http,this.logger,this.newExperiments,this.featureFlags,this.browserExtension)),this._initializer}get queryTracking(){return this._queryTracking||(this._queryTracking=new ds(this.reporter,this.config,this.queue,this.debug,this.timestamp,this.automaticTracking,this.window,this.eventTracker,this.customer,this.liveEventHandler,this.storageUtils,this.url)),this._queryTracking}get automaticTracking(){return this._automaticTracking||(this._automaticTracking=new gi(this.reporter,this.documentContentLoaded)),this._automaticTracking}get liveEventHandler(){return this._liveEventHandler||(this._liveEventHandler=new Vo(this.reporter,this.document)),this._liveEventHandler}get documentContentLoaded(){return this._documentContentLoaded||(this._documentContentLoaded=new Wr(this.window,this.document)),this._documentContentLoaded}get initializeState(){return this._initializeState||(this._initializeState=new No),this._initializeState}get transferIdentity(){return this._transferIdentity||(this._transferIdentity=new Us(this.debug,this.location)),this._transferIdentity}get html(){return this._html||(this._html=new ko(this.config,this.debug,this.documentContentLoaded,this.queue)),this._html}get enhancedEcommerce(){return this._enhancedEcommerce||(this._enhancedEcommerce=new $r.Tracker(this.debug,this.eventTracker)),this._enhancedEcommerce}get serviceWorkerManager(){return this._serviceWorkerManager||(this._serviceWorkerManager=new Fs(this.window,this.debug,this.config)),this._serviceWorkerManager}get logger(){return this._logger||(this._logger=new Go(this.console,l)),this._logger}get storageUtils(){return this._storageUtils||(this._storageUtils=new zs(this.logger,this.localStorage,this.sessionStorage)),this._storageUtils}get database(){return this._database||(this._database=new Nr(this.window,this.logger)),this._database}get newExperiments(){return this._newExperiments||(this._newExperiments=new Jo(this.reporter,this.window,this.serviceWorkerManager,this.database,this.storageUtils,this.config,this.logger)),this._newExperiments}get url(){return this._url||(this._url=new $s(this.reporter,this.config,this.location,this.history,this.window,this.logger)),this._url}get browserExtension(){return this._browserExtension||(this._browserExtension=new tn.Handler(this.window,this.debug)),this._browserExtension}get segments(){return this._segments||(this._segments=new Bs(this.reporter,this.config,this.initializeState,this.queue)),this._segments}}const Zs=["anonymize","initialize","identify","getSegments","update","track","trackLink","trackEnhancedEcommerce","getHtml","showHtml","showBanner","showWebLayer","ping","getAbTest","loadDependency","getRecommendation","reloadWebLayers","_preInitialize","_initializeConfig","_bootstrapEditor","_insertExperiment","_revertExperiments","_rewardBandit"],Xs=["version","isLoaded","isInitialized","configuration"],ea=["isAvailable","isSubscribed","subscribe","unsubscribe"],ta=["subscribe"];function ia(){return function(e,t,i){const n=i.value;return i.value=function(){const e=!this.isInitialized,t=this.config.getOptions();na(t)?this.reporter.reportPromiseError(this.initializedState.whenInitialized()).then((()=>{e||n.apply(this,arguments)})):n.apply(this,arguments)},i}}function na(e){return!0===e.compliance.opt_in||!0===e.compliance.opt_in.ignore_stored_command}function ra(){return window[k]}class oa{get version(){return e}get isLoaded(){return!0}get isInitialized(){return this.initializeState.isInitialized()}get configuration(){return rn(this.config.getOptions())}get initializedState(){return this.initializeState}constructor({config:e,dependencyLoader:t,cookies:i,eventTracker:n,initializer:r,initializeState:o,customer:s,experimentsEditor:a,experiments:c,notifications:u,recommendations:l,abTest:h,webLayers:d,linkTracker:p,ping:g,reporter:f,contextualBandit:m,queue:b,debug:y,html:v,enhancedEcommerce:w,browserExtension:k,segments:_,featureFlags:x,logger:S,window:E}){this._=[],this.config=e,this.dependencyLoader=t,this.cookies=i,this.eventTracker=n,this.initializer=r,this.initializeState=o,this.customer=s,this.experimentsEditor=a,this.experiments=c,this.notifications=u,this.recommendations=l,this.abTest=h,this.webLayers=d,this.linkTracker=p,this.pingService=g,this.reporter=f,this.contextualBandit=m,this.queue=b,this.debug=y,this.html=v,this.enhancedEcommerce=w,this.browserExtension=k,this.segments=_,this.featureFlags=x,this.logger=S,this.window=E,this.queue.registerPostBulkCallback((()=>{const e=this.config.getOptions().exposed_segments.segmentation_processing_delay;new Promise((t=>{setTimeout(t,e)})).then((()=>{this.segments.flush(),this.segments.prefetch(),this.segments.notify()}))})),this.window.setInterval((()=>{this.reporter.reportPromiseError(Bo(this.queue)).then((e=>this.webLayers.filterPersonalizedWeblayers(e.webLayers)))}),6e5)}initialize(e){return this.initializer.initialize(e)}_preInitialize(e){this.initializer.extendOptions(e),this.reporter.reportPromiseError(Bo(this.queue)).then((e=>this.webLayers.processNonPersonalizedDefinition(e.webLayers,e.vars)))}_initializeConfig(e){this.initializer.extendOptions(e)}track(e,t,i,n,r){return this.eventTracker.track(e,t,{successCallback:i,errorCallback:n,immediate:r})}identify(e,t,i,n,r,o,s){return this.customer.identifyCustomer(e,t,i,n,r,o,s)}update(e){return this.customer.updateCustomer(e)}anonymize(){const e=this.cookies.setFreshTrackingCookie();this.config.setNewCustomerIds({cookie:e}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:e}}),this.debug.log("sending new anonymized cookie to server"),this.cookies.sendCustomerCookieToServer(e),this.notifications.unsubscribe((()=>{})),this.segments.notify()}getAbTest(e,t,i){const n=`${h}${e}__`,r=this.cookies.getCookie(n),o=this.abTest.getAbTest(e,t);if(r||this.eventTracker.track("ab test",{name:e,variant:o}),!i)return o;Lr((()=>i(o)))}showBanner(e,t,i=!1,n){return this.showWebLayer(e,t,i,n)}showWebLayer(e,t,i=!1,n){return this.webLayers.queryAndShowWebLayer(e,t,i,n)}getRecommendation(e){return this.recommendations.fetch(e,arguments)}getSegments(e,t,i,n={force:!1}){this.segments.getSegments(e,t,i,n)}trackLink(e,t,i){return this.linkTracker.trackLink(e,t,i)}loadDependency(e,t=(()=>{})){return this.ensureThatSdkIsInitialized(),this.dependencyLoader.loadDependency(e).then((()=>t())).catch((e=>t(e)))}ping(e){return void 0===e?this.pingService.sendPing():(this.pingService.setOptions(e),this.pingService.restartPinging())}reloadWebLayers(e){this.reporter.reportPromiseError(Bo(this.queue)).then((e=>this.webLayers.processDefinition(e.webLayers,e.vars))).then((()=>{e&&Lr(e)})).catch((t=>{e&&Lr((()=>e(t)))}))}_bootstrapEditor(){return this.experimentsEditor.bootstrapEditor()}_insertExperiment(e,t){if(!this.config.getOptions().new_experiments&&!this.featureFlags.flags.ep3_use_new_experiments)return this.experiments.applyExperimentModificationsAndTrackEvent(e,t);const i=ra();if(i&&i.applyModifications)return this._applyModificationsWhenMethodAvailable(e,i,t);const n=this.initializer.isWebxpClientReady.then((()=>i&&i.applyModifications?this._applyModificationsWhenMethodAvailable(e,i,t):(this.logger.error(`Unable to initialize experiment ${e.params.experiment_id}. Function applyModifications is not available.`),()=>{})),(e=>(this.logger.error("Unable to initialize experiments:",e),()=>{})));return()=>{n.then((e=>{"function"!=typeof e?this.logger.error("Unable to generate revert function"):e()}))}}_revertExperiments(){if(!this.featureFlags.flags.ep3_use_new_experiments&&!this.config.getOptions().new_experiments)return this.experiments.revertExistingExperiments();{const e=ra();if(e&&e.revert)try{return e.revert()}catch(e){this.debug.error("Error from revert experiment script",e)}}}_rewardBandit(e,t,i,n){this.contextualBandit.rewardBandit(e,t,i,n)}trackEnhancedEcommerce(e,t="all"){this.enhancedEcommerce.trackEnhancedEcommerce(e,t)}getHtml(e,t){this.html.getHtml(e,t)}showHtml(e,t){this.html.showHtml(e,t)}ensureThatSdkIsInitialized(){if(!this.initializeState.isInitialized())throw new Error("You have to call initialize before any other Exponea SDK method can be called")}_applyModificationsWhenMethodAvailable(e,t,i){let n;try{n=t.applyModifications?t.applyModifications(e,!1):()=>{}}catch(e){return this.debug.error("Error applying experiment",e),()=>{}}return i&&this.eventTracker.track("experiment",{action:"show",experiment_id:e.params.experiment_id,experiment_name:e.params.experiment_name,variant_id:e.params.variant_id,variant_name:e.params.variant_name,location:window.location.href,path:window.location.pathname}),n}}fi([ns([{name:"options",oneOf:["boolean","object"]}]),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],oa.prototype,"initialize",null),fi([ns([{name:"options",oneOf:["boolean","object"]}]),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],oa.prototype,"_preInitialize",null),fi([ns([{name:"options",oneOf:["boolean","object"]}]),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],oa.prototype,"_initializeConfig",null),fi([ns([{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Function,Function,Boolean]),mi("design:returntype",void 0)],oa.prototype,"track",null),fi([ns([{name:"customerIds",oneOf:["object","string","number"]},{name:"customerProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[Object,Object,Function,Function,Boolean,Function,Function]),mi("design:returntype",void 0)],oa.prototype,"identify",null),fi([ns([{name:"customerProperties",type:"object"}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],oa.prototype,"update",null),fi([ns([]),ia(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],oa.prototype,"anonymize",null),fi([ns([{name:"abTestName",type:"string"},{name:"variants",type:"object"},{name:"callback",type:"function",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Function]),mi("design:returntype",Object)],oa.prototype,"getAbTest",null),fi([ns([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Object,Function]),mi("design:returntype",void 0)],oa.prototype,"showBanner",null),fi([ns([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Object,Function]),mi("design:returntype",void 0)],oa.prototype,"showWebLayer",null),fi([ns([{name:"options",type:"object"}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],oa.prototype,"getRecommendation",null),fi([ns([{name:"exposedCategory",type:"string"},{name:"successCallback",type:"function"},{name:"errorCallback",type:"function",optional:!0},{name:"options",type:"object",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[String,Function,Function,Object]),mi("design:returntype",void 0)],oa.prototype,"getSegments",null),fi([ns([{name:"element",oneOf:["string","element"]},{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[Object,String,Object]),mi("design:returntype",void 0)],oa.prototype,"trackLink",null),fi([ns([{name:"dependencyNameOrArray",oneOf:["string","array"]},{name:"callback",type:"function",optional:!0}]),Ir(),mi("design:type",Function),mi("design:paramtypes",[Object,Function]),mi("design:returntype",void 0)],oa.prototype,"loadDependency",null),fi([ns([{name:"pingOptions",type:"object",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],oa.prototype,"ping",null),fi([ns([{name:"callback",type:"function",optional:!0}]),Ir(),ia(),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",void 0)],oa.prototype,"reloadWebLayers",null),fi([ns([]),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",Promise)],oa.prototype,"_bootstrapEditor",null),fi([ns([{name:"experiment",type:"object"},{name:"trackEvent",type:"boolean",optional:!0}]),mi("design:type",Function),mi("design:paramtypes",[Object,Boolean]),mi("design:returntype",Function)],oa.prototype,"_insertExperiment",null),fi([ns([]),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],oa.prototype,"_revertExperiments",null),fi([ns([{name:"banditRewardToken",type:"string"},{name:"banditRewardValue",type:"number"},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0}]),Ir(),mi("design:type",Function),mi("design:paramtypes",[String,Number,Function,Function]),mi("design:returntype",void 0)],oa.prototype,"_rewardBandit",null),fi([ns([{name:"ecommerceObject",type:"object"},{name:"kind",type:"string",optional:!0}]),Ir(),mi("design:type",Function),mi("design:paramtypes",[Object,String]),mi("design:returntype",void 0)],oa.prototype,"trackEnhancedEcommerce",null);var sa;const aa=new Go(console,l);if(la=navigator.userAgent,new RegExp("Googlebot\\/|Googlebot-Mobile|Googlebot-Image|Googlebot-News|Googlebot-Video|AdsBot-Google([^-]|$)|AdsBot-Google-Mobile|Feedfetcher-Google|Mediapartners-Google|Mediapartners \\(Googlebot\\)|APIs-Google|Google-InspectionTool|Storebot-Google|GoogleOther|bingbot|Slurp|[wW]get|LinkedInBot|Python-urllib|python-requests|aiohttp|httpx|libwww-perl|httpunit|nutch|Go-http-client|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|BIGLOTRON|Teoma|convera|seekbot|Gigabot|Gigablast|exabot|ia_archiver|GingerCrawler|webmon |HTTrack|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|findlink|msrbot|panscient|yacybot|AISearchBot|ips-agent|tagoobot|MJ12bot|woriobot|yanga|buzzbot|mlbot|YandexBot|YandexImages|YandexAccessibilityBot|YandexMobileBot|YandexMetrika|YandexTurbo|YandexImageResizer|YandexVideo|YandexAdNet|YandexBlogs|YandexCalendar|YandexDirect|YandexFavicons|YaDirectFetcher|YandexForDomain|YandexMarket|YandexMedia|YandexMobileScreenShotBot|YandexNews|YandexOntoDB|YandexPagechecker|YandexPartner|YandexRCA|YandexSearchShop|YandexSitelinks|YandexSpravBot|YandexTracker|YandexVertis|YandexVerticals|YandexWebmaster|YandexScreenshotBot|purebot|Linguee Bot|CyberPatrol|voilabot|Baiduspider|citeseerxbot|spbot|twengabot|postrank|Turnitin|scribdbot|page2rss|sitebot|linkdex|Adidxbot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|Ahrefs(Bot|SiteAudit)|fuelbot|CrunchBot|IndeedBot|mappydata|woobot|ZoominfoBot|PrivacyAwareBot|Multiviewbot|SWIMGBot|Grobbot|eright|Apercite|semanticbot|Aboundex|domaincrawler|wbsearchbot|summify|CCBot|edisterbot|seznambot|ec2linkfinder|gslfbot|aiHitBot|intelium_bot|facebookexternalhit|Yeti|RetrevoPageAnalyzer|lb-spider|Sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|OrangeBot\\/|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|S[eE][mM]rushBot|yoozBot|lipperhey|Y!J|Domain Re-Animator Bot|AddThis|Screaming Frog SEO Spider|MetaURI|Scrapy|Livelap[bB]ot|OpenHoseBot|CapsuleChecker|collection@infegy.com|IstellaBot|DeuSu\\/|betaBot|Cliqzbot\\/|MojeekBot\\/|netEstate NE Crawler|SafeSearch microdata crawler|Gluten Free Crawler\\/|Sonic|Sysomos|Trove|deadlinkchecker|Slack-ImgProxy|Embedly|RankActiveLinkBot|iskanie|SafeDNSBot|SkypeUriPreview|Veoozbot|Slackbot|redditbot|datagnionbot|Google-Adwords-Instant|adbeat_bot|WhatsApp|contxbot|pinterest.com.bot|electricmonk|GarlikCrawler|BingPreview\\/|vebidoobot|FemtosearchBot|Yahoo Link Preview|MetaJobBot|DomainStatsBot|mindUpBot|Daum\\/|Jugendschutzprogramm-Crawler|Xenu Link Sleuth|Pcore-HTTP|moatbot|KosmioBot|[pP]ingdom|AppInsights|PhantomJS|Gowikibot|PiplBot|Discordbot|TelegramBot|Jetslide|newsharecounts|James BOT|Bark[rR]owler|TinEye|SocialRankIOBot|trendictionbot|Ocarinabot|epicbot|Primalbot|DuckDuckGo-Favicons-Bot|GnowitNewsbot|Leikibot|LinkArchiver|YaK\\/|PaperLiBot|Digg Deeper|dcrawl|Snacktory|AndersPinkBot|Fyrebot|EveryoneSocialBot|Mediatoolkitbot|Luminator-robots|ExtLinksBot|SurveyBot|NING\\/|okhttp|Nuzzel|omgili|PocketParser|YisouSpider|um-LN|ToutiaoSpider|MuckRack|Jamie's Spider|AHC\\/|NetcraftSurveyAgent|Laserlikebot|^Apache-HttpClient|AppEngine-Google|Jetty|Upflow|Thinklab|Traackr.com|Twurly|Mastodon|http_get|DnyzBot|botify|007ac9 Crawler|BehloolBot|BrandVerity|check_http|BDCbot|ZumBot|EZID|ICC-Crawler|ArchiveBot|^LCC |filterdb.iss.net\\/crawler|BLP_bbot|BomboraBot|Buck\\/|Companybook-Crawler|Genieo|magpie-crawler|MeltwaterNews|Moreover|newspaper\\/|ScoutJet|(^| )sentry\\/|StorygizeBot|UptimeRobot|OutclicksBot|seoscanners|Hatena|Google Web Preview|MauiBot|AlphaBot|SBL-BOT|IAS crawler|adscanner|Netvibes|acapbot|Baidu-YunGuanCe|bitlybot|blogmuraBot|Bot.AraTurka.com|bot-pge.chlooe.com|BoxcarBot|BTWebClient|ContextAd Bot|Digincore bot|Disqus|Feedly|Fetch\\/|Fever|Flamingo_SearchEngine|FlipboardProxy|g2reader-bot|G2 Web Services|imrbot|K7MLWCBot|Kemvibot|Landau-Media-Spider|linkapediabot|vkShare|Siteimprove.com|BLEXBot\\/|DareBoost|ZuperlistBot\\/|Miniflux\\/|Feedspot|Diffbot\\/|SEOkicks|tracemyfile|Nimbostratus-Bot|zgrab|PR-CY.RU|AdsTxtCrawler|Datafeedwatch|Zabbix|TangibleeBot|google-xrawler|axios|Amazon CloudFront|Pulsepoint|CloudFlare-AlwaysOnline|Google-Structured-Data-Testing-Tool|WordupInfoSearch|WebDataStats|HttpUrlConnection|Seekport Crawler|ZoomBot|VelenPublicWebCrawler|MoodleBot|jpg-newsbot|outbrain|W3C_Validator|Validator\\.nu|W3C-checklink|W3C-mobileOK|W3C_I18n-Checker|FeedValidator|W3C_CSS_Validator|W3C_Unicorn|Google-PhysicalWeb|Blackboard|ICBot\\/|BazQux|Twingly|Rivva|Experibot|awesomecrawler|Dataprovider.com|GroupHigh\\/|theoldreader.com|AnyEvent|Uptimebot\\.org|Nmap Scripting Engine|2ip.ru|Clickagy|Caliperbot|MBCrawler|online-webceo-bot|B2B Bot|AddSearchBot|Google Favicon|HubSpot|Chrome-Lighthouse|HeadlessChrome|CheckMarkNetwork\\/|www\\.uptime\\.com|Streamline3Bot\\/|serpstatbot\\/|MixnodeCache\\/|^curl|SimpleScraper|RSSingBot|Jooblebot|fedoraplanet|Friendica|NextCloud|Tiny Tiny RSS|RegionStuttgartBot|Bytespider|Datanyze|Google-Site-Verification|TrendsmapResolver|tweetedtimes|NTENTbot|Gwene|SimplePie|SearchAtlas|Superfeedr|feedbot|UT-Dorkbot|Amazonbot|SerendeputyBot|Eyeotabot|officestorebot|Neticle Crawler|SurdotlyBot|LinkisBot|AwarioSmartBot|AwarioRssBot|RyteBot|FreeWebMonitoring SiteChecker|AspiegelBot|NAVER Blog Rssbot|zenback bot|SentiBot|Domains Project\\/|Pandalytics|VKRobot|bidswitchbot|tigerbot|NIXStatsbot|Atom Feed Robot|[Cc]urebot|PagePeeker\\/|Vigil\\/|rssbot\\/|startmebot\\/|JobboerseBot|seewithkids|NINJA bot|Cutbot|BublupBot|BrandONbot|RidderBot|Taboolabot|Dubbotbot|FindITAnswersbot|infoobot|Refindbot|BlogTraffic\\/\\d\\.\\d+ Feed-Fetcher|SeobilityBot|Cincraw|Dragonbot|VoluumDSP-content-bot|FreshRSS|BitBot|^PHP-Curl-Class|Google-Certificates-Bridge|centurybot|Viber|e\\.ventures Investment Crawler|evc-batch|PetalBot|virustotal|(^| )PTST\\/|minicrawler|Cookiebot|trovitBot|seostar\\.co|IonCrawl|Uptime-Kuma|SeekportBot|FreshpingBot|Feedbin|CriteoBot|Snap URL Preview Service|Better Uptime Bot|RuxitSynthetic|Google-Read-Aloud|Valve\\/Steam|OdklBot\\/|GPTBot|YandexRenderResourcesBot\\/|LightspeedSystemsCrawler|ev-crawler\\/|BitSightBot\\/|woorankreview\\/|Google-Safety|AwarioBot|DataForSeoBot|Linespider|WellKnownBot|A Patent Crawler","i").test(la))aa.log("Crawler detected, not initializing SDK");else if(function(e,t){return"Internet Explorer"===cn(e,t,e.navigator.userAgent,e.navigator.vendor)}(window,document))aa.log("Unsupported browser detected, not initializing SDK");else if(null===(sa=window[u])||void 0===sa?void 0:sa.version)aa.log("The SDK is already available on the window, maybe the SDK file is downloaded twice?");else{const e=new Js;e.debug.log("Creating SDK instance");const t=new oa(e),i=t.notifications,n=t.segments,r=function(e=window){return e[u]||(e[u]={_:[]},e[u].notifications={_:[]},e[u].segments={_:[]}),e[u].notifications||(e[u].notifications={_:[]}),e[u].segments||(e[u].segments={_:[]}),e[u]}(),o=r.notifications,s=r.segments;_(r,t,e.debug),x(Zs,r,t),ca=r,ua=t,Xs.forEach((e=>{Object.defineProperty(ca,e,{get:()=>ua[e],configurable:!1,enumerable:!1})})),_(o,i,e.debug),x(ea,o,i),_(s,n,e.debug),x(ta,s,n)}var ca,ua,la}();
//# sourceMappingURL=exponea.min.js.map
